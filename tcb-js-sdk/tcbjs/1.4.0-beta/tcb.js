!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("tcb",[],t):"object"==typeof exports?exports.tcb=t():e.tcb=t()}("undefined"!=typeof window?window:this,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=17)}([function(module,__webpack_exports__,__webpack_require__){"use strict";(function(global,Buffer){__webpack_require__.d(__webpack_exports__,"a",(function(){return bson_54}));var long__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3),long__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(long__WEBPACK_IMPORTED_MODULE_0__),buffer__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(1),buffer__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(buffer__WEBPACK_IMPORTED_MODULE_1__),commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==global?global:"undefined"!=typeof self?self:{};function createCommonjsModule(e,t){return e(t={exports:{}},t.exports),t.exports}var map=createCommonjsModule((function(e){if(void 0!==commonjsGlobal.Map)e.exports=commonjsGlobal.Map,e.exports.Map=commonjsGlobal.Map;else{var t=function(e){this._keys=[],this._values={};for(var t=0;t<e.length;t++)if(null!=e[t]){var n=e[t],r=n[0],i=n[1];this._keys.push(r),this._values[r]={v:i,i:this._keys.length-1}}};t.prototype.clear=function(){this._keys=[],this._values={}},t.prototype.delete=function(e){var t=this._values[e];return null!=t&&(delete this._values[e],this._keys.splice(t.i,1),!0)},t.prototype.entries=function(){var e=this,t=0;return{next:function(){var n=e._keys[t++];return{value:void 0!==n?[n,e._values[n].v]:void 0,done:void 0===n}}}},t.prototype.forEach=function(e,t){t=t||this;for(var n=0;n<this._keys.length;n++){var r=this._keys[n];e.call(t,this._values[r].v,r,t)}},t.prototype.get=function(e){return this._values[e]?this._values[e].v:void 0},t.prototype.has=function(e){return null!=this._values[e]},t.prototype.keys=function(){var e=this,t=0;return{next:function(){var n=e._keys[t++];return{value:void 0!==n?n:void 0,done:void 0===n}}}},t.prototype.set=function(e,t){return this._values[e]?(this._values[e].v=t,this):(this._keys.push(e),this._values[e]={v:t,i:this._keys.length-1},this)},t.prototype.values=function(){var e=this,t=0;return{next:function(){var n=e._keys[t++];return{value:void 0!==n?e._values[n].v:void 0,done:void 0===n}}}},Object.defineProperty(t.prototype,"size",{enumerable:!0,get:function(){return this._keys.length}}),e.exports=t}})),map_1=map.Map;long__WEBPACK_IMPORTED_MODULE_0___default.a.prototype.toExtendedJSON=function(e){return e&&e.relaxed?this.toNumber():{$numberLong:this.toString()}},long__WEBPACK_IMPORTED_MODULE_0___default.a.fromExtendedJSON=function(e,t){var n=long__WEBPACK_IMPORTED_MODULE_0___default.a.fromString(e.$numberLong);return t&&t.relaxed?n.toNumber():n},Object.defineProperty(long__WEBPACK_IMPORTED_MODULE_0___default.a.prototype,"_bsontype",{value:"Long"});var long_1=long__WEBPACK_IMPORTED_MODULE_0___default.a;function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var Double=function(){function e(t){_classCallCheck(this,e),t instanceof Number&&(t=t.valueOf()),this.value=t}return _createClass(e,[{key:"valueOf",value:function(){return this.value}},{key:"toJSON",value:function(){return this.value}},{key:"toExtendedJSON",value:function(e){return e&&(e.legacy||e.relaxed&&isFinite(this.value))?this.value:{$numberDouble:this.value.toString()}}}],[{key:"fromExtendedJSON",value:function(t,n){return n&&n.relaxed?parseFloat(t.$numberDouble):new e(parseFloat(t.$numberDouble))}}]),e}();Object.defineProperty(Double.prototype,"_bsontype",{value:"Double"});var double_1=Double;function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck$1(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$1(e,t,n){return t&&_defineProperties$1(e.prototype,t),n&&_defineProperties$1(e,n),e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Timestamp=function(e){function t(e,n){var r;return _classCallCheck$1(this,t),r=long_1.isLong(e)?_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e.low,e.high,!0)):_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e,n,!0)),_possibleConstructorReturn(r)}return _inherits(t,e),_createClass$1(t,[{key:"toJSON",value:function(){return{$timestamp:this.toString()}}},{key:"toExtendedJSON",value:function(){return{$timestamp:{t:this.high>>>0,i:this.low>>>0}}}}],[{key:"fromInt",value:function(e){return new t(long_1.fromInt(e,!0))}},{key:"fromNumber",value:function(e){return new t(long_1.fromNumber(e,!0))}},{key:"fromBits",value:function(e,n){return new t(e,n)}},{key:"fromString",value:function(e,n){return new t(long_1.fromString(e,n,!0))}},{key:"fromExtendedJSON",value:function(e){return new t(e.$timestamp.i,e.$timestamp.t)}}]),t}(long_1);Object.defineProperty(Timestamp.prototype,"_bsontype",{value:"Timestamp"}),Timestamp.MAX_VALUE=Timestamp.MAX_UNSIGNED_VALUE;var timestamp=Timestamp,require$$0={};function normalizedFunctionString(e){return e.toString().replace("function(","function (")}function insecureRandomBytes(e){for(var t=new Uint8Array(e),n=0;n<e;++n)t[n]=Math.floor(256*Math.random());return t}var randomBytes=insecureRandomBytes;if("undefined"!=typeof window&&window.crypto&&window.crypto.getRandomValues)randomBytes=function(e){return window.crypto.getRandomValues(new Uint8Array(e))};else{try{randomBytes=require$$0.randomBytes}catch(e){}null==randomBytes&&(randomBytes=insecureRandomBytes)}var utils={normalizedFunctionString:normalizedFunctionString,randomBytes:randomBytes};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}var cachedSetTimeout=defaultSetTimout,cachedClearTimeout=defaultClearTimeout;function runTimeout(e){if(cachedSetTimeout===setTimeout)return setTimeout(e,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(e,0);try{return cachedSetTimeout(e,0)}catch(t){try{return cachedSetTimeout.call(null,e,0)}catch(t){return cachedSetTimeout.call(this,e,0)}}}function runClearTimeout(e){if(cachedClearTimeout===clearTimeout)return clearTimeout(e);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(e);try{return cachedClearTimeout(e)}catch(t){try{return cachedClearTimeout.call(null,e)}catch(t){return cachedClearTimeout.call(this,e)}}}"function"==typeof global.setTimeout&&(cachedSetTimeout=setTimeout),"function"==typeof global.clearTimeout&&(cachedClearTimeout=clearTimeout);var queue=[],draining=!1,currentQueue,queueIndex=-1;function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var e=runTimeout(cleanUpNextTick);draining=!0;for(var t=queue.length;t;){for(currentQueue=queue,queue=[];++queueIndex<t;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,t=queue.length}currentQueue=null,draining=!1,runClearTimeout(e)}}function nextTick(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];queue.push(new Item(e,t)),1!==queue.length||draining||runTimeout(drainQueue)}function Item(e,t){this.fun=e,this.array=t}Item.prototype.run=function(){this.fun.apply(null,this.array)};var title="browser",platform="browser",browser=!0,env={},argv=[],version="",versions={},release={},config={};function noop(){}var on=noop,addListener=noop,once=noop,off=noop,removeListener=noop,removeAllListeners=noop,emit=noop;function binding(e){throw new Error("process.binding is not supported")}function cwd(){return"/"}function chdir(e){throw new Error("process.chdir is not supported")}function umask(){return 0}var performance=global.performance||{},performanceNow=performance.now||performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow||function(){return(new Date).getTime()};function hrtime(e){var t=.001*performanceNow.call(performance),n=Math.floor(t),r=Math.floor(t%1*1e9);return e&&(n-=e[0],(r-=e[1])<0&&(n--,r+=1e9)),[n,r]}var startTime=new Date;function uptime(){return(new Date-startTime)/1e3}var process={nextTick:nextTick,title:title,browser:browser,env:env,argv:argv,version:version,versions:versions,on:on,addListener:addListener,once:once,off:off,removeListener:removeListener,removeAllListeners:removeAllListeners,emit:emit,binding:binding,cwd:cwd,chdir:chdir,umask:umask,hrtime:hrtime,platform:platform,release:release,config:config,uptime:uptime},inherits;inherits="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e};var inherits$1=inherits;function _typeof$1(e){return(_typeof$1="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var formatRegExp=/%[sdj%]/g;function format(e){if(!isString(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(inspect(arguments[n]));return t.join(" ")}n=1;for(var r=arguments,i=r.length,o=String(e).replace(formatRegExp,(function(e){if("%%"===e)return"%";if(n>=i)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}})),s=r[n];n<i;s=r[++n])isNull(s)||!isObject(s)?o+=" "+s:o+=" "+inspect(s);return o}function deprecate(e,t){if(isUndefined(global.process))return function(){return deprecate(e,t).apply(this,arguments)};var n=!1;return function(){return n||(console.error(t),n=!0),e.apply(this,arguments)}}var debugs={},debugEnviron;function debuglog(e){if(isUndefined(debugEnviron)&&(debugEnviron=process.env.NODE_DEBUG||""),e=e.toUpperCase(),!debugs[e])if(new RegExp("\\b"+e+"\\b","i").test(debugEnviron)){debugs[e]=function(){var t=format.apply(null,arguments);console.error("%s %d: %s",e,0,t)}}else debugs[e]=function(){};return debugs[e]}function inspect(e,t){var n={seen:[],stylize:stylizeNoColor};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),isBoolean(t)?n.showHidden=t:t&&_extend(n,t),isUndefined(n.showHidden)&&(n.showHidden=!1),isUndefined(n.depth)&&(n.depth=2),isUndefined(n.colors)&&(n.colors=!1),isUndefined(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=stylizeWithColor),formatValue(n,e,n.depth)}function stylizeWithColor(e,t){var n=inspect.styles[t];return n?"["+inspect.colors[n][0]+"m"+e+"["+inspect.colors[n][1]+"m":e}function stylizeNoColor(e,t){return e}function arrayToHash(e){var t={};return e.forEach((function(e,n){t[e]=!0})),t}function formatValue(e,t,n){if(e.customInspect&&t&&isFunction(t.inspect)&&t.inspect!==inspect&&(!t.constructor||t.constructor.prototype!==t)){var r=t.inspect(n,e);return isString(r)||(r=formatValue(e,r,n)),r}var i=formatPrimitive(e,t);if(i)return i;var o=Object.keys(t),s=arrayToHash(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(t)),isError(t)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return formatError(t);if(0===o.length){if(isFunction(t)){var a=t.name?": "+t.name:"";return e.stylize("[Function"+a+"]","special")}if(isRegExp(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(isDate(t))return e.stylize(Date.prototype.toString.call(t),"date");if(isError(t))return formatError(t)}var c,u="",l=!1,f=["{","}"];(isArray(t)&&(l=!0,f=["[","]"]),isFunction(t))&&(u=" [Function"+(t.name?": "+t.name:"")+"]");return isRegExp(t)&&(u=" "+RegExp.prototype.toString.call(t)),isDate(t)&&(u=" "+Date.prototype.toUTCString.call(t)),isError(t)&&(u=" "+formatError(t)),0!==o.length||l&&0!=t.length?n<0?isRegExp(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),c=l?formatArray(e,t,n,s,o):o.map((function(r){return formatProperty(e,t,n,s,r,l)})),e.seen.pop(),reduceToSingleString(c,u,f)):f[0]+u+f[1]}function formatPrimitive(e,t){if(isUndefined(t))return e.stylize("undefined","undefined");if(isString(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return isNumber(t)?e.stylize(""+t,"number"):isBoolean(t)?e.stylize(""+t,"boolean"):isNull(t)?e.stylize("null","null"):void 0}function formatError(e){return"["+Error.prototype.toString.call(e)+"]"}function formatArray(e,t,n,r,i){for(var o=[],s=0,a=t.length;s<a;++s)hasOwnProperty(t,String(s))?o.push(formatProperty(e,t,n,r,String(s),!0)):o.push("");return i.forEach((function(i){i.match(/^\d+$/)||o.push(formatProperty(e,t,n,r,i,!0))})),o}function formatProperty(e,t,n,r,i,o){var s,a,c;if((c=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?a=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(a=e.stylize("[Setter]","special")),hasOwnProperty(r,i)||(s="["+i+"]"),a||(e.seen.indexOf(c.value)<0?(a=isNull(n)?formatValue(e,c.value,null):formatValue(e,c.value,n-1)).indexOf("\n")>-1&&(a=o?a.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+a.split("\n").map((function(e){return"   "+e})).join("\n")):a=e.stylize("[Circular]","special")),isUndefined(s)){if(o&&i.match(/^\d+$/))return a;(s=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+a}function reduceToSingleString(e,t,n){return e.reduce((function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}function isArray(e){return Array.isArray(e)}function isBoolean(e){return"boolean"==typeof e}function isNull(e){return null===e}function isNullOrUndefined(e){return null==e}function isNumber(e){return"number"==typeof e}function isString(e){return"string"==typeof e}function isSymbol(e){return"symbol"===_typeof$1(e)}function isUndefined(e){return void 0===e}function isRegExp(e){return isObject(e)&&"[object RegExp]"===objectToString(e)}function isObject(e){return"object"===_typeof$1(e)&&null!==e}function isDate(e){return isObject(e)&&"[object Date]"===objectToString(e)}function isError(e){return isObject(e)&&("[object Error]"===objectToString(e)||e instanceof Error)}function isFunction(e){return"function"==typeof e}function isPrimitive(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"===_typeof$1(e)||void 0===e}function isBuffer(e){return Buffer.isBuffer(e)}function objectToString(e){return Object.prototype.toString.call(e)}function pad(e){return e<10?"0"+e.toString(10):e.toString(10)}inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},inspect.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function timestamp$1(){var e=new Date,t=[pad(e.getHours()),pad(e.getMinutes()),pad(e.getSeconds())].join(":");return[e.getDate(),months[e.getMonth()],t].join(" ")}function log(){console.log("%s - %s",timestamp$1(),format.apply(null,arguments))}function _extend(e,t){if(!t||!isObject(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e}function hasOwnProperty(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var util={inherits:inherits$1,_extend:_extend,log:log,isBuffer:isBuffer,isPrimitive:isPrimitive,isFunction:isFunction,isError:isError,isDate:isDate,isObject:isObject,isRegExp:isRegExp,isUndefined:isUndefined,isSymbol:isSymbol,isString:isString,isNumber:isNumber,isNullOrUndefined:isNullOrUndefined,isNull:isNull,isBoolean:isBoolean,isArray:isArray,inspect:inspect,deprecate:deprecate,format:format,debuglog:debuglog};function _classCallCheck$2(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$2(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$2(e,t,n){return t&&_defineProperties$2(e.prototype,t),n&&_defineProperties$2(e,n),e}var Buffer$1=buffer__WEBPACK_IMPORTED_MODULE_1___default.a.Buffer,randomBytes$1=utils.randomBytes,deprecate$1=util.deprecate,PROCESS_UNIQUE=randomBytes$1(5),checkForHexRegExp=new RegExp("^[0-9a-fA-F]{24}$"),hasBufferType=!1;try{Buffer$1&&Buffer$1.from&&(hasBufferType=!0)}catch(e){hasBufferType=!1}for(var hexTable=[],_i=0;_i<256;_i++)hexTable[_i]=(_i<=15?"0":"")+_i.toString(16);for(var decodeLookup=[],i=0;i<10;)decodeLookup[48+i]=i++;for(;i<16;)decodeLookup[55+i]=decodeLookup[87+i]=i++;var _Buffer=Buffer$1;function convertToHex(e){return e.toString("hex")}function makeObjectIdError(e,t){var n=e[t];return new TypeError('ObjectId string "'.concat(e,'" contains invalid character "').concat(n,'" with character code (').concat(e.charCodeAt(t),"). All character codes for a non-hex string must be less than 256."))}var ObjectId=function(){function e(t){if(_classCallCheck$2(this,e),t instanceof e)return t;if(null==t||"number"==typeof t)return this.id=e.generate(t),void(e.cacheHexString&&(this.__id=this.toString("hex")));var n=e.isValid(t);if(!n&&null!=t)throw new TypeError("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");if(n&&"string"==typeof t&&24===t.length&&hasBufferType)return new e(Buffer$1.from(t,"hex"));if(n&&"string"==typeof t&&24===t.length)return e.createFromHexString(t);if(null==t||12!==t.length){if(null!=t&&t.toHexString)return e.createFromHexString(t.toHexString());throw new TypeError("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters")}this.id=t,e.cacheHexString&&(this.__id=this.toString("hex"))}return _createClass$2(e,[{key:"toHexString",value:function(){if(e.cacheHexString&&this.__id)return this.__id;var t="";if(!this.id||!this.id.length)throw new TypeError("invalid ObjectId, ObjectId.id must be either a string or a Buffer, but is ["+JSON.stringify(this.id)+"]");if(this.id instanceof _Buffer)return t=convertToHex(this.id),e.cacheHexString&&(this.__id=t),t;for(var n=0;n<this.id.length;n++){var r=hexTable[this.id.charCodeAt(n)];if("string"!=typeof r)throw makeObjectIdError(this.id,n);t+=r}return e.cacheHexString&&(this.__id=t),t}},{key:"toString",value:function(e){return this.id&&this.id.copy?this.id.toString("string"==typeof e?e:"hex"):this.toHexString()}},{key:"toJSON",value:function(){return this.toHexString()}},{key:"equals",value:function(t){return t instanceof e?this.toString()===t.toString():"string"==typeof t&&e.isValid(t)&&12===t.length&&this.id instanceof _Buffer?t===this.id.toString("binary"):"string"==typeof t&&e.isValid(t)&&24===t.length?t.toLowerCase()===this.toHexString():"string"==typeof t&&e.isValid(t)&&12===t.length?t===this.id:!(null==t||!(t instanceof e||t.toHexString))&&t.toHexString()===this.toHexString()}},{key:"getTimestamp",value:function(){var e=new Date,t=this.id.readUInt32BE(0);return e.setTime(1e3*Math.floor(t)),e}},{key:"toExtendedJSON",value:function(){return this.toHexString?{$oid:this.toHexString()}:{$oid:this.toString("hex")}}}],[{key:"getInc",value:function(){return e.index=(e.index+1)%16777215}},{key:"generate",value:function(t){"number"!=typeof t&&(t=~~(Date.now()/1e3));var n=e.getInc(),r=Buffer$1.alloc(12);return r[3]=255&t,r[2]=t>>8&255,r[1]=t>>16&255,r[0]=t>>24&255,r[4]=PROCESS_UNIQUE[0],r[5]=PROCESS_UNIQUE[1],r[6]=PROCESS_UNIQUE[2],r[7]=PROCESS_UNIQUE[3],r[8]=PROCESS_UNIQUE[4],r[11]=255&n,r[10]=n>>8&255,r[9]=n>>16&255,r}},{key:"createPk",value:function(){return new e}},{key:"createFromTime",value:function(t){var n=Buffer$1.from([0,0,0,0,0,0,0,0,0,0,0,0]);return n[3]=255&t,n[2]=t>>8&255,n[1]=t>>16&255,n[0]=t>>24&255,new e(n)}},{key:"createFromHexString",value:function(t){if(void 0===t||null!=t&&24!==t.length)throw new TypeError("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");if(hasBufferType)return new e(Buffer$1.from(t,"hex"));for(var n=new _Buffer(12),r=0,i=0;i<24;)n[r++]=decodeLookup[t.charCodeAt(i++)]<<4|decodeLookup[t.charCodeAt(i++)];return new e(n)}},{key:"isValid",value:function(t){return null!=t&&("number"==typeof t||("string"==typeof t?12===t.length||24===t.length&&checkForHexRegExp.test(t):t instanceof e||(t instanceof _Buffer&&12===t.length||!!t.toHexString&&(12===t.id.length||24===t.id.length&&checkForHexRegExp.test(t.id)))))}},{key:"fromExtendedJSON",value:function(t){return new e(t.$oid)}}]),e}();ObjectId.get_inc=deprecate$1((function(){return ObjectId.getInc()}),"Please use the static `ObjectId.getInc()` instead"),ObjectId.prototype.get_inc=deprecate$1((function(){return ObjectId.getInc()}),"Please use the static `ObjectId.getInc()` instead"),ObjectId.prototype.getInc=deprecate$1((function(){return ObjectId.getInc()}),"Please use the static `ObjectId.getInc()` instead"),ObjectId.prototype.generate=deprecate$1((function(e){return ObjectId.generate(e)}),"Please use the static `ObjectId.generate(time)` instead"),Object.defineProperty(ObjectId.prototype,"generationTime",{enumerable:!0,get:function(){return this.id[3]|this.id[2]<<8|this.id[1]<<16|this.id[0]<<24},set:function(e){this.id[3]=255&e,this.id[2]=e>>8&255,this.id[1]=e>>16&255,this.id[0]=e>>24&255}}),ObjectId.prototype[util.inspect.custom||"inspect"]=ObjectId.prototype.toString,ObjectId.index=~~(16777215*Math.random()),Object.defineProperty(ObjectId.prototype,"_bsontype",{value:"ObjectID"});var objectid=ObjectId;function _classCallCheck$3(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$3(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$3(e,t,n){return t&&_defineProperties$3(e.prototype,t),n&&_defineProperties$3(e,n),e}function alphabetize(e){return e.split("").sort().join("")}var BSONRegExp=function(){function e(t,n){_classCallCheck$3(this,e),this.pattern=t||"",this.options=n?alphabetize(n):"";for(var r=0;r<this.options.length;r++)if("i"!==this.options[r]&&"m"!==this.options[r]&&"x"!==this.options[r]&&"l"!==this.options[r]&&"s"!==this.options[r]&&"u"!==this.options[r])throw new Error("The regular expression option [".concat(this.options[r],"] is not supported"))}return _createClass$3(e,[{key:"toExtendedJSON",value:function(e){return(e=e||{}).legacy?{$regex:this.pattern,$options:this.options}:{$regularExpression:{pattern:this.pattern,options:this.options}}}}],[{key:"parseOptions",value:function(e){return e?e.split("").sort().join(""):""}},{key:"fromExtendedJSON",value:function(t){return t.$regex?"BSONRegExp"===t.$regex._bsontype?t:new e(t.$regex,e.parseOptions(t.$options)):new e(t.$regularExpression.pattern,e.parseOptions(t.$regularExpression.options))}}]),e}();Object.defineProperty(BSONRegExp.prototype,"_bsontype",{value:"BSONRegExp"});var regexp=BSONRegExp;function _classCallCheck$4(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$4(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$4(e,t,n){return t&&_defineProperties$4(e.prototype,t),n&&_defineProperties$4(e,n),e}var BSONSymbol=function(){function e(t){_classCallCheck$4(this,e),this.value=t}return _createClass$4(e,[{key:"valueOf",value:function(){return this.value}},{key:"toString",value:function(){return this.value}},{key:"inspect",value:function(){return this.value}},{key:"toJSON",value:function(){return this.value}},{key:"toExtendedJSON",value:function(){return{$symbol:this.value}}}],[{key:"fromExtendedJSON",value:function(t){return new e(t.$symbol)}}]),e}();Object.defineProperty(BSONSymbol.prototype,"_bsontype",{value:"Symbol"});var symbol=BSONSymbol;function _classCallCheck$5(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$5(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$5(e,t,n){return t&&_defineProperties$5(e.prototype,t),n&&_defineProperties$5(e,n),e}var Int32=function(){function e(t){_classCallCheck$5(this,e),t instanceof Number&&(t=t.valueOf()),this.value=t}return _createClass$5(e,[{key:"valueOf",value:function(){return this.value}},{key:"toJSON",value:function(){return this.value}},{key:"toExtendedJSON",value:function(e){return e&&(e.relaxed||e.legacy)?this.value:{$numberInt:this.value.toString()}}}],[{key:"fromExtendedJSON",value:function(t,n){return n&&n.relaxed?parseInt(t.$numberInt,10):new e(t.$numberInt)}}]),e}();Object.defineProperty(Int32.prototype,"_bsontype",{value:"Int32"});var int_32=Int32;function _classCallCheck$6(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$6(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$6(e,t,n){return t&&_defineProperties$6(e.prototype,t),n&&_defineProperties$6(e,n),e}var Code=function(){function e(t,n){_classCallCheck$6(this,e),this.code=t,this.scope=n}return _createClass$6(e,[{key:"toJSON",value:function(){return{scope:this.scope,code:this.code}}},{key:"toExtendedJSON",value:function(){return this.scope?{$code:this.code,$scope:this.scope}:{$code:this.code}}}],[{key:"fromExtendedJSON",value:function(t){return new e(t.$code,t.$scope)}}]),e}();Object.defineProperty(Code.prototype,"_bsontype",{value:"Code"});var code=Code,Buffer$2=buffer__WEBPACK_IMPORTED_MODULE_1___default.a.Buffer,PARSE_STRING_REGEXP=/^(\+|-)?(\d+|(\d*\.\d*))?(E|e)?([-+])?(\d+)?$/,PARSE_INF_REGEXP=/^(\+|-)?(Infinity|inf)$/i,PARSE_NAN_REGEXP=/^(\+|-)?NaN$/i,EXPONENT_MAX=6111,EXPONENT_MIN=-6176,EXPONENT_BIAS=6176,MAX_DIGITS=34,NAN_BUFFER=[124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),INF_NEGATIVE_BUFFER=[248,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),INF_POSITIVE_BUFFER=[120,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),EXPONENT_REGEX=/^([-+])?(\d+)?$/;function isDigit(e){return!isNaN(parseInt(e,10))}function divideu128(e){var t=long_1.fromNumber(1e9),n=long_1.fromNumber(0);if(!(e.parts[0]||e.parts[1]||e.parts[2]||e.parts[3]))return{quotient:e,rem:n};for(var r=0;r<=3;r++)n=(n=n.shiftLeft(32)).add(new long_1(e.parts[r],0)),e.parts[r]=n.div(t).low,n=n.modulo(t);return{quotient:e,rem:n}}function multiply64x2(e,t){if(!e&&!t)return{high:long_1.fromNumber(0),low:long_1.fromNumber(0)};var n=e.shiftRightUnsigned(32),r=new long_1(e.getLowBits(),0),i=t.shiftRightUnsigned(32),o=new long_1(t.getLowBits(),0),s=n.multiply(i),a=n.multiply(o),c=r.multiply(i),u=r.multiply(o);return s=s.add(a.shiftRightUnsigned(32)),a=new long_1(a.getLowBits(),0).add(c).add(u.shiftRightUnsigned(32)),{high:s=s.add(a.shiftRightUnsigned(32)),low:u=a.shiftLeft(32).add(new long_1(u.getLowBits(),0))}}function lessThan(e,t){var n=e.high>>>0,r=t.high>>>0;return n<r||n===r&&e.low>>>0<t.low>>>0}function invalidErr(e,t){throw new TypeError('"'.concat(e,'" is not a valid Decimal128 string - ').concat(t))}function Decimal128(e){this.bytes=e}Decimal128.fromString=function(e){var t,n=!1,r=!1,i=!1,o=0,s=0,a=0,c=0,u=0,l=[0],f=0,h=0,p=0,d=0,_=0,y=0,g=[0,0],m=[0,0],b=0;if(e.length>=7e3)throw new TypeError(e+" not a valid Decimal128 string");var v=e.match(PARSE_STRING_REGEXP),w=e.match(PARSE_INF_REGEXP),E=e.match(PARSE_NAN_REGEXP);if(!v&&!w&&!E||0===e.length)throw new TypeError(e+" not a valid Decimal128 string");if(v){var S=v[2],A=v[4],T=v[5],O=v[6];A&&void 0===O&&invalidErr(e,"missing exponent power"),A&&void 0===S&&invalidErr(e,"missing exponent base"),void 0===A&&(T||O)&&invalidErr(e,"missing e before exponent")}if("+"!==e[b]&&"-"!==e[b]||(n="-"===e[b++]),!isDigit(e[b])&&"."!==e[b]){if("i"===e[b]||"I"===e[b])return new Decimal128(Buffer$2.from(n?INF_NEGATIVE_BUFFER:INF_POSITIVE_BUFFER));if("N"===e[b])return new Decimal128(Buffer$2.from(NAN_BUFFER))}for(;isDigit(e[b])||"."===e[b];)"."!==e[b]?(f<34&&("0"!==e[b]||i)&&(i||(u=s),i=!0,l[h++]=parseInt(e[b],10),f+=1),i&&(a+=1),r&&(c+=1),s+=1,b+=1):(r&&invalidErr(e,"contains multiple periods"),r=!0,b+=1);if(r&&!s)throw new TypeError(e+" not a valid Decimal128 string");if("e"===e[b]||"E"===e[b]){var N=e.substr(++b).match(EXPONENT_REGEX);if(!N||!N[2])return new Decimal128(Buffer$2.from(NAN_BUFFER));_=parseInt(N[0],10),b+=N[0].length}if(e[b])return new Decimal128(Buffer$2.from(NAN_BUFFER));if(p=0,f){if(d=f-1,1!==(o=a))for(;"0"===e[u+o-1];)o-=1}else p=0,d=0,l[0]=0,a=1,f=1,o=0;for(_<=c&&c-_>16384?_=EXPONENT_MIN:_-=c;_>EXPONENT_MAX;){if((d+=1)-p>MAX_DIGITS){if(l.join("").match(/^0+$/)){_=EXPONENT_MAX;break}invalidErr(e,"overflow")}_-=1}for(;_<EXPONENT_MIN||f<a;){if(0===d&&o<f){_=EXPONENT_MIN,o=0;break}if(f<a?a-=1:d-=1,_<EXPONENT_MAX)_+=1;else{if(l.join("").match(/^0+$/)){_=EXPONENT_MAX;break}invalidErr(e,"overflow")}}if(d-p+1<o){var I=s;r&&(u+=1,I+=1),n&&(u+=1,I+=1);var B=parseInt(e[u+d+1],10),R=0;if(B>=5&&(R=1,5===B))for(R=l[d]%2==1,y=u+d+2;y<I;y++)if(parseInt(e[y],10)){R=1;break}if(R)for(var D=d;D>=0;D--)if(++l[D]>9&&(l[D]=0,0===D)){if(!(_<EXPONENT_MAX))return new Decimal128(Buffer$2.from(n?INF_NEGATIVE_BUFFER:INF_POSITIVE_BUFFER));_+=1,l[D]=1}}if(g=long_1.fromNumber(0),m=long_1.fromNumber(0),0===o)g=long_1.fromNumber(0),m=long_1.fromNumber(0);else if(d-p<17){var C=p;for(m=long_1.fromNumber(l[C++]),g=new long_1(0,0);C<=d;C++)m=(m=m.multiply(long_1.fromNumber(10))).add(long_1.fromNumber(l[C]))}else{var P=p;for(g=long_1.fromNumber(l[P++]);P<=d-17;P++)g=(g=g.multiply(long_1.fromNumber(10))).add(long_1.fromNumber(l[P]));for(m=long_1.fromNumber(l[P++]);P<=d;P++)m=(m=m.multiply(long_1.fromNumber(10))).add(long_1.fromNumber(l[P]))}var x=multiply64x2(g,long_1.fromString("100000000000000000"));x.low=x.low.add(m),lessThan(x.low,m)&&(x.high=x.high.add(long_1.fromNumber(1))),t=_+EXPONENT_BIAS;var L={low:long_1.fromNumber(0),high:long_1.fromNumber(0)};x.high.shiftRightUnsigned(49).and(long_1.fromNumber(1)).equals(long_1.fromNumber(1))?(L.high=L.high.or(long_1.fromNumber(3).shiftLeft(61)),L.high=L.high.or(long_1.fromNumber(t).and(long_1.fromNumber(16383).shiftLeft(47))),L.high=L.high.or(x.high.and(long_1.fromNumber(0x7fffffffffff)))):(L.high=L.high.or(long_1.fromNumber(16383&t).shiftLeft(49)),L.high=L.high.or(x.high.and(long_1.fromNumber(562949953421311)))),L.low=x.low,n&&(L.high=L.high.or(long_1.fromString("9223372036854775808")));var M=Buffer$2.alloc(16);return b=0,M[b++]=255&L.low.low,M[b++]=L.low.low>>8&255,M[b++]=L.low.low>>16&255,M[b++]=L.low.low>>24&255,M[b++]=255&L.low.high,M[b++]=L.low.high>>8&255,M[b++]=L.low.high>>16&255,M[b++]=L.low.high>>24&255,M[b++]=255&L.high.low,M[b++]=L.high.low>>8&255,M[b++]=L.high.low>>16&255,M[b++]=L.high.low>>24&255,M[b++]=255&L.high.high,M[b++]=L.high.high>>8&255,M[b++]=L.high.high>>16&255,M[b++]=L.high.high>>24&255,new Decimal128(M)};var COMBINATION_MASK=31,EXPONENT_MASK=16383,COMBINATION_INFINITY=30,COMBINATION_NAN=31;Decimal128.prototype.toString=function(){for(var e,t,n,r,i,o,s=0,a=new Array(36),c=0;c<a.length;c++)a[c]=0;var u,l,f,h,p,d=0,_=!1,y={parts:new Array(4)},g=[];d=0;var m=this.bytes;if(r=m[d++]|m[d++]<<8|m[d++]<<16|m[d++]<<24,n=m[d++]|m[d++]<<8|m[d++]<<16|m[d++]<<24,t=m[d++]|m[d++]<<8|m[d++]<<16|m[d++]<<24,e=m[d++]|m[d++]<<8|m[d++]<<16|m[d++]<<24,d=0,{low:new long_1(r,n),high:new long_1(t,e)}.high.lessThan(long_1.ZERO)&&g.push("-"),(i=e>>26&COMBINATION_MASK)>>3==3){if(i===COMBINATION_INFINITY)return g.join("")+"Infinity";if(i===COMBINATION_NAN)return"NaN";o=e>>15&EXPONENT_MASK,f=8+(e>>14&1)}else f=e>>14&7,o=e>>17&EXPONENT_MASK;if(u=o-EXPONENT_BIAS,y.parts[0]=(16383&e)+((15&f)<<14),y.parts[1]=t,y.parts[2]=n,y.parts[3]=r,0===y.parts[0]&&0===y.parts[1]&&0===y.parts[2]&&0===y.parts[3])_=!0;else for(p=3;p>=0;p--){var b=0,v=divideu128(y);if(y=v.quotient,b=v.rem.low)for(h=8;h>=0;h--)a[9*p+h]=b%10,b=Math.floor(b/10)}if(_)s=1,a[d]=0;else for(s=36;!a[d];)s-=1,d+=1;if((l=s-1+u)>=34||l<=-7||u>0){if(s>34)return g.push(0),u>0?g.push("E+"+u):u<0&&g.push("E"+u),g.join("");g.push(a[d++]),(s-=1)&&g.push(".");for(var w=0;w<s;w++)g.push(a[d++]);g.push("E"),l>0?g.push("+"+l):g.push(l)}else if(u>=0)for(var E=0;E<s;E++)g.push(a[d++]);else{var S=s+u;if(S>0)for(var A=0;A<S;A++)g.push(a[d++]);else g.push("0");for(g.push(".");S++<0;)g.push("0");for(var T=0;T<s-Math.max(S-1,0);T++)g.push(a[d++])}return g.join("")},Decimal128.prototype.toJSON=function(){return{$numberDecimal:this.toString()}},Decimal128.prototype.toExtendedJSON=function(){return{$numberDecimal:this.toString()}},Decimal128.fromExtendedJSON=function(e){return Decimal128.fromString(e.$numberDecimal)},Object.defineProperty(Decimal128.prototype,"_bsontype",{value:"Decimal128"});var decimal128=Decimal128;function _classCallCheck$7(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$7(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$7(e,t,n){return t&&_defineProperties$7(e.prototype,t),n&&_defineProperties$7(e,n),e}var MinKey=function(){function e(){_classCallCheck$7(this,e)}return _createClass$7(e,[{key:"toExtendedJSON",value:function(){return{$minKey:1}}}],[{key:"fromExtendedJSON",value:function(){return new e}}]),e}();Object.defineProperty(MinKey.prototype,"_bsontype",{value:"MinKey"});var min_key=MinKey;function _classCallCheck$8(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$8(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$8(e,t,n){return t&&_defineProperties$8(e.prototype,t),n&&_defineProperties$8(e,n),e}var MaxKey=function(){function e(){_classCallCheck$8(this,e)}return _createClass$8(e,[{key:"toExtendedJSON",value:function(){return{$maxKey:1}}}],[{key:"fromExtendedJSON",value:function(){return new e}}]),e}();Object.defineProperty(MaxKey.prototype,"_bsontype",{value:"MaxKey"});var max_key=MaxKey;function _classCallCheck$9(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$9(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$9(e,t,n){return t&&_defineProperties$9(e.prototype,t),n&&_defineProperties$9(e,n),e}var DBRef=function(){function e(t,n,r,i){_classCallCheck$9(this,e);var o=t.split(".");2===o.length&&(r=o.shift(),t=o.shift()),this.collection=t,this.oid=n,this.db=r,this.fields=i||{}}return _createClass$9(e,[{key:"toJSON",value:function(){var e=Object.assign({$ref:this.collection,$id:this.oid},this.fields);return null!=this.db&&(e.$db=this.db),e}},{key:"toExtendedJSON",value:function(e){e=e||{};var t={$ref:this.collection,$id:this.oid};return e.legacy?t:(this.db&&(t.$db=this.db),t=Object.assign(t,this.fields))}}],[{key:"fromExtendedJSON",value:function(t){var n=Object.assign({},t);return["$ref","$id","$db"].forEach((function(e){return delete n[e]})),new e(t.$ref,t.$id,t.$db,n)}}]),e}();Object.defineProperty(DBRef.prototype,"_bsontype",{value:"DBRef"}),Object.defineProperty(DBRef.prototype,"namespace",{get:function(){return this.collection},set:function(e){this.collection=e},configurable:!1});var db_ref=DBRef;function _classCallCheck$a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass$a(e,t,n){return t&&_defineProperties$a(e.prototype,t),n&&_defineProperties$a(e,n),e}var Buffer$3=buffer__WEBPACK_IMPORTED_MODULE_1___default.a.Buffer,Binary=function(){function e(t,n){if(_classCallCheck$a(this,e),!(null==t||"string"==typeof t||Buffer$3.isBuffer(t)||t instanceof Uint8Array||Array.isArray(t)))throw new TypeError("only String, Buffer, Uint8Array or Array accepted");if(this.sub_type=null==n?BSON_BINARY_SUBTYPE_DEFAULT:n,this.position=0,null==t||t instanceof Number)void 0!==Buffer$3?this.buffer=Buffer$3.alloc(e.BUFFER_SIZE):"undefined"!=typeof Uint8Array?this.buffer=new Uint8Array(new ArrayBuffer(e.BUFFER_SIZE)):this.buffer=new Array(e.BUFFER_SIZE);else{if("string"==typeof t)if(void 0!==Buffer$3)this.buffer=Buffer$3.from(t);else{if("undefined"==typeof Uint8Array&&!Array.isArray(t))throw new TypeError("only String, Buffer, Uint8Array or Array accepted");this.buffer=writeStringToArray(t)}else this.buffer=t;this.position=t.length}}return _createClass$a(e,[{key:"put",value:function(t){if(null!=t.length&&"number"!=typeof t&&1!==t.length)throw new TypeError("only accepts single character String, Uint8Array or Array");if("number"!=typeof t&&t<0||t>255)throw new TypeError("only accepts number in a valid unsigned byte range 0-255");var n=null;if(n="string"==typeof t?t.charCodeAt(0):null!=t.length?t[0]:t,this.buffer.length>this.position)this.buffer[this.position++]=n;else if(void 0!==Buffer$3&&Buffer$3.isBuffer(this.buffer)){var r=Buffer$3.alloc(e.BUFFER_SIZE+this.buffer.length);this.buffer.copy(r,0,0,this.buffer.length),this.buffer=r,this.buffer[this.position++]=n}else{var i=null;i=isUint8Array(this.buffer)?new Uint8Array(new ArrayBuffer(e.BUFFER_SIZE+this.buffer.length)):new Array(e.BUFFER_SIZE+this.buffer.length);for(var o=0;o<this.buffer.length;o++)i[o]=this.buffer[o];this.buffer=i,this.buffer[this.position++]=n}}},{key:"write",value:function(e,t){if(t="number"==typeof t?t:this.position,this.buffer.length<t+e.length){var n=null;if(void 0!==Buffer$3&&Buffer$3.isBuffer(this.buffer))n=Buffer$3.alloc(this.buffer.length+e.length),this.buffer.copy(n,0,0,this.buffer.length);else if(isUint8Array(this.buffer)){n=new Uint8Array(new ArrayBuffer(this.buffer.length+e.length));for(var r=0;r<this.position;r++)n[r]=this.buffer[r]}this.buffer=n}if(void 0!==Buffer$3&&Buffer$3.isBuffer(e)&&Buffer$3.isBuffer(this.buffer))e.copy(this.buffer,t,0,e.length),this.position=t+e.length>this.position?t+e.length:this.position;else if(void 0!==Buffer$3&&"string"==typeof e&&Buffer$3.isBuffer(this.buffer))this.buffer.write(e,t,"binary"),this.position=t+e.length>this.position?t+e.length:this.position;else if(isUint8Array(e)||Array.isArray(e)&&"string"!=typeof e){for(var i=0;i<e.length;i++)this.buffer[t++]=e[i];this.position=t>this.position?t:this.position}else if("string"==typeof e){for(var o=0;o<e.length;o++)this.buffer[t++]=e.charCodeAt(o);this.position=t>this.position?t:this.position}}},{key:"read",value:function(e,t){if(t=t&&t>0?t:this.position,this.buffer.slice)return this.buffer.slice(e,e+t);for(var n="undefined"!=typeof Uint8Array?new Uint8Array(new ArrayBuffer(t)):new Array(t),r=0;r<t;r++)n[r]=this.buffer[e++];return n}},{key:"value",value:function(e){if((e=null!=e&&e)&&void 0!==Buffer$3&&Buffer$3.isBuffer(this.buffer)&&this.buffer.length===this.position)return this.buffer;if(void 0!==Buffer$3&&Buffer$3.isBuffer(this.buffer))return e?this.buffer.slice(0,this.position):this.buffer.toString("binary",0,this.position);if(e){if(null!=this.buffer.slice)return this.buffer.slice(0,this.position);for(var t=isUint8Array(this.buffer)?new Uint8Array(new ArrayBuffer(this.position)):new Array(this.position),n=0;n<this.position;n++)t[n]=this.buffer[n];return t}return convertArraytoUtf8BinaryString(this.buffer,0,this.position)}},{key:"length",value:function(){return this.position}},{key:"toJSON",value:function(){return null!=this.buffer?this.buffer.toString("base64"):""}},{key:"toString",value:function(e){return null!=this.buffer?this.buffer.slice(0,this.position).toString(e):""}},{key:"toExtendedJSON",value:function(e){e=e||{};var t=Buffer$3.isBuffer(this.buffer)?this.buffer.toString("base64"):Buffer$3.from(this.buffer).toString("base64"),n=Number(this.sub_type).toString(16);return e.legacy?{$binary:t,$type:1===n.length?"0"+n:n}:{$binary:{base64:t,subType:1===n.length?"0"+n:n}}}}],[{key:"fromExtendedJSON",value:function(t,n){var r,i;return(n=n||{}).legacy?(i=t.$type?parseInt(t.$type,16):0,r=Buffer$3.from(t.$binary,"base64")):(i=t.$binary.subType?parseInt(t.$binary.subType,16):0,r=Buffer$3.from(t.$binary.base64,"base64")),new e(r,i)}}]),e}(),BSON_BINARY_SUBTYPE_DEFAULT=0;function isUint8Array(e){return"[object Uint8Array]"===Object.prototype.toString.call(e)}function writeStringToArray(e){for(var t="undefined"!=typeof Uint8Array?new Uint8Array(new ArrayBuffer(e.length)):new Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}function convertArraytoUtf8BinaryString(e,t,n){for(var r="",i=t;i<n;i++)r+=String.fromCharCode(e[i]);return r}Binary.BUFFER_SIZE=256,Binary.SUBTYPE_DEFAULT=0,Binary.SUBTYPE_FUNCTION=1,Binary.SUBTYPE_BYTE_ARRAY=2,Binary.SUBTYPE_UUID_OLD=3,Binary.SUBTYPE_UUID=4,Binary.SUBTYPE_MD5=5,Binary.SUBTYPE_USER_DEFINED=128,Object.defineProperty(Binary.prototype,"_bsontype",{value:"Binary"});var binary=Binary,constants={BSON_INT32_MAX:2147483647,BSON_INT32_MIN:-2147483648,BSON_INT64_MAX:Math.pow(2,63)-1,BSON_INT64_MIN:-Math.pow(2,63),JS_INT_MAX:9007199254740992,JS_INT_MIN:-9007199254740992,BSON_DATA_NUMBER:1,BSON_DATA_STRING:2,BSON_DATA_OBJECT:3,BSON_DATA_ARRAY:4,BSON_DATA_BINARY:5,BSON_DATA_UNDEFINED:6,BSON_DATA_OID:7,BSON_DATA_BOOLEAN:8,BSON_DATA_DATE:9,BSON_DATA_NULL:10,BSON_DATA_REGEXP:11,BSON_DATA_DBPOINTER:12,BSON_DATA_CODE:13,BSON_DATA_SYMBOL:14,BSON_DATA_CODE_W_SCOPE:15,BSON_DATA_INT:16,BSON_DATA_TIMESTAMP:17,BSON_DATA_LONG:18,BSON_DATA_DECIMAL128:19,BSON_DATA_MIN_KEY:255,BSON_DATA_MAX_KEY:127,BSON_BINARY_SUBTYPE_DEFAULT:0,BSON_BINARY_SUBTYPE_FUNCTION:1,BSON_BINARY_SUBTYPE_BYTE_ARRAY:2,BSON_BINARY_SUBTYPE_UUID:3,BSON_BINARY_SUBTYPE_MD5:4,BSON_BINARY_SUBTYPE_USER_DEFINED:128};function _typeof$2(e){return(_typeof$2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var keysToCodecs={$oid:objectid,$binary:binary,$symbol:symbol,$numberInt:int_32,$numberDecimal:decimal128,$numberDouble:double_1,$numberLong:long_1,$minKey:min_key,$maxKey:max_key,$regex:regexp,$regularExpression:regexp,$timestamp:timestamp};function deserializeValue(e,t,n,r){if("number"==typeof n){if(r.relaxed||r.legacy)return n;if(Math.floor(n)===n){if(n>=BSON_INT32_MIN&&n<=BSON_INT32_MAX)return new int_32(n);if(n>=BSON_INT64_MIN&&n<=BSON_INT64_MAX)return new long_1.fromNumber(n)}return new double_1(n)}if(null==n||"object"!==_typeof$2(n))return n;if(n.$undefined)return null;for(var i=Object.keys(n).filter((function(e){return e.startsWith("$")&&null!=n[e]})),o=0;o<i.length;o++){var s=keysToCodecs[i[o]];if(s)return s.fromExtendedJSON(n,r)}if(null!=n.$date){var a=n.$date,c=new Date;return r.legacy?"number"==typeof a?c.setTime(a):"string"==typeof a&&c.setTime(Date.parse(a)):"string"==typeof a?c.setTime(Date.parse(a)):long_1.isLong(a)?c.setTime(a.toNumber()):"number"==typeof a&&r.relaxed&&c.setTime(a),c}if(null!=n.$code){var u=Object.assign({},n);return n.$scope&&(u.$scope=deserializeValue(e,null,n.$scope)),code.fromExtendedJSON(n)}if(null!=n.$ref||null!=n.$dbPointer){var l=n.$ref?n:n.$dbPointer;if(l instanceof db_ref)return l;var f=Object.keys(l).filter((function(e){return e.startsWith("$")})),h=!0;if(f.forEach((function(e){-1===["$ref","$id","$db"].indexOf(e)&&(h=!1)})),h)return db_ref.fromExtendedJSON(l)}return n}function parse(e,t){var n=this;return"boolean"==typeof(t=Object.assign({},{relaxed:!0,legacy:!1},t)).relaxed&&(t.strict=!t.relaxed),"boolean"==typeof t.strict&&(t.relaxed=!t.strict),JSON.parse(e,(function(e,r){return deserializeValue(n,e,r,t)}))}var BSON_INT32_MAX=2147483647,BSON_INT32_MIN=-2147483648,BSON_INT64_MAX=0x8000000000000000,BSON_INT64_MIN=-0x8000000000000000;function stringify(e,t,n,r){null!=n&&"object"===_typeof$2(n)&&(r=n,n=0),null==t||"object"!==_typeof$2(t)||Array.isArray(t)||(r=t,t=null,n=0),r=Object.assign({},{relaxed:!0,legacy:!1},r);var i=Array.isArray(e)?serializeArray(e,r):serializeDocument(e,r);return JSON.stringify(i,t,n)}function serialize(e,t){return t=t||{},JSON.parse(stringify(e,t))}function deserialize(e,t){return t=t||{},parse(JSON.stringify(e),t)}function serializeArray(e,t){return e.map((function(e){return serializeValue(e,t)}))}function getISOString(e){var t=e.toISOString();return 0!==e.getUTCMilliseconds()?t:t.slice(0,-5)+"Z"}function serializeValue(e,t){if(Array.isArray(e))return serializeArray(e,t);if(void 0===e)return null;if(e instanceof Date){var n=e.getTime(),r=n>-1&&n<2534023188e5;return t.legacy?t.relaxed&&r?{$date:e.getTime()}:{$date:getISOString(e)}:t.relaxed&&r?{$date:getISOString(e)}:{$date:{$numberLong:e.getTime().toString()}}}if("number"==typeof e&&!t.relaxed){if(Math.floor(e)===e){var i=e>=BSON_INT64_MIN&&e<=BSON_INT64_MAX;if(e>=BSON_INT32_MIN&&e<=BSON_INT32_MAX)return{$numberInt:e.toString()};if(i)return{$numberLong:e.toString()}}return{$numberDouble:e.toString()}}if(e instanceof RegExp){var o=e.flags;return void 0===o&&(o=e.toString().match(/[gimuy]*$/)[0]),new regexp(e.source,o).toExtendedJSON(t)}return null!=e&&"object"===_typeof$2(e)?serializeDocument(e,t):e}var BSON_TYPE_MAPPINGS={Binary:function(e){return new binary(e.value(),e.subtype)},Code:function(e){return new code(e.code,e.scope)},DBRef:function(e){return new db_ref(e.collection||e.namespace,e.oid,e.db,e.fields)},Decimal128:function(e){return new decimal128(e.bytes)},Double:function(e){return new double_1(e.value)},Int32:function(e){return new int_32(e.value)},Long:function(e){return long_1.fromBits(null!=e.low?e.low:e.low_,null!=e.low?e.high:e.high_,null!=e.low?e.unsigned:e.unsigned_)},MaxKey:function(){return new max_key},MinKey:function(){return new min_key},ObjectID:function(e){return new objectid(e)},ObjectId:function(e){return new objectid(e)},BSONRegExp:function(e){return new regexp(e.pattern,e.options)},Symbol:function(e){return new symbol(e.value)},Timestamp:function(e){return timestamp.fromBits(e.low,e.high)}};function serializeDocument(e,t){if(null==e||"object"!==_typeof$2(e))throw new Error("not an object instance");var n=e._bsontype;if(void 0===n){var r={};for(var i in e)r[i]=serializeValue(e[i],t);return r}if("string"==typeof n){var o=e;if("function"!=typeof o.toExtendedJSON){var s=BSON_TYPE_MAPPINGS[n];if(!s)throw new TypeError("Unrecognized or invalid _bsontype: "+n);o=s(o)}return"Code"===n&&o.scope?o=new code(o.code,serializeValue(o.scope,t)):"DBRef"===n&&o.oid&&(o=new db_ref(o.collection,serializeValue(o.oid,t),o.db,o.fields)),o.toExtendedJSON(t)}throw new Error("_bsontype must be a string, but was: "+_typeof$2(n))}var extended_json={parse:parse,deserialize:deserialize,serialize:serialize,stringify:stringify},FIRST_BIT=128,FIRST_TWO_BITS=192,FIRST_THREE_BITS=224,FIRST_FOUR_BITS=240,FIRST_FIVE_BITS=248,TWO_BIT_CHAR=192,THREE_BIT_CHAR=224,FOUR_BIT_CHAR=240,CONTINUING_CHAR=128;function validateUtf8(e,t,n){for(var r=0,i=t;i<n;i+=1){var o=e[i];if(r){if((o&FIRST_TWO_BITS)!==CONTINUING_CHAR)return!1;r-=1}else if(o&FIRST_BIT)if((o&FIRST_THREE_BITS)===TWO_BIT_CHAR)r=1;else if((o&FIRST_FOUR_BITS)===THREE_BIT_CHAR)r=2;else{if((o&FIRST_FIVE_BITS)!==FOUR_BIT_CHAR)return!1;r=3}}return!r}var validateUtf8_1=validateUtf8,validate_utf8={validateUtf8:validateUtf8_1},Buffer$4=buffer__WEBPACK_IMPORTED_MODULE_1___default.a.Buffer,validateUtf8$1=validate_utf8.validateUtf8,JS_INT_MAX_LONG=long_1.fromNumber(constants.JS_INT_MAX),JS_INT_MIN_LONG=long_1.fromNumber(constants.JS_INT_MIN),functionCache={};function deserialize$1(e,t,n){var r=(t=null==t?{}:t)&&t.index?t.index:0,i=e[r]|e[r+1]<<8|e[r+2]<<16|e[r+3]<<24;if(i<5)throw new Error("bson size must be >= 5, is ".concat(i));if(t.allowObjectSmallerThanBufferSize&&e.length<i)throw new Error("buffer length ".concat(e.length," must be >= bson size ").concat(i));if(!t.allowObjectSmallerThanBufferSize&&e.length!==i)throw new Error("buffer length ".concat(e.length," must === bson size ").concat(i));if(i+r>e.length)throw new Error("(bson size ".concat(i," + options.index ").concat(r," must be <= buffer length ").concat(Buffer$4.byteLength(e),")"));if(0!==e[r+i-1])throw new Error("One object, sized correctly, with a spot for an EOO, but the EOO isn't 0x00");return deserializeObject(e,r,t,n)}function deserializeObject(e,t,n,r){var i=null!=n.evalFunctions&&n.evalFunctions,o=null!=n.cacheFunctions&&n.cacheFunctions,s=null!=n.cacheFunctionsCrc32&&n.cacheFunctionsCrc32;if(!s)var a=null;var c=null==n.fieldsAsRaw?null:n.fieldsAsRaw,u=null!=n.raw&&n.raw,l="boolean"==typeof n.bsonRegExp&&n.bsonRegExp,f=null!=n.promoteBuffers&&n.promoteBuffers,h=null==n.promoteLongs||n.promoteLongs,p=null==n.promoteValues||n.promoteValues,d=t;if(e.length<5)throw new Error("corrupt bson message < 5 bytes long");var _=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;if(_<5||_>e.length)throw new Error("corrupt bson message");for(var y=r?[]:{},g=0;;){var m=e[t++];if(0===m)break;for(var b=t;0!==e[b]&&b<e.length;)b++;if(b>=Buffer$4.byteLength(e))throw new Error("Bad BSON Document: illegal CString");var v=r?g++:e.toString("utf8",t,b);if(t=b+1,m===constants.BSON_DATA_STRING){var w=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;if(w<=0||w>e.length-t||0!==e[t+w-1])throw new Error("bad string length in bson");if(!validateUtf8$1(e,t,t+w-1))throw new Error("Invalid UTF-8 string in BSON document");var E=e.toString("utf8",t,t+w-1);y[v]=E,t+=w}else if(m===constants.BSON_DATA_OID){var S=Buffer$4.alloc(12);e.copy(S,0,t,t+12),y[v]=new objectid(S),t+=12}else if(m===constants.BSON_DATA_INT&&!1===p)y[v]=new int_32(e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24);else if(m===constants.BSON_DATA_INT)y[v]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;else if(m===constants.BSON_DATA_NUMBER&&!1===p)y[v]=new double_1(e.readDoubleLE(t)),t+=8;else if(m===constants.BSON_DATA_NUMBER)y[v]=e.readDoubleLE(t),t+=8;else if(m===constants.BSON_DATA_DATE){var A=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,T=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;y[v]=new Date(new long_1(A,T).toNumber())}else if(m===constants.BSON_DATA_BOOLEAN){if(0!==e[t]&&1!==e[t])throw new Error("illegal boolean type value");y[v]=1===e[t++]}else if(m===constants.BSON_DATA_OBJECT){var O=t,N=e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24;if(N<=0||N>e.length-t)throw new Error("bad embedded document length in bson");y[v]=u?e.slice(t,t+N):deserializeObject(e,O,n,!1),t+=N}else if(m===constants.BSON_DATA_ARRAY){var I=t,B=e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24,R=n,D=t+B;if(c&&c[v]){for(var C in R={},n)R[C]=n[C];R.raw=!0}if(y[v]=deserializeObject(e,I,R,!0),0!==e[(t+=B)-1])throw new Error("invalid array terminator byte");if(t!==D)throw new Error("corrupted array bson")}else if(m===constants.BSON_DATA_UNDEFINED)y[v]=void 0;else if(m===constants.BSON_DATA_NULL)y[v]=null;else if(m===constants.BSON_DATA_LONG){var P=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,x=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,L=new long_1(P,x);y[v]=h&&!0===p&&L.lessThanOrEqual(JS_INT_MAX_LONG)&&L.greaterThanOrEqual(JS_INT_MIN_LONG)?L.toNumber():L}else if(m===constants.BSON_DATA_DECIMAL128){var M=Buffer$4.alloc(16);e.copy(M,0,t,t+16),t+=16;var k=new decimal128(M);y[v]=k.toObject?k.toObject():k}else if(m===constants.BSON_DATA_BINARY){var j=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,$=j,U=e[t++];if(j<0)throw new Error("Negative binary type element size found");if(j>Buffer$4.byteLength(e))throw new Error("Binary type size larger than document size");if(null!=e.slice){if(U===binary.SUBTYPE_BYTE_ARRAY){if((j=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24)<0)throw new Error("Negative binary type element size found for subtype 0x02");if(j>$-4)throw new Error("Binary type with subtype 0x02 contains to long binary size");if(j<$-4)throw new Error("Binary type with subtype 0x02 contains to short binary size")}y[v]=f&&p?e.slice(t,t+j):new binary(e.slice(t,t+j),U)}else{var q="undefined"!=typeof Uint8Array?new Uint8Array(new ArrayBuffer(j)):new Array(j);if(U===binary.SUBTYPE_BYTE_ARRAY){if((j=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24)<0)throw new Error("Negative binary type element size found for subtype 0x02");if(j>$-4)throw new Error("Binary type with subtype 0x02 contains to long binary size");if(j<$-4)throw new Error("Binary type with subtype 0x02 contains to short binary size")}for(b=0;b<j;b++)q[b]=e[t+b];y[v]=f&&p?q:new binary(q,U)}t+=j}else if(m===constants.BSON_DATA_REGEXP&&!1===l){for(b=t;0!==e[b]&&b<e.length;)b++;if(b>=e.length)throw new Error("Bad BSON Document: illegal CString");var F=e.toString("utf8",t,b);for(b=t=b+1;0!==e[b]&&b<e.length;)b++;if(b>=e.length)throw new Error("Bad BSON Document: illegal CString");var z=e.toString("utf8",t,b);t=b+1;var W=new Array(z.length);for(b=0;b<z.length;b++)switch(z[b]){case"m":W[b]="m";break;case"s":W[b]="g";break;case"i":W[b]="i"}y[v]=new RegExp(F,W.join(""))}else if(m===constants.BSON_DATA_REGEXP&&!0===l){for(b=t;0!==e[b]&&b<e.length;)b++;if(b>=e.length)throw new Error("Bad BSON Document: illegal CString");var G=e.toString("utf8",t,b);for(b=t=b+1;0!==e[b]&&b<e.length;)b++;if(b>=e.length)throw new Error("Bad BSON Document: illegal CString");var Y=e.toString("utf8",t,b);t=b+1,y[v]=new regexp(G,Y)}else if(m===constants.BSON_DATA_SYMBOL){var K=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;if(K<=0||K>e.length-t||0!==e[t+K-1])throw new Error("bad string length in bson");y[v]=e.toString("utf8",t,t+K-1),t+=K}else if(m===constants.BSON_DATA_TIMESTAMP){var H=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,J=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;y[v]=new timestamp(H,J)}else if(m===constants.BSON_DATA_MIN_KEY)y[v]=new min_key;else if(m===constants.BSON_DATA_MAX_KEY)y[v]=new max_key;else if(m===constants.BSON_DATA_CODE){var V=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;if(V<=0||V>e.length-t||0!==e[t+V-1])throw new Error("bad string length in bson");var X=e.toString("utf8",t,t+V-1);if(i)if(o){var Q=s?a(X):X;y[v]=isolateEvalWithHash(functionCache,Q,X,y)}else y[v]=isolateEval(X);else y[v]=new code(X);t+=V}else if(m===constants.BSON_DATA_CODE_W_SCOPE){var Z=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;if(Z<13)throw new Error("code_w_scope total size shorter minimum expected length");var ee=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;if(ee<=0||ee>e.length-t||0!==e[t+ee-1])throw new Error("bad string length in bson");var te=e.toString("utf8",t,t+ee-1),ne=t+=ee,re=e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24,ie=deserializeObject(e,ne,n,!1);if(t+=re,Z<8+re+ee)throw new Error("code_w_scope total size is to short, truncating scope");if(Z>8+re+ee)throw new Error("code_w_scope total size is to long, clips outer document");if(i){if(o){var oe=s?a(te):te;y[v]=isolateEvalWithHash(functionCache,oe,te,y)}else y[v]=isolateEval(te);y[v].scope=ie}else y[v]=new code(te,ie)}else{if(m!==constants.BSON_DATA_DBPOINTER)throw new Error("Detected unknown BSON type "+m.toString(16)+' for fieldname "'+v+'", are you using the latest BSON parser?');var se=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;if(se<=0||se>e.length-t||0!==e[t+se-1])throw new Error("bad string length in bson");if(!validateUtf8$1(e,t,t+se-1))throw new Error("Invalid UTF-8 string in BSON document");var ae=e.toString("utf8",t,t+se-1);t+=se;var ce=Buffer$4.alloc(12);e.copy(ce,0,t,t+12);var ue=new objectid(ce);t+=12,y[v]=new db_ref(ae,ue)}}if(_!==t-d){if(r)throw new Error("corrupt array bson");throw new Error("corrupt object bson")}var le=Object.keys(y).filter((function(e){return e.startsWith("$")})),fe=!0;if(le.forEach((function(e){-1===["$ref","$id","$db"].indexOf(e)&&(fe=!1)})),!fe)return y;if(null!=y.$id&&null!=y.$ref){var he=Object.assign({},y);return delete he.$ref,delete he.$id,delete he.$db,new db_ref(y.$ref,y.$id,y.$db||null,he)}return y}function isolateEvalWithHash(functionCache,hash,functionString,object){var value=null;return null==functionCache[hash]&&(eval("value = "+functionString),functionCache[hash]=value),functionCache[hash].bind(object)}function isolateEval(functionString){var value=null;return eval("value = "+functionString),value}var deserializer=deserialize$1;function readIEEE754(e,t,n,r,i){var o,s,a="big"===n,c=8*i-r-1,u=(1<<c)-1,l=u>>1,f=-7,h=a?0:i-1,p=a?1:-1,d=e[t+h];for(h+=p,o=d&(1<<-f)-1,d>>=-f,f+=c;f>0;o=256*o+e[t+h],h+=p,f-=8);for(s=o&(1<<-f)-1,o>>=-f,f+=r;f>0;s=256*s+e[t+h],h+=p,f-=8);if(0===o)o=1-l;else{if(o===u)return s?NaN:1/0*(d?-1:1);s+=Math.pow(2,r),o-=l}return(d?-1:1)*s*Math.pow(2,o-r)}function writeIEEE754(e,t,n,r,i,o){var s,a,c,u="big"===r,l=8*o-i-1,f=(1<<l)-1,h=f>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=u?o-1:0,_=u?-1:1,y=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=f):(s=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-s))<1&&(s--,c*=2),(t+=s+h>=1?p/c:p*Math.pow(2,1-h))*c>=2&&(s++,c/=2),s+h>=f?(a=0,s=f):s+h>=1?(a=(t*c-1)*Math.pow(2,i),s+=h):(a=t*Math.pow(2,h-1)*Math.pow(2,i),s=0)),isNaN(t)&&(a=0);i>=8;)e[n+d]=255&a,d+=_,a/=256,i-=8;for(s=s<<i|a,isNaN(t)&&(s+=8),l+=i;l>0;)e[n+d]=255&s,d+=_,s/=256,l-=8;e[n+d-_]|=128*y}var float_parser={readIEEE754:readIEEE754,writeIEEE754:writeIEEE754};function _typeof$3(e){return(_typeof$3="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var Buffer$5=buffer__WEBPACK_IMPORTED_MODULE_1___default.a.Buffer,writeIEEE754$1=float_parser.writeIEEE754,normalizedFunctionString$1=utils.normalizedFunctionString,regexp$1=/\x00/,ignoreKeys=new Set(["$db","$ref","$id","$clusterTime"]),isDate$1=function(e){return"object"===_typeof$3(e)&&"[object Date]"===Object.prototype.toString.call(e)},isRegExp$1=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)};function serializeString(e,t,n,r,i){e[r++]=constants.BSON_DATA_STRING;var o=i?e.write(t,r,"ascii"):e.write(t,r,"utf8");e[(r=r+o+1)-1]=0;var s=e.write(n,r+4,"utf8");return e[r+3]=s+1>>24&255,e[r+2]=s+1>>16&255,e[r+1]=s+1>>8&255,e[r]=s+1&255,r=r+4+s,e[r++]=0,r}function serializeNumber(e,t,n,r,i){if(Math.floor(n)===n&&n>=constants.JS_INT_MIN&&n<=constants.JS_INT_MAX)if(n>=constants.BSON_INT32_MIN&&n<=constants.BSON_INT32_MAX)e[r++]=constants.BSON_DATA_INT,r+=i?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0,e[r++]=255&n,e[r++]=n>>8&255,e[r++]=n>>16&255,e[r++]=n>>24&255;else if(n>=constants.JS_INT_MIN&&n<=constants.JS_INT_MAX){e[r++]=constants.BSON_DATA_NUMBER,r+=i?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0,writeIEEE754$1(e,n,r,"little",52,8),r+=8}else{e[r++]=constants.BSON_DATA_LONG,r+=i?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0;var o=long_1.fromNumber(n),s=o.getLowBits(),a=o.getHighBits();e[r++]=255&s,e[r++]=s>>8&255,e[r++]=s>>16&255,e[r++]=s>>24&255,e[r++]=255&a,e[r++]=a>>8&255,e[r++]=a>>16&255,e[r++]=a>>24&255}else e[r++]=constants.BSON_DATA_NUMBER,r+=i?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0,writeIEEE754$1(e,n,r,"little",52,8),r+=8;return r}function serializeNull(e,t,n,r,i){return e[r++]=constants.BSON_DATA_NULL,r+=i?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0,r}function serializeBoolean(e,t,n,r,i){return e[r++]=constants.BSON_DATA_BOOLEAN,r+=i?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0,e[r++]=n?1:0,r}function serializeDate(e,t,n,r,i){e[r++]=constants.BSON_DATA_DATE,r+=i?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0;var o=long_1.fromNumber(n.getTime()),s=o.getLowBits(),a=o.getHighBits();return e[r++]=255&s,e[r++]=s>>8&255,e[r++]=s>>16&255,e[r++]=s>>24&255,e[r++]=255&a,e[r++]=a>>8&255,e[r++]=a>>16&255,e[r++]=a>>24&255,r}function serializeRegExp(e,t,n,r,i){if(e[r++]=constants.BSON_DATA_REGEXP,r+=i?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0,n.source&&null!=n.source.match(regexp$1))throw Error("value "+n.source+" must not contain null bytes");return r+=e.write(n.source,r,"utf8"),e[r++]=0,n.ignoreCase&&(e[r++]=105),n.global&&(e[r++]=115),n.multiline&&(e[r++]=109),e[r++]=0,r}function serializeBSONRegExp(e,t,n,r,i){if(e[r++]=constants.BSON_DATA_REGEXP,r+=i?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0,null!=n.pattern.match(regexp$1))throw Error("pattern "+n.pattern+" must not contain null bytes");return r+=e.write(n.pattern,r,"utf8"),e[r++]=0,r+=e.write(n.options.split("").sort().join(""),r,"utf8"),e[r++]=0,r}function serializeMinMax(e,t,n,r,i){return null===n?e[r++]=constants.BSON_DATA_NULL:"MinKey"===n._bsontype?e[r++]=constants.BSON_DATA_MIN_KEY:e[r++]=constants.BSON_DATA_MAX_KEY,r+=i?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0,r}function serializeObjectId(e,t,n,r,i){if(e[r++]=constants.BSON_DATA_OID,r+=i?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0,"string"==typeof n.id)e.write(n.id,r,"binary");else{if(!n.id||!n.id.copy)throw new TypeError("object ["+JSON.stringify(n)+"] is not a valid ObjectId");n.id.copy(e,r,0,12)}return r+12}function serializeBuffer(e,t,n,r,i){e[r++]=constants.BSON_DATA_BINARY,r+=i?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0;var o=n.length;return e[r++]=255&o,e[r++]=o>>8&255,e[r++]=o>>16&255,e[r++]=o>>24&255,e[r++]=constants.BSON_BINARY_SUBTYPE_DEFAULT,n.copy(e,r,0,o),r+=o}function serializeObject(e,t,n,r,i,o,s,a,c,u){for(var l=0;l<u.length;l++)if(u[l]===n)throw new Error("cyclic dependency detected");u.push(n),e[r++]=Array.isArray(n)?constants.BSON_DATA_ARRAY:constants.BSON_DATA_OBJECT,r+=c?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0;var f=serializeInto(e,n,i,r,o+1,s,a,u);return u.pop(),f}function serializeDecimal128(e,t,n,r,i){return e[r++]=constants.BSON_DATA_DECIMAL128,r+=i?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0,n.bytes.copy(e,r,0,16),r+16}function serializeLong(e,t,n,r,i){e[r++]="Long"===n._bsontype?constants.BSON_DATA_LONG:constants.BSON_DATA_TIMESTAMP,r+=i?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0;var o=n.getLowBits(),s=n.getHighBits();return e[r++]=255&o,e[r++]=o>>8&255,e[r++]=o>>16&255,e[r++]=o>>24&255,e[r++]=255&s,e[r++]=s>>8&255,e[r++]=s>>16&255,e[r++]=s>>24&255,r}function serializeInt32(e,t,n,r,i){return e[r++]=constants.BSON_DATA_INT,r+=i?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0,e[r++]=255&n,e[r++]=n>>8&255,e[r++]=n>>16&255,e[r++]=n>>24&255,r}function serializeDouble(e,t,n,r,i){return e[r++]=constants.BSON_DATA_NUMBER,r+=i?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0,writeIEEE754$1(e,n.value,r,"little",52,8),r+=8}function serializeFunction(e,t,n,r,i,o,s){e[r++]=constants.BSON_DATA_CODE,r+=s?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0;var a=normalizedFunctionString$1(n),c=e.write(a,r+4,"utf8")+1;return e[r]=255&c,e[r+1]=c>>8&255,e[r+2]=c>>16&255,e[r+3]=c>>24&255,r=r+4+c-1,e[r++]=0,r}function serializeCode(e,t,n,r,i,o,s,a,c){if(n.scope&&"object"===_typeof$3(n.scope)){e[r++]=constants.BSON_DATA_CODE_W_SCOPE,r+=c?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0;var u=r,l="string"==typeof n.code?n.code:n.code.toString();r+=4;var f=e.write(l,r+4,"utf8")+1;e[r]=255&f,e[r+1]=f>>8&255,e[r+2]=f>>16&255,e[r+3]=f>>24&255,e[r+4+f-1]=0,r=r+f+4;var h=serializeInto(e,n.scope,i,r,o+1,s,a);r=h-1;var p=h-u;e[u++]=255&p,e[u++]=p>>8&255,e[u++]=p>>16&255,e[u++]=p>>24&255,e[r++]=0}else{e[r++]=constants.BSON_DATA_CODE,r+=c?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0;var d=n.code.toString(),_=e.write(d,r+4,"utf8")+1;e[r]=255&_,e[r+1]=_>>8&255,e[r+2]=_>>16&255,e[r+3]=_>>24&255,r=r+4+_-1,e[r++]=0}return r}function serializeBinary(e,t,n,r,i){e[r++]=constants.BSON_DATA_BINARY,r+=i?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0;var o=n.value(!0),s=n.position;return n.sub_type===binary.SUBTYPE_BYTE_ARRAY&&(s+=4),e[r++]=255&s,e[r++]=s>>8&255,e[r++]=s>>16&255,e[r++]=s>>24&255,e[r++]=n.sub_type,n.sub_type===binary.SUBTYPE_BYTE_ARRAY&&(s-=4,e[r++]=255&s,e[r++]=s>>8&255,e[r++]=s>>16&255,e[r++]=s>>24&255),o.copy(e,r,0,n.position),r+=n.position}function serializeSymbol(e,t,n,r,i){e[r++]=constants.BSON_DATA_SYMBOL,r+=i?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0;var o=e.write(n.value,r+4,"utf8")+1;return e[r]=255&o,e[r+1]=o>>8&255,e[r+2]=o>>16&255,e[r+3]=o>>24&255,r=r+4+o-1,e[r++]=0,r}function serializeDBRef(e,t,n,r,i,o,s){e[r++]=constants.BSON_DATA_OBJECT,r+=s?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0;var a,c=r,u={$ref:n.collection||n.namespace,$id:n.oid};null!=n.db&&(u.$db=n.db);var l=(a=serializeInto(e,u=Object.assign(u,n.fields),!1,r,i+1,o))-c;return e[c++]=255&l,e[c++]=l>>8&255,e[c++]=l>>16&255,e[c++]=l>>24&255,a}function serializeInto(e,t,n,r,i,o,s,a){r=r||0,(a=a||[]).push(t);var c=r+4;if(Array.isArray(t))for(var u=0;u<t.length;u++){var l=""+u,f=t[u];if(f&&f.toBSON){if("function"!=typeof f.toBSON)throw new TypeError("toBSON is not a function");f=f.toBSON()}var h=_typeof$3(f);if("string"===h)c=serializeString(e,l,f,c,!0);else if("number"===h)c=serializeNumber(e,l,f,c,!0);else if("boolean"===h)c=serializeBoolean(e,l,f,c,!0);else if(f instanceof Date||isDate$1(f))c=serializeDate(e,l,f,c,!0);else if(void 0===f)c=serializeNull(e,l,f,c,!0);else if(null===f)c=serializeNull(e,l,f,c,!0);else if("ObjectId"===f._bsontype||"ObjectID"===f._bsontype)c=serializeObjectId(e,l,f,c,!0);else if(Buffer$5.isBuffer(f))c=serializeBuffer(e,l,f,c,!0);else if(f instanceof RegExp||isRegExp$1(f))c=serializeRegExp(e,l,f,c,!0);else if("object"===h&&null==f._bsontype)c=serializeObject(e,l,f,c,n,i,o,s,!0,a);else if("object"===h&&"Decimal128"===f._bsontype)c=serializeDecimal128(e,l,f,c,!0);else if("Long"===f._bsontype||"Timestamp"===f._bsontype)c=serializeLong(e,l,f,c,!0);else if("Double"===f._bsontype)c=serializeDouble(e,l,f,c,!0);else if("function"==typeof f&&o)c=serializeFunction(e,l,f,c,n,i,o,!0);else if("Code"===f._bsontype)c=serializeCode(e,l,f,c,n,i,o,s,!0);else if("Binary"===f._bsontype)c=serializeBinary(e,l,f,c,!0);else if("Symbol"===f._bsontype)c=serializeSymbol(e,l,f,c,!0);else if("DBRef"===f._bsontype)c=serializeDBRef(e,l,f,c,i,o,!0);else if("BSONRegExp"===f._bsontype)c=serializeBSONRegExp(e,l,f,c,!0);else if("Int32"===f._bsontype)c=serializeInt32(e,l,f,c,!0);else if("MinKey"===f._bsontype||"MaxKey"===f._bsontype)c=serializeMinMax(e,l,f,c,!0);else if(void 0!==f._bsontype)throw new TypeError("Unrecognized or invalid _bsontype: "+f._bsontype)}else if(t instanceof map)for(var p=t.entries(),d=!1;!d;){var _=p.next();if(!(d=_.done)){var y=_.value[0],g=_.value[1],m=_typeof$3(g);if("string"==typeof y&&!ignoreKeys.has(y)){if(null!=y.match(regexp$1))throw Error("key "+y+" must not contain null bytes");if(n){if("$"===y[0])throw Error("key "+y+" must not start with '$'");if(~y.indexOf("."))throw Error("key "+y+" must not contain '.'")}}if("string"===m)c=serializeString(e,y,g,c);else if("number"===m)c=serializeNumber(e,y,g,c);else if("boolean"===m)c=serializeBoolean(e,y,g,c);else if(g instanceof Date||isDate$1(g))c=serializeDate(e,y,g,c);else if(null===g||void 0===g&&!1===s)c=serializeNull(e,y,g,c);else if("ObjectId"===g._bsontype||"ObjectID"===g._bsontype)c=serializeObjectId(e,y,g,c);else if(Buffer$5.isBuffer(g))c=serializeBuffer(e,y,g,c);else if(g instanceof RegExp||isRegExp$1(g))c=serializeRegExp(e,y,g,c);else if("object"===m&&null==g._bsontype)c=serializeObject(e,y,g,c,n,i,o,s,!1,a);else if("object"===m&&"Decimal128"===g._bsontype)c=serializeDecimal128(e,y,g,c);else if("Long"===g._bsontype||"Timestamp"===g._bsontype)c=serializeLong(e,y,g,c);else if("Double"===g._bsontype)c=serializeDouble(e,y,g,c);else if("Code"===g._bsontype)c=serializeCode(e,y,g,c,n,i,o,s);else if("function"==typeof g&&o)c=serializeFunction(e,y,g,c,n,i,o);else if("Binary"===g._bsontype)c=serializeBinary(e,y,g,c);else if("Symbol"===g._bsontype)c=serializeSymbol(e,y,g,c);else if("DBRef"===g._bsontype)c=serializeDBRef(e,y,g,c,i,o);else if("BSONRegExp"===g._bsontype)c=serializeBSONRegExp(e,y,g,c);else if("Int32"===g._bsontype)c=serializeInt32(e,y,g,c);else if("MinKey"===g._bsontype||"MaxKey"===g._bsontype)c=serializeMinMax(e,y,g,c);else if(void 0!==g._bsontype)throw new TypeError("Unrecognized or invalid _bsontype: "+g._bsontype)}}else{if(t.toBSON){if("function"!=typeof t.toBSON)throw new TypeError("toBSON is not a function");if(null!=(t=t.toBSON())&&"object"!==_typeof$3(t))throw new TypeError("toBSON function did not return an object")}for(var b in t){var v=t[b];if(v&&v.toBSON){if("function"!=typeof v.toBSON)throw new TypeError("toBSON is not a function");v=v.toBSON()}var w=_typeof$3(v);if("string"==typeof b&&!ignoreKeys.has(b)){if(null!=b.match(regexp$1))throw Error("key "+b+" must not contain null bytes");if(n){if("$"===b[0])throw Error("key "+b+" must not start with '$'");if(~b.indexOf("."))throw Error("key "+b+" must not contain '.'")}}if("string"===w)c=serializeString(e,b,v,c);else if("number"===w)c=serializeNumber(e,b,v,c);else if("boolean"===w)c=serializeBoolean(e,b,v,c);else if(v instanceof Date||isDate$1(v))c=serializeDate(e,b,v,c);else if(void 0===v)!1===s&&(c=serializeNull(e,b,v,c));else if(null===v)c=serializeNull(e,b,v,c);else if("ObjectId"===v._bsontype||"ObjectID"===v._bsontype)c=serializeObjectId(e,b,v,c);else if(Buffer$5.isBuffer(v))c=serializeBuffer(e,b,v,c);else if(v instanceof RegExp||isRegExp$1(v))c=serializeRegExp(e,b,v,c);else if("object"===w&&null==v._bsontype)c=serializeObject(e,b,v,c,n,i,o,s,!1,a);else if("object"===w&&"Decimal128"===v._bsontype)c=serializeDecimal128(e,b,v,c);else if("Long"===v._bsontype||"Timestamp"===v._bsontype)c=serializeLong(e,b,v,c);else if("Double"===v._bsontype)c=serializeDouble(e,b,v,c);else if("Code"===v._bsontype)c=serializeCode(e,b,v,c,n,i,o,s);else if("function"==typeof v&&o)c=serializeFunction(e,b,v,c,n,i,o);else if("Binary"===v._bsontype)c=serializeBinary(e,b,v,c);else if("Symbol"===v._bsontype)c=serializeSymbol(e,b,v,c);else if("DBRef"===v._bsontype)c=serializeDBRef(e,b,v,c,i,o);else if("BSONRegExp"===v._bsontype)c=serializeBSONRegExp(e,b,v,c);else if("Int32"===v._bsontype)c=serializeInt32(e,b,v,c);else if("MinKey"===v._bsontype||"MaxKey"===v._bsontype)c=serializeMinMax(e,b,v,c);else if(void 0!==v._bsontype)throw new TypeError("Unrecognized or invalid _bsontype: "+v._bsontype)}}a.pop(),e[c++]=0;var E=c-r;return e[r++]=255&E,e[r++]=E>>8&255,e[r++]=E>>16&255,e[r++]=E>>24&255,c}var serializer=serializeInto;function _typeof$4(e){return(_typeof$4="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var Buffer$6=buffer__WEBPACK_IMPORTED_MODULE_1___default.a.Buffer,normalizedFunctionString$2=utils.normalizedFunctionString;function isDate$2(e){return"object"===_typeof$4(e)&&"[object Date]"===Object.prototype.toString.call(e)}function calculateObjectSize(e,t,n){var r=5;if(Array.isArray(e))for(var i=0;i<e.length;i++)r+=calculateElement(i.toString(),e[i],t,!0,n);else for(var o in e.toBSON&&(e=e.toBSON()),e)r+=calculateElement(o,e[o],t,!1,n);return r}function calculateElement(e,t,n,r,i){switch(t&&t.toBSON&&(t=t.toBSON()),_typeof$4(t)){case"string":return 1+Buffer$6.byteLength(e,"utf8")+1+4+Buffer$6.byteLength(t,"utf8")+1;case"number":return Math.floor(t)===t&&t>=constants.JS_INT_MIN&&t<=constants.JS_INT_MAX&&t>=constants.BSON_INT32_MIN&&t<=constants.BSON_INT32_MAX?(null!=e?Buffer$6.byteLength(e,"utf8")+1:0)+5:(null!=e?Buffer$6.byteLength(e,"utf8")+1:0)+9;case"undefined":return r||!i?(null!=e?Buffer$6.byteLength(e,"utf8")+1:0)+1:0;case"boolean":return(null!=e?Buffer$6.byteLength(e,"utf8")+1:0)+2;case"object":if(null==t||"MinKey"===t._bsontype||"MaxKey"===t._bsontype)return(null!=e?Buffer$6.byteLength(e,"utf8")+1:0)+1;if("ObjectId"===t._bsontype||"ObjectID"===t._bsontype)return(null!=e?Buffer$6.byteLength(e,"utf8")+1:0)+13;if(t instanceof Date||isDate$2(t))return(null!=e?Buffer$6.byteLength(e,"utf8")+1:0)+9;if(void 0!==Buffer$6&&Buffer$6.isBuffer(t))return(null!=e?Buffer$6.byteLength(e,"utf8")+1:0)+6+t.length;if("Long"===t._bsontype||"Double"===t._bsontype||"Timestamp"===t._bsontype)return(null!=e?Buffer$6.byteLength(e,"utf8")+1:0)+9;if("Decimal128"===t._bsontype)return(null!=e?Buffer$6.byteLength(e,"utf8")+1:0)+17;if("Code"===t._bsontype)return null!=t.scope&&Object.keys(t.scope).length>0?(null!=e?Buffer$6.byteLength(e,"utf8")+1:0)+1+4+4+Buffer$6.byteLength(t.code.toString(),"utf8")+1+calculateObjectSize(t.scope,n,i):(null!=e?Buffer$6.byteLength(e,"utf8")+1:0)+1+4+Buffer$6.byteLength(t.code.toString(),"utf8")+1;if("Binary"===t._bsontype)return t.sub_type===binary.SUBTYPE_BYTE_ARRAY?(null!=e?Buffer$6.byteLength(e,"utf8")+1:0)+(t.position+1+4+1+4):(null!=e?Buffer$6.byteLength(e,"utf8")+1:0)+(t.position+1+4+1);if("Symbol"===t._bsontype)return(null!=e?Buffer$6.byteLength(e,"utf8")+1:0)+Buffer$6.byteLength(t.value,"utf8")+4+1+1;if("DBRef"===t._bsontype){var o=Object.assign({$ref:t.collection,$id:t.oid},t.fields);return null!=t.db&&(o.$db=t.db),(null!=e?Buffer$6.byteLength(e,"utf8")+1:0)+1+calculateObjectSize(o,n,i)}return t instanceof RegExp||"[object RegExp]"===Object.prototype.toString.call(t)?(null!=e?Buffer$6.byteLength(e,"utf8")+1:0)+1+Buffer$6.byteLength(t.source,"utf8")+1+(t.global?1:0)+(t.ignoreCase?1:0)+(t.multiline?1:0)+1:"BSONRegExp"===t._bsontype?(null!=e?Buffer$6.byteLength(e,"utf8")+1:0)+1+Buffer$6.byteLength(t.pattern,"utf8")+1+Buffer$6.byteLength(t.options,"utf8")+1:(null!=e?Buffer$6.byteLength(e,"utf8")+1:0)+calculateObjectSize(t,n,i)+1;case"function":if(t instanceof RegExp||"[object RegExp]"===Object.prototype.toString.call(t)||"[object RegExp]"===String.call(t))return(null!=e?Buffer$6.byteLength(e,"utf8")+1:0)+1+Buffer$6.byteLength(t.source,"utf8")+1+(t.global?1:0)+(t.ignoreCase?1:0)+(t.multiline?1:0)+1;if(n&&null!=t.scope&&Object.keys(t.scope).length>0)return(null!=e?Buffer$6.byteLength(e,"utf8")+1:0)+1+4+4+Buffer$6.byteLength(normalizedFunctionString$2(t),"utf8")+1+calculateObjectSize(t.scope,n,i);if(n)return(null!=e?Buffer$6.byteLength(e,"utf8")+1:0)+1+4+Buffer$6.byteLength(normalizedFunctionString$2(t),"utf8")+1}return 0}var calculate_size=calculateObjectSize,Buffer$7=buffer__WEBPACK_IMPORTED_MODULE_1___default.a.Buffer,ensure_buffer=function(e){if(e instanceof Buffer$7)return e;if(e instanceof Uint8Array)return Buffer$7.from(e.buffer);throw new TypeError("Must use either Buffer or Uint8Array")},Buffer$8=buffer__WEBPACK_IMPORTED_MODULE_1___default.a.Buffer,MAXSIZE=17825792,buffer$1=Buffer$8.alloc(MAXSIZE);function setInternalBufferSize(e){buffer$1.length<e&&(buffer$1=Buffer$8.alloc(e))}function serialize$1(e,t){var n="boolean"==typeof(t=t||{}).checkKeys&&t.checkKeys,r="boolean"==typeof t.serializeFunctions&&t.serializeFunctions,i="boolean"!=typeof t.ignoreUndefined||t.ignoreUndefined,o="number"==typeof t.minInternalBufferSize?t.minInternalBufferSize:MAXSIZE;buffer$1.length<o&&(buffer$1=Buffer$8.alloc(o));var s=serializer(buffer$1,e,n,0,0,r,i,[]),a=Buffer$8.alloc(s);return buffer$1.copy(a,0,0,a.length),a}function serializeWithBufferAndIndex(e,t,n){var r="boolean"==typeof(n=n||{}).checkKeys&&n.checkKeys,i="boolean"==typeof n.serializeFunctions&&n.serializeFunctions,o="boolean"!=typeof n.ignoreUndefined||n.ignoreUndefined,s="number"==typeof n.index?n.index:0,a=serializer(buffer$1,e,r,0,0,i,o);return buffer$1.copy(t,s,0,a),s+a-1}function deserialize$2(e,t){return e=ensure_buffer(e),deserializer(e,t)}function calculateObjectSize$1(e,t){var n="boolean"==typeof(t=t||{}).serializeFunctions&&t.serializeFunctions,r="boolean"!=typeof t.ignoreUndefined||t.ignoreUndefined;return calculate_size(e,n,r)}function deserializeStream(e,t,n,r,i,o){o=Object.assign({allowObjectSmallerThanBufferSize:!0},o),e=ensure_buffer(e);for(var s=t,a=0;a<n;a++){var c=e[s]|e[s+1]<<8|e[s+2]<<16|e[s+3]<<24;o.index=s,r[i+a]=deserializer(e,o),s+=c}return s}var bson={BSON_INT32_MAX:constants.BSON_INT32_MAX,BSON_INT32_MIN:constants.BSON_INT32_MIN,BSON_INT64_MAX:constants.BSON_INT64_MAX,BSON_INT64_MIN:constants.BSON_INT64_MIN,JS_INT_MAX:constants.JS_INT_MAX,JS_INT_MIN:constants.JS_INT_MIN,BSON_DATA_NUMBER:constants.BSON_DATA_NUMBER,BSON_DATA_STRING:constants.BSON_DATA_STRING,BSON_DATA_OBJECT:constants.BSON_DATA_OBJECT,BSON_DATA_ARRAY:constants.BSON_DATA_ARRAY,BSON_DATA_BINARY:constants.BSON_DATA_BINARY,BSON_DATA_UNDEFINED:constants.BSON_DATA_UNDEFINED,BSON_DATA_OID:constants.BSON_DATA_OID,BSON_DATA_BOOLEAN:constants.BSON_DATA_BOOLEAN,BSON_DATA_DATE:constants.BSON_DATA_DATE,BSON_DATA_NULL:constants.BSON_DATA_NULL,BSON_DATA_REGEXP:constants.BSON_DATA_REGEXP,BSON_DATA_DBPOINTER:constants.BSON_DATA_DBPOINTER,BSON_DATA_CODE:constants.BSON_DATA_CODE,BSON_DATA_SYMBOL:constants.BSON_DATA_SYMBOL,BSON_DATA_CODE_W_SCOPE:constants.BSON_DATA_CODE_W_SCOPE,BSON_DATA_INT:constants.BSON_DATA_INT,BSON_DATA_TIMESTAMP:constants.BSON_DATA_TIMESTAMP,BSON_DATA_LONG:constants.BSON_DATA_LONG,BSON_DATA_DECIMAL128:constants.BSON_DATA_DECIMAL128,BSON_DATA_MIN_KEY:constants.BSON_DATA_MIN_KEY,BSON_DATA_MAX_KEY:constants.BSON_DATA_MAX_KEY,BSON_BINARY_SUBTYPE_DEFAULT:constants.BSON_BINARY_SUBTYPE_DEFAULT,BSON_BINARY_SUBTYPE_FUNCTION:constants.BSON_BINARY_SUBTYPE_FUNCTION,BSON_BINARY_SUBTYPE_BYTE_ARRAY:constants.BSON_BINARY_SUBTYPE_BYTE_ARRAY,BSON_BINARY_SUBTYPE_UUID:constants.BSON_BINARY_SUBTYPE_UUID,BSON_BINARY_SUBTYPE_MD5:constants.BSON_BINARY_SUBTYPE_MD5,BSON_BINARY_SUBTYPE_USER_DEFINED:constants.BSON_BINARY_SUBTYPE_USER_DEFINED,Code:code,Map:map,BSONSymbol:symbol,DBRef:db_ref,Binary:binary,ObjectId:objectid,Long:long_1,Timestamp:timestamp,Double:double_1,Int32:int_32,MinKey:min_key,MaxKey:max_key,BSONRegExp:regexp,Decimal128:decimal128,serialize:serialize$1,serializeWithBufferAndIndex:serializeWithBufferAndIndex,deserialize:deserialize$2,calculateObjectSize:calculateObjectSize$1,deserializeStream:deserializeStream,setInternalBufferSize:setInternalBufferSize,ObjectID:objectid,EJSON:extended_json},bson_1=bson.BSON_INT32_MAX,bson_2=bson.BSON_INT32_MIN,bson_3=bson.BSON_INT64_MAX,bson_4=bson.BSON_INT64_MIN,bson_5=bson.JS_INT_MAX,bson_6=bson.JS_INT_MIN,bson_7=bson.BSON_DATA_NUMBER,bson_8=bson.BSON_DATA_STRING,bson_9=bson.BSON_DATA_OBJECT,bson_10=bson.BSON_DATA_ARRAY,bson_11=bson.BSON_DATA_BINARY,bson_12=bson.BSON_DATA_UNDEFINED,bson_13=bson.BSON_DATA_OID,bson_14=bson.BSON_DATA_BOOLEAN,bson_15=bson.BSON_DATA_DATE,bson_16=bson.BSON_DATA_NULL,bson_17=bson.BSON_DATA_REGEXP,bson_18=bson.BSON_DATA_DBPOINTER,bson_19=bson.BSON_DATA_CODE,bson_20=bson.BSON_DATA_SYMBOL,bson_21=bson.BSON_DATA_CODE_W_SCOPE,bson_22=bson.BSON_DATA_INT,bson_23=bson.BSON_DATA_TIMESTAMP,bson_24=bson.BSON_DATA_LONG,bson_25=bson.BSON_DATA_DECIMAL128,bson_26=bson.BSON_DATA_MIN_KEY,bson_27=bson.BSON_DATA_MAX_KEY,bson_28=bson.BSON_BINARY_SUBTYPE_DEFAULT,bson_29=bson.BSON_BINARY_SUBTYPE_FUNCTION,bson_30=bson.BSON_BINARY_SUBTYPE_BYTE_ARRAY,bson_31=bson.BSON_BINARY_SUBTYPE_UUID,bson_32=bson.BSON_BINARY_SUBTYPE_MD5,bson_33=bson.BSON_BINARY_SUBTYPE_USER_DEFINED,bson_34=bson.Code,bson_35=bson.BSONSymbol,bson_36=bson.DBRef,bson_37=bson.Binary,bson_38=bson.ObjectId,bson_39=bson.Long,bson_40=bson.Timestamp,bson_41=bson.Double,bson_42=bson.Int32,bson_43=bson.MinKey,bson_44=bson.MaxKey,bson_45=bson.BSONRegExp,bson_46=bson.Decimal128,bson_47=bson.serialize,bson_48=bson.serializeWithBufferAndIndex,bson_49=bson.deserialize,bson_50=bson.calculateObjectSize,bson_51=bson.deserializeStream,bson_52=bson.setInternalBufferSize,bson_53=bson.ObjectID,bson_54=bson.EJSON,_unused_webpack_default_export=bson}).call(this,__webpack_require__(4),__webpack_require__(1).Buffer)},function(e,t,n){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */
var r=n(21),i=n(22),o=n(23);function s(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(e,t){if(s()<t)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=c.prototype:(null===e&&(e=new c(t)),e.length=t),e}function c(e,t,n){if(!(c.TYPED_ARRAY_SUPPORT||this instanceof c))return new c(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return f(this,e)}return u(this,e,t,n)}function u(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r);c.TYPED_ARRAY_SUPPORT?(e=t).__proto__=c.prototype:e=h(e,t);return e}(e,t,n,r):"string"==typeof t?function(e,t,n){"string"==typeof n&&""!==n||(n="utf8");if(!c.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|d(t,n),i=(e=a(e,r)).write(t,n);i!==r&&(e=e.slice(0,i));return e}(e,t,n):function(e,t){if(c.isBuffer(t)){var n=0|p(t.length);return 0===(e=a(e,n)).length?e:(t.copy(e,0,0,n),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?a(e,0):h(e,t);if("Buffer"===t.type&&o(t.data))return h(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function f(e,t){if(l(t),e=a(e,t<0?0:0|p(t)),!c.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function h(e,t){var n=t.length<0?0:0|p(t.length);e=a(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function p(e){if(e>=s())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s().toString(16)+" bytes");return 0|e}function d(e,t){if(c.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return q(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return F(e).length;default:if(r)return q(e).length;t=(""+t).toLowerCase(),r=!0}}function _(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return R(this,t,n);case"utf8":case"utf-8":return O(this,t,n);case"ascii":return I(this,t,n);case"latin1":case"binary":return B(this,t,n);case"base64":return T(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return D(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function y(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function g(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=c.from(t,r)),c.isBuffer(t))return 0===t.length?-1:m(e,t,n,r,i);if("number"==typeof t)return t&=255,c.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):m(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function m(e,t,n,r,i){var o,s=1,a=e.length,c=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;s=2,a/=2,c/=2,n/=2}function u(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(i){var l=-1;for(o=n;o<a;o++)if(u(e,o)===u(t,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===c)return l*s}else-1!==l&&(o-=o-l),l=-1}else for(n+c>a&&(n=a-c),o=n;o>=0;o--){for(var f=!0,h=0;h<c;h++)if(u(e,o+h)!==u(t,h)){f=!1;break}if(f)return o}return-1}function b(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var s=0;s<r;++s){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[n+s]=a}return s}function v(e,t,n,r){return z(q(t,e.length-n),e,n,r)}function w(e,t,n,r){return z(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function E(e,t,n,r){return w(e,t,n,r)}function S(e,t,n,r){return z(F(t),e,n,r)}function A(e,t,n,r){return z(function(e,t){for(var n,r,i,o=[],s=0;s<e.length&&!((t-=2)<0);++s)n=e.charCodeAt(s),r=n>>8,i=n%256,o.push(i),o.push(r);return o}(t,e.length-n),e,n,r)}function T(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function O(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var o,s,a,c,u=e[i],l=null,f=u>239?4:u>223?3:u>191?2:1;if(i+f<=n)switch(f){case 1:u<128&&(l=u);break;case 2:128==(192&(o=e[i+1]))&&(c=(31&u)<<6|63&o)>127&&(l=c);break;case 3:o=e[i+1],s=e[i+2],128==(192&o)&&128==(192&s)&&(c=(15&u)<<12|(63&o)<<6|63&s)>2047&&(c<55296||c>57343)&&(l=c);break;case 4:o=e[i+1],s=e[i+2],a=e[i+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(c=(15&u)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&c<1114112&&(l=c)}null===l?(l=65533,f=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),i+=f}return function(e){var t=e.length;if(t<=N)return String.fromCharCode.apply(String,e);var n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=N));return n}(r)}t.Buffer=c,t.SlowBuffer=function(e){+e!=e&&(e=0);return c.alloc(+e)},t.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=s(),c.poolSize=8192,c._augment=function(e){return e.__proto__=c.prototype,e},c.from=function(e,t,n){return u(null,e,t,n)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(e,t,n){return function(e,t,n,r){return l(t),t<=0?a(e,t):void 0!==n?"string"==typeof r?a(e,t).fill(n,r):a(e,t).fill(n):a(e,t)}(null,e,t,n)},c.allocUnsafe=function(e){return f(null,e)},c.allocUnsafeSlow=function(e){return f(null,e)},c.isBuffer=function(e){return!(null==e||!e._isBuffer)},c.compare=function(e,t){if(!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,o=Math.min(n,r);i<o;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!o(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=c.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var s=e[n];if(!c.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(r,i),i+=s.length}return r},c.byteLength=d,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)y(this,t,t+1);return this},c.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)y(this,t,t+3),y(this,t+1,t+2);return this},c.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)y(this,t,t+7),y(this,t+1,t+6),y(this,t+2,t+5),y(this,t+3,t+4);return this},c.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?O(this,0,e):_.apply(this,arguments)},c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},c.prototype.compare=function(e,t,n,r,i){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;for(var o=(i>>>=0)-(r>>>=0),s=(n>>>=0)-(t>>>=0),a=Math.min(o,s),u=this.slice(r,i),l=e.slice(t,n),f=0;f<a;++f)if(u[f]!==l[f]){o=u[f],s=l[f];break}return o<s?-1:s<o?1:0},c.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},c.prototype.indexOf=function(e,t,n){return g(this,e,t,n,!0)},c.prototype.lastIndexOf=function(e,t,n){return g(this,e,t,n,!1)},c.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return b(this,e,t,n);case"utf8":case"utf-8":return v(this,e,t,n);case"ascii":return w(this,e,t,n);case"latin1":case"binary":return E(this,e,t,n);case"base64":return S(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var N=4096;function I(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function B(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function R(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",o=t;o<n;++o)i+=U(e[o]);return i}function D(e,t,n){for(var r=e.slice(t,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function C(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function P(e,t,n,r,i,o){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function x(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-n,2);i<o;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function L(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-n,4);i<o;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function M(e,t,n,r,i,o){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function k(e,t,n,r,o){return o||M(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function j(e,t,n,r,o){return o||M(e,0,n,8),i.write(e,t,n,r,52,8),n+8}c.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),c.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=c.prototype;else{var i=t-e;n=new c(i,void 0);for(var o=0;o<i;++o)n[o]=this[o+e]}return n},c.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||C(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r},c.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||C(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},c.prototype.readUInt8=function(e,t){return t||C(e,1,this.length),this[e]},c.prototype.readUInt16LE=function(e,t){return t||C(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUInt16BE=function(e,t){return t||C(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUInt32LE=function(e,t){return t||C(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUInt32BE=function(e,t){return t||C(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||C(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},c.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||C(e,t,this.length);for(var r=t,i=1,o=this[e+--r];r>0&&(i*=256);)o+=this[e+--r]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},c.prototype.readInt8=function(e,t){return t||C(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){t||C(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt16BE=function(e,t){t||C(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt32LE=function(e,t){return t||C(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return t||C(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readFloatLE=function(e,t){return t||C(e,4,this.length),i.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return t||C(e,4,this.length),i.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return t||C(e,8,this.length),i.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return t||C(e,8,this.length),i.read(this,e,!1,52,8)},c.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||P(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,o=0;for(this[t]=255&e;++o<n&&(i*=256);)this[t+o]=e/i&255;return t+n},c.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||P(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+n},c.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,1,255,0),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},c.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):x(this,e,t,!0),t+2},c.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):x(this,e,t,!1),t+2},c.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):L(this,e,t,!0),t+4},c.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):L(this,e,t,!1),t+4},c.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);P(this,e,t,n,i-1,-i)}var o=0,s=1,a=0;for(this[t]=255&e;++o<n&&(s*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n},c.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);P(this,e,t,n,i-1,-i)}var o=n-1,s=1,a=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n},c.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,1,127,-128),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):x(this,e,t,!0),t+2},c.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):x(this,e,t,!1),t+2},c.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):L(this,e,t,!0),t+4},c.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):L(this,e,t,!1),t+4},c.prototype.writeFloatLE=function(e,t,n){return k(this,e,t,!0,n)},c.prototype.writeFloatBE=function(e,t,n){return k(this,e,t,!1,n)},c.prototype.writeDoubleLE=function(e,t,n){return j(this,e,t,!0,n)},c.prototype.writeDoubleBE=function(e,t,n){return j(this,e,t,!1,n)},c.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,o=r-n;if(this===e&&n<t&&t<r)for(i=o-1;i>=0;--i)e[i+t]=this[i+n];else if(o<1e3||!c.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+o),t);return o},c.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!c.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var o;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(o=t;o<n;++o)this[o]=e;else{var s=c.isBuffer(e)?e:q(new c(e,r).toString()),a=s.length;for(o=0;o<n-t;++o)this[o+t]=s[o%a]}return this};var $=/[^+\/0-9A-Za-z-_]/g;function U(e){return e<16?"0"+e.toString(16):e.toString(16)}function q(e,t){var n;t=t||1/0;for(var r=e.length,i=null,o=[],s=0;s<r;++s){if((n=e.charCodeAt(s))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function F(e){return r.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace($,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function z(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}}).call(this,n(4))},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(26)),o=r(n(29)),s=r(n(30));function a(e){var t=o.default.stringify(e);return t=(t=(t=t.replace(/=+$/,"")).replace(/\+/g,"-")).replace(/\//g,"_")}t.getQuery=function(e,t){if("undefined"==typeof window)return!1;var n=t||window.location.search,r=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),i=n.substr(n.indexOf("?")+1).match(r);return null!=i?i[2]:""},t.getHash=function(e){if("undefined"==typeof window)return"";var t=window.location.hash.match(new RegExp("[#?&/]"+e+"=([^&#]*)"));return t?t[1]:""},t.removeParam=function(e,t){var n=t.split("?")[0],r=[],i=-1!==t.indexOf("?")?t.split("?")[1]:"";if(""!==i){for(var o=(r=i.split("&")).length-1;o>=0;o-=1)r[o].split("=")[0]===e&&r.splice(o,1);n=n+"?"+r.join("&")}return n},t.createPromiseCallback=function(){var e;if(!Promise){(e=function(){}).promise={};var t=function(){throw new Error('Your Node runtime does support ES6 Promises. Set "global.Promise" to your preferred implementation of promises.')};return Object.defineProperty(e.promise,"then",{get:t}),Object.defineProperty(e.promise,"catch",{get:t}),e}var n=new Promise((function(t,n){e=function(e,r){return e?n(e):t(r)}}));return e.promise=n,e},t.getWeixinCode=function(){return t.getQuery("code")||t.getHash("code")},t.getMiniAppCode=function(){return new Promise((function(e,t){wx.login({success:function(t){e(t.code)},fail:function(e){t(e)}})}))},t.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},t.isString=function(e){return"string"==typeof e},t.isUndefined=function(e){return void 0===e},t.isInstanceOf=function(e,t){return e instanceof t},t.isFormData=function(e){return"[object FormData]"===Object.prototype.toString.call(e)},t.genSeqId=function(){return Math.random().toString(16).slice(2)},t.getArgNames=function(e){var t=e.toString();return t.slice(t.indexOf("(")+1,t.indexOf(")")).match(/([^\s,]+)/g)},t.formatUrl=function(e,t,n){void 0===n&&(n={});var r=/\?/.test(t),i="";for(var o in n)""===i?!r&&(t+="?"):i+="&",i+=o+"="+encodeURIComponent(n[o]);return/^http(s)?\:\/\//.test(t+=i)?t:""+e+t},t.toQueryString=function(e){void 0===e&&(e={});var t=[];for(var n in e)t.push(n+"="+encodeURIComponent(e[n]));return t.join("&")},t.createSign=function(e,t){var n=a(s.default.parse(JSON.stringify({alg:"HS256",typ:"JWT"})))+"."+a(s.default.parse(JSON.stringify(e)));return n+"."+a(i.default(n,t))}},function(e,t){e.exports=r;var n=null;try{n=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(e){}function r(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function i(e){return!0===(e&&e.__isLong__)}r.prototype.__isLong__,Object.defineProperty(r.prototype,"__isLong__",{value:!0}),r.isLong=i;var o={},s={};function a(e,t){var n,r,i;return t?(i=0<=(e>>>=0)&&e<256)&&(r=s[e])?r:(n=u(e,(0|e)<0?-1:0,!0),i&&(s[e]=n),n):(i=-128<=(e|=0)&&e<128)&&(r=o[e])?r:(n=u(e,e<0?-1:0,!1),i&&(o[e]=n),n)}function c(e,t){if(isNaN(e))return t?m:g;if(t){if(e<0)return m;if(e>=d)return S}else{if(e<=-_)return A;if(e+1>=_)return E}return e<0?c(-e,t).neg():u(e%p|0,e/p|0,t)}function u(e,t,n){return new r(e,t,n)}r.fromInt=a,r.fromNumber=c,r.fromBits=u;var l=Math.pow;function f(e,t,n){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return g;if("number"==typeof t?(n=t,t=!1):t=!!t,(n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return f(e.substring(1),t,n).neg();for(var i=c(l(n,8)),o=g,s=0;s<e.length;s+=8){var a=Math.min(8,e.length-s),u=parseInt(e.substring(s,s+a),n);if(a<8){var h=c(l(n,a));o=o.mul(h).add(c(u))}else o=(o=o.mul(i)).add(c(u))}return o.unsigned=t,o}function h(e,t){return"number"==typeof e?c(e,t):"string"==typeof e?f(e,t):u(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}r.fromString=f,r.fromValue=h;var p=4294967296,d=p*p,_=d/2,y=a(1<<24),g=a(0);r.ZERO=g;var m=a(0,!0);r.UZERO=m;var b=a(1);r.ONE=b;var v=a(1,!0);r.UONE=v;var w=a(-1);r.NEG_ONE=w;var E=u(-1,2147483647,!1);r.MAX_VALUE=E;var S=u(-1,-1,!0);r.MAX_UNSIGNED_VALUE=S;var A=u(0,-2147483648,!1);r.MIN_VALUE=A;var T=r.prototype;T.toInt=function(){return this.unsigned?this.low>>>0:this.low},T.toNumber=function(){return this.unsigned?(this.high>>>0)*p+(this.low>>>0):this.high*p+(this.low>>>0)},T.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(A)){var t=c(e),n=this.div(t),r=n.mul(t).sub(this);return n.toString(e)+r.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var i=c(l(e,6),this.unsigned),o=this,s="";;){var a=o.div(i),u=(o.sub(a.mul(i)).toInt()>>>0).toString(e);if((o=a).isZero())return u+s;for(;u.length<6;)u="0"+u;s=""+u+s}},T.getHighBits=function(){return this.high},T.getHighBitsUnsigned=function(){return this.high>>>0},T.getLowBits=function(){return this.low},T.getLowBitsUnsigned=function(){return this.low>>>0},T.getNumBitsAbs=function(){if(this.isNegative())return this.eq(A)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},T.isZero=function(){return 0===this.high&&0===this.low},T.eqz=T.isZero,T.isNegative=function(){return!this.unsigned&&this.high<0},T.isPositive=function(){return this.unsigned||this.high>=0},T.isOdd=function(){return 1==(1&this.low)},T.isEven=function(){return 0==(1&this.low)},T.equals=function(e){return i(e)||(e=h(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&(this.high===e.high&&this.low===e.low)},T.eq=T.equals,T.notEquals=function(e){return!this.eq(e)},T.neq=T.notEquals,T.ne=T.notEquals,T.lessThan=function(e){return this.comp(e)<0},T.lt=T.lessThan,T.lessThanOrEqual=function(e){return this.comp(e)<=0},T.lte=T.lessThanOrEqual,T.le=T.lessThanOrEqual,T.greaterThan=function(e){return this.comp(e)>0},T.gt=T.greaterThan,T.greaterThanOrEqual=function(e){return this.comp(e)>=0},T.gte=T.greaterThanOrEqual,T.ge=T.greaterThanOrEqual,T.compare=function(e){if(i(e)||(e=h(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},T.comp=T.compare,T.negate=function(){return!this.unsigned&&this.eq(A)?A:this.not().add(b)},T.neg=T.negate,T.add=function(e){i(e)||(e=h(e));var t=this.high>>>16,n=65535&this.high,r=this.low>>>16,o=65535&this.low,s=e.high>>>16,a=65535&e.high,c=e.low>>>16,l=0,f=0,p=0,d=0;return p+=(d+=o+(65535&e.low))>>>16,f+=(p+=r+c)>>>16,l+=(f+=n+a)>>>16,l+=t+s,u((p&=65535)<<16|(d&=65535),(l&=65535)<<16|(f&=65535),this.unsigned)},T.subtract=function(e){return i(e)||(e=h(e)),this.add(e.neg())},T.sub=T.subtract,T.multiply=function(e){if(this.isZero())return g;if(i(e)||(e=h(e)),n)return u(n.mul(this.low,this.high,e.low,e.high),n.get_high(),this.unsigned);if(e.isZero())return g;if(this.eq(A))return e.isOdd()?A:g;if(e.eq(A))return this.isOdd()?A:g;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(y)&&e.lt(y))return c(this.toNumber()*e.toNumber(),this.unsigned);var t=this.high>>>16,r=65535&this.high,o=this.low>>>16,s=65535&this.low,a=e.high>>>16,l=65535&e.high,f=e.low>>>16,p=65535&e.low,d=0,_=0,m=0,b=0;return m+=(b+=s*p)>>>16,_+=(m+=o*p)>>>16,m&=65535,_+=(m+=s*f)>>>16,d+=(_+=r*p)>>>16,_&=65535,d+=(_+=o*f)>>>16,_&=65535,d+=(_+=s*l)>>>16,d+=t*p+r*f+o*l+s*a,u((m&=65535)<<16|(b&=65535),(d&=65535)<<16|(_&=65535),this.unsigned)},T.mul=T.multiply,T.divide=function(e){if(i(e)||(e=h(e)),e.isZero())throw Error("division by zero");var t,r,o;if(n)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?u((this.unsigned?n.div_u:n.div_s)(this.low,this.high,e.low,e.high),n.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?m:g;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return m;if(e.gt(this.shru(1)))return v;o=m}else{if(this.eq(A))return e.eq(b)||e.eq(w)?A:e.eq(A)?b:(t=this.shr(1).div(e).shl(1)).eq(g)?e.isNegative()?b:w:(r=this.sub(e.mul(t)),o=t.add(r.div(e)));if(e.eq(A))return this.unsigned?m:g;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();o=g}for(r=this;r.gte(e);){t=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(t)/Math.LN2),a=s<=48?1:l(2,s-48),f=c(t),p=f.mul(e);p.isNegative()||p.gt(r);)p=(f=c(t-=a,this.unsigned)).mul(e);f.isZero()&&(f=b),o=o.add(f),r=r.sub(p)}return o},T.div=T.divide,T.modulo=function(e){return i(e)||(e=h(e)),n?u((this.unsigned?n.rem_u:n.rem_s)(this.low,this.high,e.low,e.high),n.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},T.mod=T.modulo,T.rem=T.modulo,T.not=function(){return u(~this.low,~this.high,this.unsigned)},T.and=function(e){return i(e)||(e=h(e)),u(this.low&e.low,this.high&e.high,this.unsigned)},T.or=function(e){return i(e)||(e=h(e)),u(this.low|e.low,this.high|e.high,this.unsigned)},T.xor=function(e){return i(e)||(e=h(e)),u(this.low^e.low,this.high^e.high,this.unsigned)},T.shiftLeft=function(e){return i(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?u(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):u(0,this.low<<e-32,this.unsigned)},T.shl=T.shiftLeft,T.shiftRight=function(e){return i(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?u(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):u(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},T.shr=T.shiftRight,T.shiftRightUnsigned=function(e){if(i(e)&&(e=e.toInt()),0===(e&=63))return this;var t=this.high;return e<32?u(this.low>>>e|t<<32-e,t>>>e,this.unsigned):u(32===e?t:t>>>e-32,0,this.unsigned)},T.shru=T.shiftRightUnsigned,T.shr_u=T.shiftRightUnsigned,T.toSigned=function(){return this.unsigned?u(this.low,this.high,!1):this},T.toUnsigned=function(){return this.unsigned?this:u(this.low,this.high,!0)},T.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},T.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},T.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},r.fromBytes=function(e,t,n){return n?r.fromBytesLE(e,t):r.fromBytesBE(e,t)},r.fromBytesLE=function(e,t){return new r(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},r.fromBytesBE=function(e,t){return new r(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){var r;e.exports=(r=r||function(e,t){var n=Object.create||function(){function e(){}return function(t){var n;return e.prototype=t,n=new e,e.prototype=null,n}}(),r={},i=r.lib={},o=i.Base={extend:function(e){var t=n(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},s=i.WordArray=o.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||c).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes,i=e.sigBytes;if(this.clamp(),r%4)for(var o=0;o<i;o++){var s=n[o>>>2]>>>24-o%4*8&255;t[r+o>>>2]|=s<<24-(r+o)%4*8}else for(o=0;o<i;o+=4)t[r+o>>>2]=n[o>>>2];return this.sigBytes+=i,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=o.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n,r=[],i=function(t){t=t;var n=987654321,r=4294967295;return function(){var i=((n=36969*(65535&n)+(n>>16)&r)<<16)+(t=18e3*(65535&t)+(t>>16)&r)&r;return i/=4294967296,(i+=.5)*(e.random()>.5?1:-1)}},o=0;o<t;o+=4){var a=i(4294967296*(n||e.random()));n=987654071*a(),r.push(4294967296*a()|0)}return new s.init(r,t)}}),a=r.enc={},c=a.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i++){var o=t[i>>>2]>>>24-i%4*8&255;r.push((o>>>4).toString(16)),r.push((15&o).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new s.init(n,t/2)}},u=a.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i++){var o=t[i>>>2]>>>24-i%4*8&255;r.push(String.fromCharCode(o))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new s.init(n,t)}},l=a.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},f=i.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new s.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,i=n.sigBytes,o=this.blockSize,a=i/(4*o),c=(a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0))*o,u=e.min(4*c,i);if(c){for(var l=0;l<c;l+=o)this._doProcessBlock(r,l);var f=r.splice(0,c);n.sigBytes-=u}return new s.init(f,u)},clone:function(){var e=o.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),h=(i.Hasher=f.extend({cfg:o.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){f.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new h.HMAC.init(e,n).finalize(t)}}}),r.algo={});return r}(Math),r)},function(e,t,n){"use strict";var r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var i,o=r(n(32)),s=n(2);!function(e){e.WEB="web",e.WX_MP="wx_mp"}(i=t.RUNTIME||(t.RUNTIME={})),t.useAdapters=function(e){for(var t=0,n=s.isArray(e)?e:[e];t<n.length;t++){var r=n[t],i=r.isMatch,o=r.genAdapter,a=r.runtime;if(i())return{adapter:o(),runtime:a}}},t.useDefaultAdapter=function(){return{adapter:o.genAdapter(),runtime:i.WEB}},t.Adapter={adapter:null,runtime:void 0}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r};Object.defineProperty(t,"__esModule",{value:!0});var s=n(2);var a=function(e,t){this.data=t||null,this.name=e};t.IEvent=a;var c=function(e){function t(t,n){var r=e.call(this,"error",{error:t,data:n})||this;return r.error=t,r}return i(t,e),t}(a);t.IErrorEvent=c;var u=function(){function e(){this._listeners={}}return e.prototype.on=function(e,t){return function(e,t,n){n[e]=n[e]||[],n[e].push(t)}(e,t,this._listeners),this},e.prototype.off=function(e,t){return function(e,t,n){if(n&&n[e]){var r=n[e].indexOf(t);-1!==r&&n[e].splice(r,1)}}(e,t,this._listeners),this},e.prototype.fire=function(e,t){if(s.isInstanceOf(e,c))return console.error(e.error),this;var n=s.isString(e)?new a(e,t||{}):e,r=n.name;if(this._listens(r)){n.target=this;for(var i=0,u=this._listeners[r]?o(this._listeners[r]):[];i<u.length;i++){u[i].call(this,n)}}return this},e.prototype._listens=function(e){return this._listeners[e]&&this._listeners[e].length>0},e}();t.IEventEmitter=u;var l=new u;t.addEventListener=function(e,t){l.on(e,t)},t.activateEvent=function(e,t){void 0===t&&(t={}),l.fire(e,t)},t.removeEventListener=function(e,t){l.off(e,t)},t.EVENTS={LOGIN_STATE_CHANGED:"loginStateChanged",LOGIN_STATE_EXPIRE:"loginStateExpire",LOGIN_TYPE_CHANGED:"loginTypeChanged",ANONYMOUS_CONVERTED:"anonymousConverted",REFRESH_ACCESS_TOKEN:"refreshAccessToken"}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(9),s=n(11),a=n(6);!function(e){e.ANONYMOUS="ANONYMOUS",e.WECHAT="WECHAT",e.CUSTOM="CUSTOM",e.NULL="NULL"}(t.LOGINTYPE||(t.LOGINTYPE={}));var c=function(){function e(e){this.config=e,this._cache=s.getCache(e.env),this._request=o.getRequestByEnvId(e.env)}return e.prototype.setRefreshToken=function(e){var t=this._cache.keys,n=t.accessTokenKey,r=t.accessTokenExpireKey,i=t.refreshTokenKey;this._cache.removeStore(n),this._cache.removeStore(r),this._cache.setStore(i,e)},e.prototype.getRefreshTokenByWXCode=function(e,t,n){return r(this,void 0,void 0,(function(){var r;return i(this,(function(i){return"auth.getJwt",r=a.Adapter.runtime===a.RUNTIME.WX_MP?"1":"0",[2,this._request.send("auth.getJwt",{appid:e,loginType:t,code:n,hybridMiniapp:r}).then((function(e){if(e.code)throw new Error("[tcb-js-sdk] 微信登录失败: "+e.code);if(e.refresh_token)return{refreshToken:e.refresh_token,accessToken:e.access_token,accessTokenExpire:e.access_token_expire};throw new Error("[tcb-js-sdk] getJwt未返回refreshToken")}))]}))}))},e}();t.AuthProvider=c},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(10),a=n(11),c=n(7),u=n(2),l=n(6),f=n(8),h=["auth.getJwt","auth.logout","auth.signInWithTicket","auth.signInAnonymously"],p={"X-SDK-Version":s.SDK_VERISON};function d(e,t,n){var i=e[t];e[t]=function(t){var o={},s={};n.forEach((function(n){var r=n.call(e,t),i=r.data,a=r.headers;Object.assign(o,i),Object.assign(s,a)}));var a=t.data;return a&&function(){if(u.isFormData(a))for(var e in o)a.append(e,o[e]);else t.data=r(r({},a),o)}(),t.headers=r(r({},t.headers||{}),s),i.call(e,t)}}function _(){var e=u.genSeqId();return{data:{seqId:e},headers:r(r({},p),{"x-seqid":e})}}var y=function(){function e(e){void 0===e&&(e={}),this.config=e,this._reqClass=new l.Adapter.adapter.reqClass({timeout:this.config.timeout,timeoutMsg:"[tcb-js-sdk] 请求在"+this.config.timeout/1e3+"s内未完成，已中断",restrictedMethods:["post"]}),this._cache=a.getCache(this.config.env),d(this._reqClass,"post",[_]),d(this._reqClass,"upload",[_]),d(this._reqClass,"download",[_])}return e.prototype.post=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,this._reqClass.post(e)];case 1:return[2,t.sent()]}}))}))},e.prototype.upload=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,this._reqClass.upload(e)];case 1:return[2,t.sent()]}}))}))},e.prototype.download=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,this._reqClass.download(e)];case 1:return[2,t.sent()]}}))}))},e.prototype.refreshAccessToken=function(){return i(this,void 0,void 0,(function(){var e,t,n;return o(this,(function(r){switch(r.label){case 0:this._refreshAccessTokenPromise||(this._refreshAccessTokenPromise=this._refreshAccessToken()),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._refreshAccessTokenPromise];case 2:return e=r.sent(),[3,4];case 3:return n=r.sent(),t=n,[3,4];case 4:if(this._refreshAccessTokenPromise=null,this._shouldRefreshAccessTokenHook=null,t)throw t;return[2,e]}}))}))},e.prototype._refreshAccessToken=function(){return i(this,void 0,void 0,(function(){var e,t,n,r,i,s,a,u,l,h;return o(this,(function(o){switch(o.label){case 0:if(e=this._cache.keys,t=e.accessTokenKey,n=e.accessTokenExpireKey,r=e.refreshTokenKey,i=e.loginTypeKey,s=e.anonymousUuidKey,this._cache.removeStore(t),this._cache.removeStore(n),!(a=this._cache.getStore(r)))throw new Error("[tcb-js-sdk] 未登录CloudBase");return u={refresh_token:a},this._cache.getStore(i)===f.LOGINTYPE.ANONYMOUS&&(u.anonymous_uuid=this._cache.getStore(s)),[4,this.request("auth.getJwt",u)];case 1:if((l=o.sent()).data.code)throw"SIGN_PARAM_INVALID"!==(h=l.data.code)&&"REFRESH_TOKEN_EXPIRED"!==h&&"INVALID_REFRESH_TOKEN"!==h||(c.activateEvent(c.EVENTS.LOGIN_STATE_EXPIRE),this._cache.removeStore(r)),new Error("[tcb-js-sdk] 刷新access token失败："+l.data.code);return l.data.access_token?(c.activateEvent(c.EVENTS.REFRESH_ACCESS_TOKEN),this._cache.setStore(t,l.data.access_token),this._cache.setStore(n,l.data.access_token_expire+Date.now()),[2,{accessToken:l.data.access_token,accessTokenExpire:l.data.access_token_expire}]):(l.data.refresh_token&&(this._cache.removeStore(r),this._cache.setStore(r,l.data.refresh_token),this._refreshAccessToken()),[2])}}))}))},e.prototype.getAccessToken=function(){return i(this,void 0,void 0,(function(){var e,t,n,r,i,s,a;return o(this,(function(o){switch(o.label){case 0:return e=this._cache.keys,t=e.accessTokenKey,n=e.accessTokenExpireKey,r=this._cache.getStore(t),i=this._cache.getStore(n),s=!0,(a=this._shouldRefreshAccessTokenHook)?[4,this._shouldRefreshAccessTokenHook(r,i)]:[3,2];case 1:a=!o.sent(),o.label=2;case 2:return a&&(s=!1),(!r||!i||i<Date.now())&&s?[2,this.refreshAccessToken()]:[2,{accessToken:r,accessTokenExpire:i}]}}))}))},e.prototype.request=function(e,t,n){return i(this,void 0,void 0,(function(){var i,a,c,f,p,d,_,y,g,m,b,v,w,E,S,A,T,O,N;return o(this,(function(o){switch(o.label){case 0:return i="application/x-www-form-urlencoded",a=r({action:e,dataVersion:s.dataVersion,env:this.config.env},t),-1!==h.indexOf(e)?[3,2]:(c=a,[4,this.getAccessToken()]);case 1:c.access_token=o.sent().accessToken,o.label=2;case 2:if("storage.uploadFile"===e){for(p in f=new FormData)f.hasOwnProperty(p)&&void 0!==f[p]&&f.append(p,a[p]);i="multipart/form-data"}else for(p in i="application/json;charset=UTF-8",f={},a)void 0!==a[p]&&(f[p]=a[p]);return l.Adapter.runtime!==l.RUNTIME.WEB&&(d=this.config,_=d.appSign,y=d.appSecret,g=Date.now(),m=y.appAccessKey,b=y.appAccessKeyId,v=u.createSign({data:f,timestamp:g,appAccessKeyId:b,appSign:_},m),f=r(r({},f),{timestamp:g,appAccessKey:m,appSign:_,sign:v})),w={headers:{"content-type":i}},n&&n.onUploadProgress&&(w.onUploadProgress=n.onUploadProgress),E=t.parse,S=t.query,A=t.search,T={env:this.config.env},E&&(T.parse=!0),S&&(T=r(r({},S),T)),O=u.formatUrl(s.protocol,s.BASE_URL,T),A&&(O+=A),[4,this.post(r({url:O,data:f},w))];case 3:if(N=o.sent(),200!==Number(N.status)&&200!==Number(N.statusCode)||!N.data)throw new Error("network request error");return[2,N]}}))}))},e.prototype.send=function(e,t){return void 0===t&&(t={}),i(this,void 0,void 0,(function(){var n,r;return o(this,(function(i){switch(i.label){case 0:return[4,this.request(e,t,{onUploadProgress:t.onUploadProgress})];case 1:return"ACCESS_TOKEN_EXPIRED"!==(n=i.sent()).data.code||-1!==h.indexOf(e)?[3,4]:[4,this.refreshAccessToken()];case 2:return i.sent(),[4,this.request(e,t,{onUploadProgress:t.onUploadProgress})];case 3:if((r=i.sent()).data.code)throw new Error("["+r.data.code+"] "+r.data.message);return[2,r.data];case 4:if(n.data.code)throw new Error("["+n.data.code+"] "+n.data.message);return[2,n.data]}}))}))},e}();t.IRequest=y;var g={};t.initRequest=function(e){g[e.env]=new y(e)},t.getRequestByEnvId=function(e){return g[e]}},function(e,t,n){"use strict";var r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(31));t.SDK_VERISON=i.version,t.ACCESS_TOKEN="access_token",t.ACCESS_TOKEN_Expire="access_token_expire",t.REFRESH_TOKEN="refresh_token",t.ANONYMOUS_UUID="anonymous_uuid",t.LOGIN_TYPE_KEY="login_type",t.protocol="undefined"!=typeof location&&"http:"===location.protocol?"http:":"https:",t.BASE_URL="//tcb-api.tencentcloudapi.com/web",t.dataVersion="2020-01-10"},function(e,t,n){"use strict";(function(e){var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(13),s=n(6),a=n(10),c=n(33),u=["anonymousUuidKey"],l=function(e){function t(){var t=e.call(this)||this;return s.Adapter.adapter.root.tcbObject||(s.Adapter.adapter.root.tcbObject={}),t}return i(t,e),t.prototype.setItem=function(e,t){s.Adapter.adapter.root.tcbObject[e]=t},t.prototype.getItem=function(e){return s.Adapter.adapter.root.tcbObject[e]},t.prototype.removeItem=function(e){delete s.Adapter.adapter.root.tcbObject[e]},t.prototype.clear=function(){delete s.Adapter.adapter.root.tcbObject},t}(o.AbstractStorage);function f(e,t){switch(e){case"local":return t.localStorage||new l;case"none":return new l;default:return t.sessionStorage||new l}}var h=function(){function t(e){if(this.keys={},!this._storage){this._persistence=s.Adapter.adapter.primaryStorage||e.persistence,this._storage=f(this._persistence,s.Adapter.adapter);var t=a.ACCESS_TOKEN+"_"+e.env,n=a.ACCESS_TOKEN_Expire+"_"+e.env,r=a.REFRESH_TOKEN+"_"+e.env,i=a.ANONYMOUS_UUID+"_"+e.env,o=a.LOGIN_TYPE_KEY+"_"+e.env;this.keys={accessTokenKey:t,accessTokenExpireKey:n,refreshTokenKey:r,anonymousUuidKey:i,loginTypeKey:o}}}return t.prototype.updatePersistence=function(e){if(e!==this._persistence){var t="local"===this._persistence;this._persistence=e;var n=f(e,s.Adapter.adapter);for(var r in this.keys){var i=this.keys[r];if(!t||!u.includes(r)){var o=this._storage.getItem(i);c.isUndefined(o)||(n.setItem(i,o),this._storage.removeItem(i))}}this._storage=n}},t.prototype.setStore=function(e,t,n){if(this._storage){var r={version:n||"localCachev1",content:t},i=JSON.stringify(r);try{this._storage.setItem(e,i)}catch(e){return}}},t.prototype.getStore=function(t,n){try{if(e&&e.env&&e.env.tcb_token)return e.env.tcb_token;if(!this._storage)return}catch(e){return""}n=n||"localCachev1";var r=this._storage.getItem(t);return r&&r.indexOf(n)>=0?JSON.parse(r).content:""},t.prototype.removeStore=function(e){this._storage.removeItem(e)},t}();t.ICache=h;var p={};t.initCache=function(e){var t=e.env;p[t]=new h(e)},t.getCache=function(e){return p[e]}}).call(this,n(12))},function(e,t){var n,r,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(e){r=s}}();var c,u=[],l=!1,f=-1;function h(){l&&c&&(l=!1,c.length?u=c.concat(u):f=-1,u.length&&p())}function p(){if(!l){var e=a(h);l=!0;for(var t=u.length;t;){for(c=u,u=[];++f<t;)c&&c[f].run();f=-1,t=u.length}c=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function d(e,t){this.fun=e,this.array=t}function _(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new d(e,t)),1!==u.length||l||a(p)},d.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=_,i.addListener=_,i.once=_,i.off=_,i.removeListener=_,i.removeAllListeners=_,i.emit=_,i.prependListener=_,i.prependOnceListener=_,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,n){"use strict";var r;n.r(t),function(e){e.local="local",e.none="none",e.session="session"}(r||(r={}));var i=function(){},o=function(){};function s(e,t,n){void 0===n&&(n={});var r=/\?/.test(t),i="";for(var o in n)""===i?!r&&(t+="?"):i+="&",i+=o+"="+encodeURIComponent(n[o]);return/^http(s)?\:\/\//.test(t+=i)?t:""+e+t}n.d(t,"StorageType",(function(){return r})),n.d(t,"AbstractSDKRequest",(function(){return i})),n.d(t,"AbstractStorage",(function(){return o})),n.d(t,"formatUrl",(function(){return s}))},function(e,t,n){(function(t){var n="Expected a function",r="__lodash_hash_undefined__",i=1/0,o=9007199254740991,s="[object Function]",a="[object GeneratorFunction]",c="[object Symbol]",u=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,l=/^\w*$/,f=/^\./,h=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,p=/\\(\\)?/g,d=/^\[object .+?Constructor\]$/,_=/^(?:0|[1-9]\d*)$/,y="object"==typeof t&&t&&t.Object===Object&&t,g="object"==typeof self&&self&&self.Object===Object&&self,m=y||g||Function("return this")();var b,v=Array.prototype,w=Function.prototype,E=Object.prototype,S=m["__core-js_shared__"],A=(b=/[^.]+$/.exec(S&&S.keys&&S.keys.IE_PROTO||""))?"Symbol(src)_1."+b:"",T=w.toString,O=E.hasOwnProperty,N=E.toString,I=RegExp("^"+T.call(O).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),B=m.Symbol,R=v.splice,D=z(m,"Map"),C=z(Object,"create"),P=B?B.prototype:void 0,x=P?P.toString:void 0;function L(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function M(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function k(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function j(e,t,n){var r=e[t];O.call(e,t)&&H(r,n)&&(void 0!==n||t in e)||(e[t]=n)}function $(e,t){for(var n=e.length;n--;)if(H(e[n][0],t))return n;return-1}function U(e){return!(!V(e)||(t=e,A&&A in t))&&(function(e){var t=V(e)?N.call(e):"";return t==s||t==a}(e)||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}(e)?I:d).test(function(e){if(null!=e){try{return T.call(e)}catch(e){}try{return e+""}catch(e){}}return""}(e));var t}function q(e,t,n,r){if(!V(e))return e;for(var i=-1,o=(t=function(e,t){if(J(e))return!1;var n=typeof e;if("number"==n||"symbol"==n||"boolean"==n||null==e||X(e))return!0;return l.test(e)||!u.test(e)||null!=t&&e in Object(t)}(t,e)?[t]:function(e){return J(e)?e:G(e)}(t)).length,s=o-1,a=e;null!=a&&++i<o;){var c=Y(t[i]),f=n;if(i!=s){var h=a[c];void 0===(f=r?r(h,c,a):void 0)&&(f=V(h)?h:W(t[i+1])?[]:{})}j(a,c,f),a=a[c]}return e}function F(e,t){var n,r,i=e.__data__;return("string"==(r=typeof(n=t))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof t?"string":"hash"]:i.map}function z(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return U(n)?n:void 0}function W(e,t){return!!(t=null==t?o:t)&&("number"==typeof e||_.test(e))&&e>-1&&e%1==0&&e<t}L.prototype.clear=function(){this.__data__=C?C(null):{}},L.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},L.prototype.get=function(e){var t=this.__data__;if(C){var n=t[e];return n===r?void 0:n}return O.call(t,e)?t[e]:void 0},L.prototype.has=function(e){var t=this.__data__;return C?void 0!==t[e]:O.call(t,e)},L.prototype.set=function(e,t){return this.__data__[e]=C&&void 0===t?r:t,this},M.prototype.clear=function(){this.__data__=[]},M.prototype.delete=function(e){var t=this.__data__,n=$(t,e);return!(n<0)&&(n==t.length-1?t.pop():R.call(t,n,1),!0)},M.prototype.get=function(e){var t=this.__data__,n=$(t,e);return n<0?void 0:t[n][1]},M.prototype.has=function(e){return $(this.__data__,e)>-1},M.prototype.set=function(e,t){var n=this.__data__,r=$(n,e);return r<0?n.push([e,t]):n[r][1]=t,this},k.prototype.clear=function(){this.__data__={hash:new L,map:new(D||M),string:new L}},k.prototype.delete=function(e){return F(this,e).delete(e)},k.prototype.get=function(e){return F(this,e).get(e)},k.prototype.has=function(e){return F(this,e).has(e)},k.prototype.set=function(e,t){return F(this,e).set(e,t),this};var G=K((function(e){var t;e=null==(t=e)?"":function(e){if("string"==typeof e)return e;if(X(e))return x?x.call(e):"";var t=e+"";return"0"==t&&1/e==-i?"-0":t}(t);var n=[];return f.test(e)&&n.push(""),e.replace(h,(function(e,t,r,i){n.push(r?i.replace(p,"$1"):t||e)})),n}));function Y(e){if("string"==typeof e||X(e))return e;var t=e+"";return"0"==t&&1/e==-i?"-0":t}function K(e,t){if("function"!=typeof e||t&&"function"!=typeof t)throw new TypeError(n);var r=function(){var n=arguments,i=t?t.apply(this,n):n[0],o=r.cache;if(o.has(i))return o.get(i);var s=e.apply(this,n);return r.cache=o.set(i,s),s};return r.cache=new(K.Cache||k),r}function H(e,t){return e===t||e!=e&&t!=t}K.Cache=k;var J=Array.isArray;function V(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function X(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&N.call(e)==c}e.exports=function(e,t,n){return null==e?e:q(e,t,n)}}).call(this,n(4))},function(e,t,n){(function(t){var n="Expected a function",r="__lodash_hash_undefined__",i=1/0,o="[object Function]",s="[object GeneratorFunction]",a="[object Symbol]",c=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,u=/^\w*$/,l=/^\./,f=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,h=/\\(\\)?/g,p=/^\[object .+?Constructor\]$/,d="object"==typeof t&&t&&t.Object===Object&&t,_="object"==typeof self&&self&&self.Object===Object&&self,y=d||_||Function("return this")();var g,m=Array.prototype,b=Function.prototype,v=Object.prototype,w=y["__core-js_shared__"],E=(g=/[^.]+$/.exec(w&&w.keys&&w.keys.IE_PROTO||""))?"Symbol(src)_1."+g:"",S=b.toString,A=v.hasOwnProperty,T=v.toString,O=RegExp("^"+S.call(A).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),N=y.Symbol,I=m.splice,B=q(y,"Map"),R=q(Object,"create"),D=N?N.prototype:void 0,C=D?D.toString:void 0;function P(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function x(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function L(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function M(e,t){for(var n,r,i=e.length;i--;)if((n=e[i][0])===(r=t)||n!=n&&r!=r)return i;return-1}function k(e){return!(!K(e)||(t=e,E&&E in t))&&(function(e){var t=K(e)?T.call(e):"";return t==o||t==s}(e)||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}(e)?O:p).test(function(e){if(null!=e){try{return S.call(e)}catch(e){}try{return e+""}catch(e){}}return""}(e));var t}function j(e,t){e=function(e,t){return 1==t.length?e:function(e,t){for(var n=0,r=(t=F(t,e)?[t]:$(t)).length;null!=e&&n<r;)e=e[W(t[n++])];return n&&n==r?e:void 0}(e,function(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(n=n>i?i:n)<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var o=Array(i);++r<i;)o[r]=e[r+t];return o}(t,0,-1))}(e,t=F(t,e)?[t]:$(t));var n,r,i=W((r=(n=t)?n.length:0)?n[r-1]:void 0);return!(null!=e&&A.call(e,i))||delete e[i]}function $(e){return Y(e)?e:z(e)}function U(e,t){var n,r,i=e.__data__;return("string"==(r=typeof(n=t))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof t?"string":"hash"]:i.map}function q(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return k(n)?n:void 0}function F(e,t){if(Y(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!H(e))||(u.test(e)||!c.test(e)||null!=t&&e in Object(t))}P.prototype.clear=function(){this.__data__=R?R(null):{}},P.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},P.prototype.get=function(e){var t=this.__data__;if(R){var n=t[e];return n===r?void 0:n}return A.call(t,e)?t[e]:void 0},P.prototype.has=function(e){var t=this.__data__;return R?void 0!==t[e]:A.call(t,e)},P.prototype.set=function(e,t){return this.__data__[e]=R&&void 0===t?r:t,this},x.prototype.clear=function(){this.__data__=[]},x.prototype.delete=function(e){var t=this.__data__,n=M(t,e);return!(n<0)&&(n==t.length-1?t.pop():I.call(t,n,1),!0)},x.prototype.get=function(e){var t=this.__data__,n=M(t,e);return n<0?void 0:t[n][1]},x.prototype.has=function(e){return M(this.__data__,e)>-1},x.prototype.set=function(e,t){var n=this.__data__,r=M(n,e);return r<0?n.push([e,t]):n[r][1]=t,this},L.prototype.clear=function(){this.__data__={hash:new P,map:new(B||x),string:new P}},L.prototype.delete=function(e){return U(this,e).delete(e)},L.prototype.get=function(e){return U(this,e).get(e)},L.prototype.has=function(e){return U(this,e).has(e)},L.prototype.set=function(e,t){return U(this,e).set(e,t),this};var z=G((function(e){var t;e=null==(t=e)?"":function(e){if("string"==typeof e)return e;if(H(e))return C?C.call(e):"";var t=e+"";return"0"==t&&1/e==-i?"-0":t}(t);var n=[];return l.test(e)&&n.push(""),e.replace(f,(function(e,t,r,i){n.push(r?i.replace(h,"$1"):t||e)})),n}));function W(e){if("string"==typeof e||H(e))return e;var t=e+"";return"0"==t&&1/e==-i?"-0":t}function G(e,t){if("function"!=typeof e||t&&"function"!=typeof t)throw new TypeError(n);var r=function(){var n=arguments,i=t?t.apply(this,n):n[0],o=r.cache;if(o.has(i))return o.get(i);var s=e.apply(this,n);return r.cache=o.set(i,s),s};return r.cache=new(G.Cache||L),r}G.Cache=L;var Y=Array.isArray;function K(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function H(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&T.call(e)==a}e.exports=function(e,t){return null==e||j(e,t)}}).call(this,n(4))},function(e,t,n){(function(e,n){var r=200,i="__lodash_hash_undefined__",o=9007199254740991,s="[object Arguments]",a="[object Boolean]",c="[object Date]",u="[object Function]",l="[object GeneratorFunction]",f="[object Map]",h="[object Number]",p="[object Object]",d="[object RegExp]",_="[object Set]",y="[object String]",g="[object Symbol]",m="[object ArrayBuffer]",b="[object DataView]",v="[object Float32Array]",w="[object Float64Array]",E="[object Int8Array]",S="[object Int16Array]",A="[object Int32Array]",T="[object Uint8Array]",O="[object Uint8ClampedArray]",N="[object Uint16Array]",I="[object Uint32Array]",B=/\w*$/,R=/^\[object .+?Constructor\]$/,D=/^(?:0|[1-9]\d*)$/,C={};C[s]=C["[object Array]"]=C[m]=C[b]=C[a]=C[c]=C[v]=C[w]=C[E]=C[S]=C[A]=C[f]=C[h]=C[p]=C[d]=C[_]=C[y]=C[g]=C[T]=C[O]=C[N]=C[I]=!0,C["[object Error]"]=C[u]=C["[object WeakMap]"]=!1;var P="object"==typeof e&&e&&e.Object===Object&&e,x="object"==typeof self&&self&&self.Object===Object&&self,L=P||x||Function("return this")(),M=t&&!t.nodeType&&t,k=M&&"object"==typeof n&&n&&!n.nodeType&&n,j=k&&k.exports===M;function $(e,t){return e.set(t[0],t[1]),e}function U(e,t){return e.add(t),e}function q(e,t,n,r){var i=-1,o=e?e.length:0;for(r&&o&&(n=e[++i]);++i<o;)n=t(n,e[i],i,e);return n}function F(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}function z(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n}function W(e,t){return function(n){return e(t(n))}}function G(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}var Y,K=Array.prototype,H=Function.prototype,J=Object.prototype,V=L["__core-js_shared__"],X=(Y=/[^.]+$/.exec(V&&V.keys&&V.keys.IE_PROTO||""))?"Symbol(src)_1."+Y:"",Q=H.toString,Z=J.hasOwnProperty,ee=J.toString,te=RegExp("^"+Q.call(Z).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ne=j?L.Buffer:void 0,re=L.Symbol,ie=L.Uint8Array,oe=W(Object.getPrototypeOf,Object),se=Object.create,ae=J.propertyIsEnumerable,ce=K.splice,ue=Object.getOwnPropertySymbols,le=ne?ne.isBuffer:void 0,fe=W(Object.keys,Object),he=ke(L,"DataView"),pe=ke(L,"Map"),de=ke(L,"Promise"),_e=ke(L,"Set"),ye=ke(L,"WeakMap"),ge=ke(Object,"create"),me=Fe(he),be=Fe(pe),ve=Fe(de),we=Fe(_e),Ee=Fe(ye),Se=re?re.prototype:void 0,Ae=Se?Se.valueOf:void 0;function Te(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Oe(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Ne(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Ie(e){this.__data__=new Oe(e)}function Be(e,t){var n=We(e)||function(e){return function(e){return function(e){return!!e&&"object"==typeof e}(e)&&Ge(e)}(e)&&Z.call(e,"callee")&&(!ae.call(e,"callee")||ee.call(e)==s)}(e)?function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}(e.length,String):[],r=n.length,i=!!r;for(var o in e)!t&&!Z.call(e,o)||i&&("length"==o||Ue(o,r))||n.push(o);return n}function Re(e,t,n){var r=e[t];Z.call(e,t)&&ze(r,n)&&(void 0!==n||t in e)||(e[t]=n)}function De(e,t){for(var n=e.length;n--;)if(ze(e[n][0],t))return n;return-1}function Ce(e,t,n,r,i,o,R){var D;if(r&&(D=o?r(e,i,o,R):r(e)),void 0!==D)return D;if(!He(e))return e;var P=We(e);if(P){if(D=function(e){var t=e.length,n=e.constructor(t);t&&"string"==typeof e[0]&&Z.call(e,"index")&&(n.index=e.index,n.input=e.input);return n}(e),!t)return function(e,t){var n=-1,r=e.length;t||(t=Array(r));for(;++n<r;)t[n]=e[n];return t}(e,D)}else{var x=$e(e),L=x==u||x==l;if(Ye(e))return function(e,t){if(t)return e.slice();var n=new e.constructor(e.length);return e.copy(n),n}(e,t);if(x==p||x==s||L&&!o){if(F(e))return o?e:{};if(D=function(e){return"function"!=typeof e.constructor||qe(e)?{}:(t=oe(e),He(t)?se(t):{});var t}(L?{}:e),!t)return function(e,t){return Le(e,je(e),t)}(e,function(e,t){return e&&Le(t,Je(t),e)}(D,e))}else{if(!C[x])return o?e:{};D=function(e,t,n,r){var i=e.constructor;switch(t){case m:return xe(e);case a:case c:return new i(+e);case b:return function(e,t){var n=t?xe(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}(e,r);case v:case w:case E:case S:case A:case T:case O:case N:case I:return function(e,t){var n=t?xe(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}(e,r);case f:return function(e,t,n){return q(t?n(z(e),!0):z(e),$,new e.constructor)}(e,r,n);case h:case y:return new i(e);case d:return function(e){var t=new e.constructor(e.source,B.exec(e));return t.lastIndex=e.lastIndex,t}(e);case _:return function(e,t,n){return q(t?n(G(e),!0):G(e),U,new e.constructor)}(e,r,n);case g:return o=e,Ae?Object(Ae.call(o)):{}}var o}(e,x,Ce,t)}}R||(R=new Ie);var M=R.get(e);if(M)return M;if(R.set(e,D),!P)var k=n?function(e){return function(e,t,n){var r=t(e);return We(e)?r:function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}(r,n(e))}(e,Je,je)}(e):Je(e);return function(e,t){for(var n=-1,r=e?e.length:0;++n<r&&!1!==t(e[n],n,e););}(k||e,(function(i,o){k&&(i=e[o=i]),Re(D,o,Ce(i,t,n,r,o,e,R))})),D}function Pe(e){return!(!He(e)||(t=e,X&&X in t))&&(Ke(e)||F(e)?te:R).test(Fe(e));var t}function xe(e){var t=new e.constructor(e.byteLength);return new ie(t).set(new ie(e)),t}function Le(e,t,n,r){n||(n={});for(var i=-1,o=t.length;++i<o;){var s=t[i],a=r?r(n[s],e[s],s,n,e):void 0;Re(n,s,void 0===a?e[s]:a)}return n}function Me(e,t){var n,r,i=e.__data__;return("string"==(r=typeof(n=t))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof t?"string":"hash"]:i.map}function ke(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return Pe(n)?n:void 0}Te.prototype.clear=function(){this.__data__=ge?ge(null):{}},Te.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},Te.prototype.get=function(e){var t=this.__data__;if(ge){var n=t[e];return n===i?void 0:n}return Z.call(t,e)?t[e]:void 0},Te.prototype.has=function(e){var t=this.__data__;return ge?void 0!==t[e]:Z.call(t,e)},Te.prototype.set=function(e,t){return this.__data__[e]=ge&&void 0===t?i:t,this},Oe.prototype.clear=function(){this.__data__=[]},Oe.prototype.delete=function(e){var t=this.__data__,n=De(t,e);return!(n<0)&&(n==t.length-1?t.pop():ce.call(t,n,1),!0)},Oe.prototype.get=function(e){var t=this.__data__,n=De(t,e);return n<0?void 0:t[n][1]},Oe.prototype.has=function(e){return De(this.__data__,e)>-1},Oe.prototype.set=function(e,t){var n=this.__data__,r=De(n,e);return r<0?n.push([e,t]):n[r][1]=t,this},Ne.prototype.clear=function(){this.__data__={hash:new Te,map:new(pe||Oe),string:new Te}},Ne.prototype.delete=function(e){return Me(this,e).delete(e)},Ne.prototype.get=function(e){return Me(this,e).get(e)},Ne.prototype.has=function(e){return Me(this,e).has(e)},Ne.prototype.set=function(e,t){return Me(this,e).set(e,t),this},Ie.prototype.clear=function(){this.__data__=new Oe},Ie.prototype.delete=function(e){return this.__data__.delete(e)},Ie.prototype.get=function(e){return this.__data__.get(e)},Ie.prototype.has=function(e){return this.__data__.has(e)},Ie.prototype.set=function(e,t){var n=this.__data__;if(n instanceof Oe){var i=n.__data__;if(!pe||i.length<r-1)return i.push([e,t]),this;n=this.__data__=new Ne(i)}return n.set(e,t),this};var je=ue?W(ue,Object):function(){return[]},$e=function(e){return ee.call(e)};function Ue(e,t){return!!(t=null==t?o:t)&&("number"==typeof e||D.test(e))&&e>-1&&e%1==0&&e<t}function qe(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||J)}function Fe(e){if(null!=e){try{return Q.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function ze(e,t){return e===t||e!=e&&t!=t}(he&&$e(new he(new ArrayBuffer(1)))!=b||pe&&$e(new pe)!=f||de&&"[object Promise]"!=$e(de.resolve())||_e&&$e(new _e)!=_||ye&&"[object WeakMap]"!=$e(new ye))&&($e=function(e){var t=ee.call(e),n=t==p?e.constructor:void 0,r=n?Fe(n):void 0;if(r)switch(r){case me:return b;case be:return f;case ve:return"[object Promise]";case we:return _;case Ee:return"[object WeakMap]"}return t});var We=Array.isArray;function Ge(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=o}(e.length)&&!Ke(e)}var Ye=le||function(){return!1};function Ke(e){var t=He(e)?ee.call(e):"";return t==u||t==l}function He(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function Je(e){return Ge(e)?Be(e):function(e){if(!qe(e))return fe(e);var t=[];for(var n in Object(e))Z.call(e,n)&&"constructor"!=n&&t.push(n);return t}(e)}n.exports=function(e){return Ce(e,!0,!0)}}).call(this,n(4),n(20)(e))},function(e,t,n){n(18),e.exports=n(19)},function(e,t,n){var r=function(e){"use strict";var t,n=Object.prototype,r=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag";function c(e,t,n,r){var i=t&&t.prototype instanceof _?t:_,o=Object.create(i.prototype),s=new N(r||[]);return o._invoke=function(e,t,n){var r=l;return function(i,o){if(r===h)throw new Error("Generator is already running");if(r===p){if("throw"===i)throw o;return B()}for(n.method=i,n.arg=o;;){var s=n.delegate;if(s){var a=A(s,n);if(a){if(a===d)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===l)throw r=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=h;var c=u(e,t,n);if("normal"===c.type){if(r=n.done?p:f,c.arg===d)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r=p,n.method="throw",n.arg=c.arg)}}}(e,n,s),o}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var l="suspendedStart",f="suspendedYield",h="executing",p="completed",d={};function _(){}function y(){}function g(){}var m={};m[o]=function(){return this};var b=Object.getPrototypeOf,v=b&&b(b(I([])));v&&v!==n&&r.call(v,o)&&(m=v);var w=g.prototype=_.prototype=Object.create(m);function E(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function S(e){var t;this._invoke=function(n,i){function o(){return new Promise((function(t,o){!function t(n,i,o,s){var a=u(e[n],e,i);if("throw"!==a.type){var c=a.arg,l=c.value;return l&&"object"==typeof l&&r.call(l,"__await")?Promise.resolve(l.__await).then((function(e){t("next",e,o,s)}),(function(e){t("throw",e,o,s)})):Promise.resolve(l).then((function(e){c.value=e,o(c)}),(function(e){return t("throw",e,o,s)}))}s(a.arg)}(n,i,t,o)}))}return t=t?t.then(o,o):o()}}function A(e,n){var r=e.iterator[n.method];if(r===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,A(e,n),"throw"===n.method))return d;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var i=u(r,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,d;var o=i.arg;return o?o.done?(n[e.resultName]=o.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,d):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,d)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function N(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function I(e){if(e){var n=e[o];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return s.next=s}}return{next:B}}function B(){return{value:t,done:!0}}return y.prototype=w.constructor=g,g.constructor=y,g[a]=y.displayName="GeneratorFunction",e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,a in e||(e[a]="GeneratorFunction")),e.prototype=Object.create(w),e},e.awrap=function(e){return{__await:e}},E(S.prototype),S.prototype[s]=function(){return this},e.AsyncIterator=S,e.async=function(t,n,r,i){var o=new S(c(t,n,r,i));return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},E(w),w[a]="Generator",w[o]=function(){return this},w.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=I,N.prototype={constructor:N,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(O),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return a.type="throw",a.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var s=this.tryEntries[o],a=s.completion;if("root"===s.tryLoc)return i("end");if(s.tryLoc<=this.prev){var c=r.call(s,"catchLoc"),u=r.call(s,"finallyLoc");if(c&&u){if(this.prev<s.catchLoc)return i(s.catchLoc,!0);if(this.prev<s.finallyLoc)return i(s.finallyLoc)}else if(c){if(this.prev<s.catchLoc)return i(s.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return i(s.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,d):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),O(n),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;O(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:I(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),d}},e}(e.exports);try{regeneratorRuntime=r}catch(e){Function("r","regeneratorRuntime = r")(r)}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t},c=n(39),u=s(n(40)),l=n(24),f=a(n(37)),h=a(n(38)),p=n(9),d=n(7),_=n(6),y=n(10),g=n(2),m=n(11),b={timeout:15e3,persistence:"session"},v={},w=new(function(){function e(e){this.config=e||this.config,this.authObj=void 0,_.Adapter.adapter&&(this.requestClient=new _.Adapter.adapter.reqClass({timeout:this.config.timeout,timeoutMsg:"[tcb-js-sdk] 请求在"+this.config.timeout/1e3+"s内未完成，已中断"}))}return e.prototype.init=function(t){if(_.Adapter.adapter||(this._useDefaultAdapter(),this.requestClient=new _.Adapter.adapter.reqClass({timeout:t.timeout||5e3,timeoutMsg:"[tcb-js-sdk] 请求在"+(t.timeout||5e3)/1e3+"s内未完成，已中断"})),_.Adapter.runtime!==_.RUNTIME.WEB){if(!t.appSecret)throw new Error("[tcb-js-sdk]参数错误：请正确配置appSecret");var n=_.Adapter.adapter.getAppSign?_.Adapter.adapter.getAppSign():"";if(t.appSign&&n&&t.appSign!==n)throw new Error("[tcb-js-sdk]参数错误：非法的应用标识");if(n&&(t.appSign=n),!t.appSign)throw new Error("[tcb-js-sdk]参数错误：请正确配置应用标识")}switch(this.config=r(r({},b),t),!0){case this.config.timeout>6e5:console.warn("[tcb-js-sdk] timeout大于可配置上限[10分钟]，已重置为上限数值"),this.config.timeout=6e5;break;case this.config.timeout<100:console.warn("[tcb-js-sdk] timeout小于可配置下限[100ms]，已重置为下限数值"),this.config.timeout=100}return new e(this.config)},e.prototype.database=function(e){if(c.Db.reqClass=p.IRequest,c.Db.wsClass=_.Adapter.adapter.wsClass,this.authObj)return c.Db.getAccessToken=this.authObj.getAccessToken.bind(this.authObj),c.Db.runtime=_.Adapter.runtime,_.Adapter.runtime!==_.RUNTIME.WEB&&(c.Db.dataVersion=y.dataVersion,c.Db.createSign=g.createSign,c.Db.appSecretInfo=r({appSign:this.config.appSign},this.config.appSecret)),c.Db.ws||(c.Db.ws=null),new c.Db(r(r({},this.config),e));console.warn("需要app.auth()授权")},e.prototype.auth=function(e){var t=(void 0===e?{}:e).persistence;if(this.authObj)return console.warn("tcb实例只存在一个auth对象"),this.authObj;var n=t||_.Adapter.adapter.primaryStorage||b.persistence;return n!==this.config.persistence&&(this.config.persistence=n),m.initCache(this.config),p.initRequest(this.config),this.authObj=new l.Auth(this.config),this.authObj},e.prototype.on=function(e,t){return d.addEventListener.apply(this,[e,t])},e.prototype.off=function(e,t){return d.removeEventListener.apply(this,[e,t])},e.prototype.callFunction=function(e,t){return h.callFunction.apply(this,[e,t])},e.prototype.deleteFile=function(e,t){return f.deleteFile.apply(this,[e,t])},e.prototype.getTempFileURL=function(e,t){return f.getTempFileURL.apply(this,[e,t])},e.prototype.downloadFile=function(e,t){return f.downloadFile.apply(this,[e,t])},e.prototype.uploadFile=function(e,t){return f.uploadFile.apply(this,[e,t])},e.prototype.getUploadMetadata=function(e,t){return f.getUploadMetadata.apply(this,[e,t])},e.prototype.registerExtension=function(e){v[e.name]=e},e.prototype.invokeExtension=function(e,t){return i(this,void 0,void 0,(function(){var n;return o(this,(function(r){switch(r.label){case 0:if(!(n=v[e]))throw Error("扩展"+e+" 必须先注册");return[4,n.invoke(t,this)];case 1:return[2,r.sent()]}}))}))},e.prototype.useAdapters=function(e){var t=_.useAdapters(e)||{},n=t.adapter,r=t.runtime;n&&(_.Adapter.adapter=n),r&&(_.Adapter.runtime=r)},e.prototype._useDefaultAdapter=function(){var e=_.useDefaultAdapter(),t=e.adapter,n=e.runtime;_.Adapter.adapter=t,_.Adapter.runtime=n},e}());w.useAdapters(u.default);try{window.tcb=w}catch(e){}e.exports=w},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";t.byteLength=function(e){var t=u(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,r=u(e),s=r[0],a=r[1],c=new o(function(e,t,n){return 3*(t+n)/4-n}(0,s,a)),l=0,f=a>0?s-4:s;for(n=0;n<f;n+=4)t=i[e.charCodeAt(n)]<<18|i[e.charCodeAt(n+1)]<<12|i[e.charCodeAt(n+2)]<<6|i[e.charCodeAt(n+3)],c[l++]=t>>16&255,c[l++]=t>>8&255,c[l++]=255&t;2===a&&(t=i[e.charCodeAt(n)]<<2|i[e.charCodeAt(n+1)]>>4,c[l++]=255&t);1===a&&(t=i[e.charCodeAt(n)]<<10|i[e.charCodeAt(n+1)]<<4|i[e.charCodeAt(n+2)]>>2,c[l++]=t>>8&255,c[l++]=255&t);return c},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,o=[],s=0,a=n-i;s<a;s+=16383)o.push(l(e,s,s+16383>a?a:s+16383));1===i?(t=e[n-1],o.push(r[t>>2]+r[t<<4&63]+"==")):2===i&&(t=(e[n-2]<<8)+e[n-1],o.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"="));return o.join("")};for(var r=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,c=s.length;a<c;++a)r[a]=s[a],i[s.charCodeAt(a)]=a;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function l(e,t,n){for(var i,o,s=[],a=t;a<n;a+=3)i=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(r[(o=i)>>18&63]+r[o>>12&63]+r[o>>6&63]+r[63&o]);return s.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,n,r,i){var o,s,a=8*i-r-1,c=(1<<a)-1,u=c>>1,l=-7,f=n?i-1:0,h=n?-1:1,p=e[t+f];for(f+=h,o=p&(1<<-l)-1,p>>=-l,l+=a;l>0;o=256*o+e[t+f],f+=h,l-=8);for(s=o&(1<<-l)-1,o>>=-l,l+=r;l>0;s=256*s+e[t+f],f+=h,l-=8);if(0===o)o=1-u;else{if(o===c)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,r),o-=u}return(p?-1:1)*s*Math.pow(2,o-r)},t.write=function(e,t,n,r,i,o){var s,a,c,u=8*o-i-1,l=(1<<u)-1,f=l>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,d=r?1:-1,_=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=l):(s=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-s))<1&&(s--,c*=2),(t+=s+f>=1?h/c:h*Math.pow(2,1-f))*c>=2&&(s++,c/=2),s+f>=l?(a=0,s=l):s+f>=1?(a=(t*c-1)*Math.pow(2,i),s+=f):(a=t*Math.pow(2,f-1)*Math.pow(2,i),s=0));i>=8;e[n+p]=255&a,p+=d,a/=256,i-=8);for(s=s<<i|a,u+=i;u>0;e[n+p]=255&s,p+=d,s/=256,u-=8);e[n+p-d]|=128*_}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},s=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var c=n(25),u=n(36),l=n(8),f=n(7),h=function(e){function t(t){var n=e.call(this,t)||this;return n.config=t,n.customAuthProvider=new l.AuthProvider(n.config),n._onAnonymousConverted=n._onAnonymousConverted.bind(n),n._onLoginTypeChanged=n._onLoginTypeChanged.bind(n),f.addEventListener(f.EVENTS.LOGIN_TYPE_CHANGED,n._onLoginTypeChanged),n}return i(t,e),Object.defineProperty(t.prototype,"loginType",{get:function(){return this._cache.getStore(this._cache.keys.loginTypeKey)},enumerable:!0,configurable:!0}),t.prototype.weixinAuthProvider=function(e){var t=e.appid,n=e.scope,r=e.loginMode,i=e.state;return new c.WeixinAuthProvider(this.config,t,n,r,i)},t.prototype.signInAnonymously=function(){return s(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return this._anonymousAuthProvider||(this._anonymousAuthProvider=new u.AnonymousAuthProvider(this.config)),[4,this._anonymousAuthProvider.signIn()];case 1:return[2,e.sent()]}}))}))},t.prototype.linkAndRetrieveDataWithTicket=function(e){return s(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return this._anonymousAuthProvider||(this._anonymousAuthProvider=new u.AnonymousAuthProvider(this.config)),f.addEventListener(f.EVENTS.ANONYMOUS_CONVERTED,this._onAnonymousConverted),[4,this._anonymousAuthProvider.linkAndRetrieveDataWithTicket(e)];case 1:return[2,t.sent()]}}))}))},t.prototype.signOut=function(){return s(this,void 0,void 0,(function(){var e,t,n,r,i,o;return a(this,(function(s){switch(s.label){case 0:if(this.loginType===l.LOGINTYPE.ANONYMOUS)throw new Error("[tcb-js-sdk] 匿名用户不支持登出操作");return e=this._cache.keys,t=e.refreshTokenKey,n=e.accessTokenKey,r=e.accessTokenExpireKey,"auth.logout",(i=this._cache.getStore(t))?[4,this._request.send("auth.logout",{refresh_token:i})]:[2];case 1:return o=s.sent(),this._cache.removeStore(t),this._cache.removeStore(n),this._cache.removeStore(r),f.activateEvent(f.EVENTS.LOGIN_STATE_CHANGED),f.activateEvent(f.EVENTS.LOGIN_TYPE_CHANGED,{env:this.config.env,loginType:l.LOGINTYPE.NULL,persistence:this.config.persistence}),[2,o]}}))}))},t.prototype.getAccessToken=function(){return s(this,void 0,void 0,(function(){var e;return a(this,(function(t){switch(t.label){case 0:return e={},[4,this._request.getAccessToken()];case 1:return[2,(e.accessToken=t.sent().accessToken,e.env=this.config.env,e)]}}))}))},t.prototype.onLoginStateExpire=function(e){f.addEventListener("loginStateExpire",e)},t.prototype.getLoginState=function(){return s(this,void 0,void 0,(function(){var e,t,n,r;return a(this,(function(i){switch(i.label){case 0:if(e=this._cache.keys,t=e.refreshTokenKey,n=e.accessTokenKey,!(r=this._cache.getStore(t)))return[3,5];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this._request.refreshAccessToken()];case 2:return i.sent(),[3,4];case 3:return i.sent(),[2,null];case 4:return[2,{isAnonymous:this.loginType===l.LOGINTYPE.ANONYMOUS,credential:{refreshToken:r,accessToken:this._cache.getStore(n)}}];case 5:return[2,null]}}))}))},t.prototype.signInWithTicket=function(e){return s(this,void 0,void 0,(function(){var t,n;return a(this,(function(r){switch(r.label){case 0:if("string"!=typeof e)throw new Error("ticket must be a string");return t=this._cache.keys.refreshTokenKey,[4,this._request.send("auth.signInWithTicket",{ticket:e,refresh_token:this._cache.getStore(t)||""})];case 1:return(n=r.sent()).refresh_token?(this.customAuthProvider.setRefreshToken(n.refresh_token),[4,this._request.refreshAccessToken()]):[3,3];case 2:return r.sent(),f.activateEvent(f.EVENTS.LOGIN_STATE_CHANGED),f.activateEvent(f.EVENTS.LOGIN_TYPE_CHANGED,{env:this.config.env,loginType:l.LOGINTYPE.CUSTOM,persistence:this.config.persistence}),[2,{credential:{refreshToken:n.refresh_token}}];case 3:throw new Error("[tcb-js-sdk] 自定义登录失败")}}))}))},t.prototype.shouldRefreshAccessToken=function(e){this._request._shouldRefreshAccessTokenHook=e.bind(this)},t.prototype.getUserInfo=function(){return this._request.send("auth.getUserInfo",{}).then((function(e){return e.code?e:o(o({},e.data),{requestId:e.seqId})}))},t.prototype.getAuthHeader=function(){var e=this._cache.keys,t=e.refreshTokenKey,n=e.accessTokenKey,r=this._cache.getStore(t);return{"x-cloudbase-credentials":this._cache.getStore(n)+"/@@/"+r}},t.prototype._onAnonymousConverted=function(e){e.data.env===this.config.env&&this._cache.updatePersistence(this.config.persistence)},t.prototype._onLoginTypeChanged=function(e){var t=e.data,n=t.loginType,r=t.persistence;t.env===this.config.env&&(this._cache.updatePersistence(r),this._cache.setStore(this._cache.keys.loginTypeKey,n))},t}(l.AuthProvider);t.Auth=h},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var c,u,l=a(n(2)),f=n(8),h=n(7),p=n(6);!function(e){e.snsapi_base="snsapi_base",e.snsapi_userinfo="snsapi_userinfo",e.snsapi_login="snsapi_login"}(c||(c={})),function(e){e.redirect="redirect",e.prompt="prompt"}(u||(u={}));var d={},_=function(e){function t(t,n,r,i,o){var s=e.call(this,t)||this;return s.config=t,s.appid=n,s.scope=p.Adapter.runtime===p.RUNTIME.WX_MP?"snsapi_base":r,s.state=o||"weixin",s.loginMode=i||"redirect",s}return i(t,e),t.prototype.signIn=function(){return o(this,void 0,void 0,(function(){var e,t,n;return s(this,(function(r){switch(r.label){case 0:d[this.config.env]||(d[this.config.env]=this._signIn()),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,d[this.config.env]];case 2:return e=r.sent(),[3,4];case 3:return n=r.sent(),t=n,[3,4];case 4:if(d[this.config.env]=null,t)throw t;return[2,e]}}))}))},t.prototype._signIn=function(){return o(this,void 0,void 0,(function(){var e,t,n,r,i,o,a,u,d,_;return s(this,(function(s){switch(s.label){case 0:if(e=this._cache.keys,t=e.accessTokenKey,n=e.accessTokenExpireKey,r=e.refreshTokenKey,i=this._cache.getStore(t),o=this._cache.getStore(n),i){if(o&&o>Date.now())return[2,{credential:{accessToken:i,refreshToken:this._cache.getStore(r)}}];this._cache.removeStore(t),this._cache.removeStore(n)}if(!1===Object.values(c).includes(c[this.scope]))throw new Error("错误的scope类型");return p.Adapter.runtime!==p.RUNTIME.WX_MP?[3,2]:[4,l.getMiniAppCode()];case 1:return a=s.sent(),[3,4];case 2:return[4,l.getWeixinCode()];case 3:if(!(a=s.sent()))return[2,this.redirect()];s.label=4;case 4:return u=function(e){switch(e){case c.snsapi_login:return"WECHAT-OPEN";default:return"WECHAT-PUBLIC"}}(this.scope),[4,this.getRefreshTokenByWXCode(this.appid,u,a)];case 5:return d=s.sent(),_=d.refreshToken,this._cache.setStore(r,_),d.accessToken&&this._cache.setStore(t,d.accessToken),d.accessTokenExpire&&this._cache.setStore(n,d.accessTokenExpire+Date.now()),h.activateEvent(h.EVENTS.LOGIN_STATE_CHANGED),h.activateEvent(h.EVENTS.LOGIN_TYPE_CHANGED,{loginType:f.LOGINTYPE.WECHAT,persistence:this.config.persistence}),[2,{credential:{refreshToken:_}}]}}))}))},t.prototype.redirect=function(){var e=l.removeParam("code",location.href);e=l.removeParam("state",e),e=encodeURIComponent(e);var t="//open.weixin.qq.com/connect/oauth2/authorize";"snsapi_login"===this.scope&&(t="//open.weixin.qq.com/connect/qrconnect"),"redirect"===u[this.loginMode]&&(location.href=t+"?appid="+this.appid+"&redirect_uri="+e+"&response_type=code&scope="+this.scope+"&state="+this.state+"#wechat_redirect")},t}(f.AuthProvider);t.WeixinAuthProvider=_},function(e,t,n){var r;e.exports=(r=n(5),n(27),n(28),r.HmacSHA256)},function(e,t,n){var r;e.exports=(r=n(5),function(e){var t=r,n=t.lib,i=n.WordArray,o=n.Hasher,s=t.algo,a=[],c=[];!function(){function t(t){for(var n=e.sqrt(t),r=2;r<=n;r++)if(!(t%r))return!1;return!0}function n(e){return 4294967296*(e-(0|e))|0}for(var r=2,i=0;i<64;)t(r)&&(i<8&&(a[i]=n(e.pow(r,.5))),c[i]=n(e.pow(r,1/3)),i++),r++}();var u=[],l=s.SHA256=o.extend({_doReset:function(){this._hash=new i.init(a.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],i=n[1],o=n[2],s=n[3],a=n[4],l=n[5],f=n[6],h=n[7],p=0;p<64;p++){if(p<16)u[p]=0|e[t+p];else{var d=u[p-15],_=(d<<25|d>>>7)^(d<<14|d>>>18)^d>>>3,y=u[p-2],g=(y<<15|y>>>17)^(y<<13|y>>>19)^y>>>10;u[p]=_+u[p-7]+g+u[p-16]}var m=r&i^r&o^i&o,b=(r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22),v=h+((a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25))+(a&l^~a&f)+c[p]+u[p];h=f,f=l,l=a,a=s+v|0,s=o,o=i,i=r,r=v+(b+m)|0}n[0]=n[0]+r|0,n[1]=n[1]+i|0,n[2]=n[2]+o|0,n[3]=n[3]+s|0,n[4]=n[4]+a|0,n[5]=n[5]+l|0,n[6]=n[6]+f|0,n[7]=n[7]+h|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,i=8*t.sigBytes;return n[i>>>5]|=128<<24-i%32,n[14+(i+64>>>9<<4)]=e.floor(r/4294967296),n[15+(i+64>>>9<<4)]=r,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=o._createHelper(l),t.HmacSHA256=o._createHmacHelper(l)}(Math),r.SHA256)},function(e,t,n){var r,i,o,s;e.exports=(r=n(5),o=(i=r).lib.Base,s=i.enc.Utf8,void(i.algo.HMAC=o.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=s.parse(t));var n=e.blockSize,r=4*n;t.sigBytes>r&&(t=e.finalize(t)),t.clamp();for(var i=this._oKey=t.clone(),o=this._iKey=t.clone(),a=i.words,c=o.words,u=0;u<n;u++)a[u]^=1549556828,c[u]^=909522486;i.sigBytes=o.sigBytes=r,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,n=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(n))}})))},function(e,t,n){var r,i,o;e.exports=(o=n(5),i=(r=o).lib.WordArray,r.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,r=this._map;e.clamp();for(var i=[],o=0;o<n;o+=3)for(var s=(t[o>>>2]>>>24-o%4*8&255)<<16|(t[o+1>>>2]>>>24-(o+1)%4*8&255)<<8|t[o+2>>>2]>>>24-(o+2)%4*8&255,a=0;a<4&&o+.75*a<n;a++)i.push(r.charAt(s>>>6*(3-a)&63));var c=r.charAt(64);if(c)for(;i.length%4;)i.push(c);return i.join("")},parse:function(e){var t=e.length,n=this._map,r=this._reverseMap;if(!r){r=this._reverseMap=[];for(var o=0;o<n.length;o++)r[n.charCodeAt(o)]=o}var s=n.charAt(64);if(s){var a=e.indexOf(s);-1!==a&&(t=a)}return function(e,t,n){for(var r=[],o=0,s=0;s<t;s++)if(s%4){var a=n[e.charCodeAt(s-1)]<<s%4*2,c=n[e.charCodeAt(s)]>>>6-s%4*2;r[o>>>2]|=(a|c)<<24-o%4*8,o++}return i.create(r,o)}(e,t,r)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},o.enc.Base64)},function(e,t,n){var r;e.exports=(r=n(5),r.enc.Utf8)},function(e){e.exports=JSON.parse('{"name":"tcb-js-sdk","version":"1.4.0-beta","description":"js sdk for tcb","main":"dist/index.js","types":"./dist/index.d.ts","scripts":{"build":"npm run tsc && webpack","tsc":"tsc -p tsconfig.json","tsc:w":"tsc -p tsconfig.json -w","test":"jest --verbose false -i","e2e":"NODE_ENV=e2e webpack && jest --config=\\"./jest.e2e.config.js\\"  --verbose false -i \\"e2e\\"","start":"webpack-dev-server --hot --open","eslint":"eslint \\"./**/*.js\\" \\"./**/*.ts\\"","eslint-fix":"eslint --fix \\"./**/*.js\\" \\"./**/*.ts\\"","test_web":"npm run tsc && webpack-dev-server --devtool eval-source-map --progress --colors --hot --inline --content-base ./dist --host jimmytest-088bef.tcb.qcloud.la --port 80 --disableHostCheck true --mode development --config webpack.test.js"},"repository":{"type":"git","url":"https://github.com/TencentCloudBase/tcb-js-sdk"},"keywords":["tcb","js-sdk"],"author":"jimmyjzhang","license":"ISC","dependencies":{"@cloudbase/adapter-interface":"^0.4.0","@cloudbase/adapter-wx_mp":"^0.3.0","@cloudbase/database":"0.9.11-rc.0","axios":"^0.19.1","crypto-js":"^3.1.9-1","fingerprintjs2":"^2.1.0","url":"^0.11.0"},"devDependencies":{"@babel/core":"^7.6.2","@babel/plugin-proposal-class-properties":"^7.5.5","@babel/plugin-proposal-object-rest-spread":"^7.6.2","@babel/plugin-transform-runtime":"^7.6.2","@babel/preset-env":"^7.6.2","@babel/preset-typescript":"^7.6.0","@babel/runtime":"^7.6.2","@types/jest":"^23.1.4","@types/node":"^10.14.4","babel-eslint":"^10.0.1","babel-loader":"^8.0.6","dts-bundle":"^0.7.3","eslint":"^5.16.0","eslint-config-alloy":"^1.4.2","eslint-config-prettier":"^4.1.0","eslint-plugin-prettier":"^3.0.1","eslint-plugin-typescript":"^1.0.0-rc.3","express":"^4.17.1","husky":"^3.1.0","jest":"^24.7.1","jest-puppeteer":"^4.3.0","lint-staged":"^9.5.0","power-assert":"^1.6.1","puppeteer":"^1.20.0","serve-static":"^1.14.1","ts-jest":"^23.10.4","ts-loader":"^6.2.1","typescript":"^3.4.3","typescript-eslint-parser":"^22.0.0","webpack":"^4.41.3","webpack-bundle-analyzer":"^3.4.1","webpack-cli":"^3.3.0","webpack-dev-server":"^3.3.1","webpack-visualizer-plugin":"^0.1.11"},"husky":{"hooks":{"pre-commit":"lint-staged"}},"lint-staged":{"*.{js,ts}":["eslint --fix","git add"]}}')},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},s=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var c=n(13),u=n(10),l=n(2),f=function(e){function t(t){var n=e.call(this)||this,r=t.timeout,i=t.timeoutMsg,o=t.restrictedMethods;return n._timeout=r||0,n._timeoutMsg=i||"请求超时",n._restrictedMethods=o||["get","post","upload","download"],n}return i(t,e),t.prototype.get=function(e){return this._request(o(o({},e),{method:"get"}),this._restrictedMethods.includes("get"))},t.prototype.post=function(e){return this._request(o(o({},e),{method:"post"}),this._restrictedMethods.includes("post"))},t.prototype.put=function(e){return this._request(o(o({},e),{method:"put"}))},t.prototype.upload=function(e){var t=e.data,n=e.file,r=e.name,i=new FormData;for(var s in t)i.append(s,t[s]);return i.append("key",r),i.append("file",n),this._request(o(o({},e),{data:i,method:"post"}),this._restrictedMethods.includes("upload"))},t.prototype.download=function(e){return s(this,void 0,void 0,(function(){var t,n;return a(this,(function(r){return t=decodeURIComponent(new URL(e.url).pathname.split("/").pop()||""),(n=document.createElement("a")).href=e.url,n.setAttribute("download",t),n.setAttribute("target","_blank"),document.body.appendChild(n),n.click(),[2,new Promise((function(t){t({statusCode:200,tempFilePath:e.url})}))]}))}))},t.prototype._request=function(e,t){var n=this;void 0===t&&(t=!1);var r=String(e.method).toLowerCase()||"get";return new Promise((function(i){var o,s,a=e.url,c=e.headers,f=void 0===c?{}:c,h=e.data,p=e.responseType,d=e.withCredentials,_=e.body,y=l.formatUrl(u.protocol,a,"get"===r?h:{}),g=new XMLHttpRequest;for(var m in g.open(r,y),p&&(g.responseType=p),f)g.setRequestHeader(m,f[m]);g.onreadystatechange=function(){var e={};if(g.readyState===g.HEADERS_RECEIVED){var t=g.getAllResponseHeaders().trim().split(/[\r\n]+/),n={};t.forEach((function(e){var t=e.split(": "),r=t.shift().toLowerCase(),i=t.join(": ");n[r]=i})),e.header=n}if(4===g.readyState){e.statusCode=g.status;try{e.data=JSON.parse(g.responseText)}catch(t){e.data=g.responseText}clearTimeout(o),i(e)}},t&&n._timeout&&(o=setTimeout((function(){console.warn(n._timeoutMsg),g.abort()}),n._timeout)),s=l.isFormData(h)?h:"application/x-www-form-urlencoded"===f["content-type"]?l.toQueryString(h):_||(h?JSON.stringify(h):void 0),d&&(g.withCredentials=!0),g.send(s)}))},t}(c.AbstractSDKRequest);t.WebRequest=f,t.genAdapter=function(){return{root:window,reqClass:f,wsClass:WebSocket,localStorage:localStorage,sessionStorage:sessionStorage}}},function(e,t,n){(function(e){var r=Object.getOwnPropertyDescriptors||function(e){for(var t=Object.keys(e),n={},r=0;r<t.length;r++)n[t[r]]=Object.getOwnPropertyDescriptor(e,t[r]);return n},i=/%[sdj%]/g;t.format=function(e){if(!g(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(a(arguments[n]));return t.join(" ")}n=1;for(var r=arguments,o=r.length,s=String(e).replace(i,(function(e){if("%%"===e)return"%";if(n>=o)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}})),c=r[n];n<o;c=r[++n])_(c)||!v(c)?s+=" "+c:s+=" "+a(c);return s},t.deprecate=function(n,r){if(void 0!==e&&!0===e.noDeprecation)return n;if(void 0===e)return function(){return t.deprecate(n,r).apply(this,arguments)};var i=!1;return function(){if(!i){if(e.throwDeprecation)throw new Error(r);e.traceDeprecation?console.trace(r):console.error(r),i=!0}return n.apply(this,arguments)}};var o,s={};function a(e,n){var r={seen:[],stylize:u};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),d(n)?r.showHidden=n:n&&t._extend(r,n),m(r.showHidden)&&(r.showHidden=!1),m(r.depth)&&(r.depth=2),m(r.colors)&&(r.colors=!1),m(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=c),l(r,e,r.depth)}function c(e,t){var n=a.styles[t];return n?"["+a.colors[n][0]+"m"+e+"["+a.colors[n][1]+"m":e}function u(e,t){return e}function l(e,n,r){if(e.customInspect&&n&&S(n.inspect)&&n.inspect!==t.inspect&&(!n.constructor||n.constructor.prototype!==n)){var i=n.inspect(r,e);return g(i)||(i=l(e,i,r)),i}var o=function(e,t){if(m(t))return e.stylize("undefined","undefined");if(g(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}if(y(t))return e.stylize(""+t,"number");if(d(t))return e.stylize(""+t,"boolean");if(_(t))return e.stylize("null","null")}(e,n);if(o)return o;var s=Object.keys(n),a=function(e){var t={};return e.forEach((function(e,n){t[e]=!0})),t}(s);if(e.showHidden&&(s=Object.getOwnPropertyNames(n)),E(n)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return f(n);if(0===s.length){if(S(n)){var c=n.name?": "+n.name:"";return e.stylize("[Function"+c+"]","special")}if(b(n))return e.stylize(RegExp.prototype.toString.call(n),"regexp");if(w(n))return e.stylize(Date.prototype.toString.call(n),"date");if(E(n))return f(n)}var u,v="",A=!1,T=["{","}"];(p(n)&&(A=!0,T=["[","]"]),S(n))&&(v=" [Function"+(n.name?": "+n.name:"")+"]");return b(n)&&(v=" "+RegExp.prototype.toString.call(n)),w(n)&&(v=" "+Date.prototype.toUTCString.call(n)),E(n)&&(v=" "+f(n)),0!==s.length||A&&0!=n.length?r<0?b(n)?e.stylize(RegExp.prototype.toString.call(n),"regexp"):e.stylize("[Object]","special"):(e.seen.push(n),u=A?function(e,t,n,r,i){for(var o=[],s=0,a=t.length;s<a;++s)I(t,String(s))?o.push(h(e,t,n,r,String(s),!0)):o.push("");return i.forEach((function(i){i.match(/^\d+$/)||o.push(h(e,t,n,r,i,!0))})),o}(e,n,r,a,s):s.map((function(t){return h(e,n,r,a,t,A)})),e.seen.pop(),function(e,t,n){if(e.reduce((function(e,t){return t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60)return n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1];return n[0]+t+" "+e.join(", ")+" "+n[1]}(u,v,T)):T[0]+v+T[1]}function f(e){return"["+Error.prototype.toString.call(e)+"]"}function h(e,t,n,r,i,o){var s,a,c;if((c=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?a=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(a=e.stylize("[Setter]","special")),I(r,i)||(s="["+i+"]"),a||(e.seen.indexOf(c.value)<0?(a=_(n)?l(e,c.value,null):l(e,c.value,n-1)).indexOf("\n")>-1&&(a=o?a.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+a.split("\n").map((function(e){return"   "+e})).join("\n")):a=e.stylize("[Circular]","special")),m(s)){if(o&&i.match(/^\d+$/))return a;(s=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+a}function p(e){return Array.isArray(e)}function d(e){return"boolean"==typeof e}function _(e){return null===e}function y(e){return"number"==typeof e}function g(e){return"string"==typeof e}function m(e){return void 0===e}function b(e){return v(e)&&"[object RegExp]"===A(e)}function v(e){return"object"==typeof e&&null!==e}function w(e){return v(e)&&"[object Date]"===A(e)}function E(e){return v(e)&&("[object Error]"===A(e)||e instanceof Error)}function S(e){return"function"==typeof e}function A(e){return Object.prototype.toString.call(e)}function T(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(n){if(m(o)&&(o=e.env.NODE_DEBUG||""),n=n.toUpperCase(),!s[n])if(new RegExp("\\b"+n+"\\b","i").test(o)){var r=e.pid;s[n]=function(){var e=t.format.apply(t,arguments);console.error("%s %d: %s",n,r,e)}}else s[n]=function(){};return s[n]},t.inspect=a,a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},a.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=p,t.isBoolean=d,t.isNull=_,t.isNullOrUndefined=function(e){return null==e},t.isNumber=y,t.isString=g,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=m,t.isRegExp=b,t.isObject=v,t.isDate=w,t.isError=E,t.isFunction=S,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=n(34);var O=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function N(){var e=new Date,t=[T(e.getHours()),T(e.getMinutes()),T(e.getSeconds())].join(":");return[e.getDate(),O[e.getMonth()],t].join(" ")}function I(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){console.log("%s - %s",N(),t.format.apply(t,arguments))},t.inherits=n(35),t._extend=function(e,t){if(!t||!v(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e};var B="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function R(e,t){if(!e){var n=new Error("Promise was rejected with a falsy value");n.reason=e,e=n}return t(e)}t.promisify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');if(B&&e[B]){var t;if("function"!=typeof(t=e[B]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(t,B,{value:t,enumerable:!1,writable:!1,configurable:!0}),t}function t(){for(var t,n,r=new Promise((function(e,r){t=e,n=r})),i=[],o=0;o<arguments.length;o++)i.push(arguments[o]);i.push((function(e,r){e?n(e):t(r)}));try{e.apply(this,i)}catch(e){n(e)}return r}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),B&&Object.defineProperty(t,B,{value:t,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(t,r(e))},t.promisify.custom=B,t.callbackify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');function n(){for(var n=[],r=0;r<arguments.length;r++)n.push(arguments[r]);var i=n.pop();if("function"!=typeof i)throw new TypeError("The last argument must be of type Function");var o=this,s=function(){return i.apply(o,arguments)};t.apply(this,n).then((function(t){e.nextTick(s,null,t)}),(function(t){e.nextTick(R,t,s)}))}return Object.setPrototypeOf(n,Object.getPrototypeOf(t)),Object.defineProperties(n,r(t)),n}}).call(this,n(12))},function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(8),c=n(7),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.signIn=function(){return o(this,void 0,void 0,(function(){var e,t,n,r,i,o;return s(this,(function(s){switch(s.label){case 0:return this._cache.updatePersistence("local"),e=this._cache.keys,t=e.anonymousUuidKey,n=e.refreshTokenKey,r=this._cache.getStore(t)||void 0,i=this._cache.getStore(n)||void 0,[4,this._request.send("auth.signInAnonymously",{anonymous_uuid:r,refresh_token:i})];case 1:return(o=s.sent()).uuid&&o.refresh_token?(this._setAnonymousUUID(o.uuid),this.setRefreshToken(o.refresh_token),[4,this._request.refreshAccessToken()]):[3,3];case 2:return s.sent(),c.activateEvent(c.EVENTS.LOGIN_STATE_CHANGED),c.activateEvent(c.EVENTS.LOGIN_TYPE_CHANGED,{env:this.config.env,loginType:a.LOGINTYPE.ANONYMOUS,persistence:"local"}),[2,{credential:{refreshToken:o.refresh_token}}];case 3:throw new Error("[tcb-js-sdk] 匿名登录失败")}}))}))},t.prototype.linkAndRetrieveDataWithTicket=function(e){return o(this,void 0,void 0,(function(){var t,n,r,i,o,u;return s(this,(function(s){switch(s.label){case 0:return t=this._cache.keys,n=t.anonymousUuidKey,r=t.refreshTokenKey,i=this._cache.getStore(n),o=this._cache.getStore(r),[4,this._request.send("auth.linkAndRetrieveDataWithTicket",{anonymous_uuid:i,refresh_token:o,ticket:e})];case 1:return(u=s.sent()).refresh_token?(this._clearAnonymousUUID(),this.setRefreshToken(u.refresh_token),[4,this._request.refreshAccessToken()]):[3,3];case 2:return s.sent(),c.activateEvent(c.EVENTS.ANONYMOUS_CONVERTED,{env:this.config.env}),c.activateEvent(c.EVENTS.LOGIN_TYPE_CHANGED,{loginType:a.LOGINTYPE.CUSTOM,persistence:"local"}),[2,{credential:{refreshToken:u.refresh_token}}];case 3:throw new Error("[tcb-js-sdk] 匿名转化失败")}}))}))},t.prototype._setAnonymousUUID=function(e){var t=this._cache.keys,n=t.anonymousUuidKey,r=t.loginTypeKey;this._cache.removeStore(n),this._cache.setStore(n,e),this._cache.setStore(r,a.LOGINTYPE.ANONYMOUS)},t.prototype._clearAnonymousUUID=function(){this._cache.removeStore(this._cache.keys.anonymousUuidKey)},t}(a.AuthProvider);t.AnonymousAuthProvider=u},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(9),s=n(2);t.uploadFile=function(e,t){t=t||s.createPromiseCallback();var n=o.getRequestByEnvId(this.config.env),r=e.cloudPath,i=e.filePath,a=e.onUploadProgress;return n.send("storage.getUploadMetadata",{path:r}).then((function(e){var o=e.data,s=o.url,c=o.authorization,u=o.token,l=o.fileId,f=o.cosFileId,h=e.requestId,p={key:r,signature:c,"x-cos-meta-fileid":f,success_action_status:"201","x-cos-security-token":u};n.upload({url:s,data:p,file:i,name:r,onUploadProgress:a}).then((function(e){201===e.statusCode?t(null,{fileID:l,requestId:h}):t(new Error("STORAGE_REQUEST_FAIL: "+e.data))})).catch((function(e){t(e)}))})).catch((function(e){t(e)})),t.promise},t.getUploadMetadata=function(e,t){t=t||s.createPromiseCallback();var n=o.getRequestByEnvId(this.config.env),r=e.cloudPath,i=e.ci;return n.send("storage.getUploadMetadata",{path:r,ci:i}).then((function(e){t(null,e)})).catch((function(e){t(e)})),t.promise},t.deleteFile=function(e,t){var n=e.fileList;if(t=t||s.createPromiseCallback(),!n||!Array.isArray(n))return{code:"INVALID_PARAM",message:"fileList必须是非空的数组"};for(var r=0,i=n;r<i.length;r++){var a=i[r];if(!a||"string"!=typeof a)return{code:"INVALID_PARAM",message:"fileList的元素必须是非空的字符串"}}var c={fileid_list:n};return o.getRequestByEnvId(this.config.env).send("storage.batchDeleteFile",c).then((function(e){e.code?t(null,e):t(null,{fileList:e.data.delete_list,requestId:e.requestId})})).catch((function(e){t(e)})),t.promise},t.getTempFileURL=function(e,t){var n=e.fileList;t=t||s.createPromiseCallback(),n&&Array.isArray(n)||t(null,{code:"INVALID_PARAM",message:"fileList必须是非空的数组"});for(var r=[],i=0,a=n;i<a.length;i++){var c=a[i];"object"==typeof c?(c.hasOwnProperty("fileID")&&c.hasOwnProperty("maxAge")||t(null,{code:"INVALID_PARAM",message:"fileList的元素必须是包含fileID和maxAge的对象"}),r.push({fileid:c.fileID,max_age:c.maxAge})):"string"==typeof c?r.push({fileid:c}):t(null,{code:"INVALID_PARAM",message:"fileList的元素必须是字符串"})}var u={file_list:r};return o.getRequestByEnvId(this.config.env).send("storage.batchGetDownloadUrl",u).then((function(e){e.code?t(null,e):t(null,{fileList:e.data.download_list,requestId:e.requestId})})).catch((function(e){t(e)})),t.promise},t.downloadFile=function(e,n){var s=e.fileID;return r(this,void 0,void 0,(function(){var e,r,a,c,u;return i(this,(function(i){switch(i.label){case 0:return[4,t.getTempFileURL.call(this,{fileList:[{fileID:s,maxAge:600}]})];case 1:return e=i.sent(),"SUCCESS"!==(r=e.fileList[0]).code?[2,n?n(r):new Promise((function(e){e(r)}))]:(a=o.getRequestByEnvId(this.config.env),c=r.download_url,c=encodeURI(c),n?[4,a.download({url:c})]:[3,3]);case 2:return u=i.sent(),n(u),[3,4];case 3:return[2,a.download({url:c})];case 4:return[2]}}))}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9),i=n(2);t.callFunction=function(e,t){var n,o=e.name,s=e.data,a=e.query,c=e.parse,u=e.search,l=t||i.createPromiseCallback();try{n=s?JSON.stringify(s):""}catch(e){return Promise.reject(e)}if(!o)return Promise.reject(new Error("函数名不能为空"));var f={query:a,parse:c,search:u,function_name:o,request_data:n};return r.getRequestByEnvId(this.config.env).send("functions.invokeFunction",f).then((function(e){if(e.code)l(null,e);else{var t=e.data.response_data;if(c)l(null,{result:t,requestId:e.requestId});else try{t=JSON.parse(e.data.response_data),l(null,{result:t,requestId:e.requestId})}catch(e){l(new Error("response data must be json"))}}return l.promise})).catch((function(e){l(e)})),l.promise}},function(e,t,n){"use strict";n.r(t);var r,i={};n.r(i),n.d(i,"Point",(function(){return W})),n.d(i,"LineString",(function(){return L})),n.d(i,"Polygon",(function(){return M})),n.d(i,"MultiPoint",(function(){return k})),n.d(i,"MultiLineString",(function(){return j})),n.d(i,"MultiPolygon",(function(){return $})),function(e){e.DocIDError="文档ID不合法",e.CollNameError="集合名称不合法",e.OpStrError="操作符不合法",e.DirectionError="排序字符不合法",e.IntergerError="must be integer",e.QueryParamTypeError="查询参数必须为对象",e.QueryParamValueError="查询参数对象值不能均为undefined"}(r||(r={}));const o={String:"String",Number:"Number",Object:"Object",Array:"Array",Boolean:"Boolean",Null:"Null",GeoPoint:"GeoPoint",GeoLineString:"GeoLineString",GeoPolygon:"GeoPolygon",GeoMultiPoint:"GeoMultiPoint",GeoMultiLineString:"GeoMultiLineString",GeoMultiPolygon:"GeoMultiPolygon",Timestamp:"Date",Command:"Command",ServerDate:"ServerDate",BsonDate:"BsonDate"},s=["desc","asc"],a=["<","<=","==",">=",">"];var c;!function(e){e.lt="<",e.gt=">",e.lte="<=",e.gte=">=",e.eq="=="}(c||(c={}));c.eq,c.lt,c.lte,c.gt,c.gte;var u;!function(e){e.WHERE="WHERE",e.DOC="DOC"}(u||(u={}));const l=[],f={};class h{constructor(e){Object.defineProperties(this,{target:{enumerable:!1,writable:!1,configurable:!1,value:e}})}}class p extends h{constructor(e,t){if(t!==f)throw new TypeError("InternalSymbol cannot be constructed with new operator");super(e)}static for(e){for(let t=0,n=l.length;t<n;t++)if(l[t].target===e)return l[t].instance;const t=new p(e,f);return l.push({target:e,instance:t}),t}}var d=p;const _=d.for("UNSET_FIELD_NAME"),y=d.for("UPDATE_COMMAND"),g=d.for("QUERY_COMMAND"),m=d.for("LOGIC_COMMAND"),b=d.for("GEO_POINT"),v=d.for("SYMBOL_GEO_LINE_STRING"),w=d.for("SYMBOL_GEO_POLYGON"),E=d.for("SYMBOL_GEO_MULTI_POINT"),S=d.for("SYMBOL_GEO_MULTI_LINE_STRING"),A=d.for("SYMBOL_GEO_MULTI_POLYGON"),T=d.for("SERVER_DATE"),O=d.for("REGEXP"),N=e=>Object.prototype.toString.call(e).slice(8,-1).toLowerCase(),I=e=>"object"===N(e),B=e=>"string"===N(e),R=e=>"number"===N(e),D=e=>Array.isArray(e),C=e=>"date"===N(e),P=e=>"regexp"===N(e),x=e=>e&&e._internalType instanceof p;class L{constructor(e){if(!D(e))throw new TypeError(`"points" must be of type Point[]. Received type ${typeof e}`);if(e.length<2)throw new Error('"points" must contain 2 points at least');e.forEach(e=>{if(!(e instanceof W))throw new TypeError(`"points" must be of type Point[]. Received type ${typeof e}[]`)}),this.points=e}parse(e){return{[e]:{type:"LineString",coordinates:this.points.map(e=>e.toJSON().coordinates)}}}toJSON(){return{type:"LineString",coordinates:this.points.map(e=>e.toJSON().coordinates)}}static validate(e){if("LineString"!==e.type||!D(e.coordinates))return!1;for(let t of e.coordinates)if(!R(t[0])||!R(t[1]))return!1;return!0}static isClosed(e){const t=e.points[0],n=e.points[e.points.length-1];if(t.latitude===n.latitude&&t.longitude===n.longitude)return!0}get _internalType(){return v}}class M{constructor(e){if(!D(e))throw new TypeError(`"lines" must be of type LineString[]. Received type ${typeof e}`);if(0===e.length)throw new Error("Polygon must contain 1 linestring at least");e.forEach(e=>{if(!(e instanceof L))throw new TypeError(`"lines" must be of type LineString[]. Received type ${typeof e}[]`);if(!L.isClosed(e))throw new Error(`LineString ${e.points.map(e=>e.toReadableString())} is not a closed cycle`)}),this.lines=e}parse(e){return{[e]:{type:"Polygon",coordinates:this.lines.map(e=>e.points.map(e=>[e.longitude,e.latitude]))}}}toJSON(){return{type:"Polygon",coordinates:this.lines.map(e=>e.points.map(e=>[e.longitude,e.latitude]))}}static validate(e){if("Polygon"!==e.type||!D(e.coordinates))return!1;for(let t of e.coordinates){if(!this.isCloseLineString(t))return!1;for(let e of t)if(!R(e[0])||!R(e[1]))return!1}return!0}static isCloseLineString(e){const t=e[0],n=e[e.length-1];return t[0]===n[0]&&t[1]===n[1]}get _internalType(){return A}}class k{constructor(e){if(!D(e))throw new TypeError(`"points" must be of type Point[]. Received type ${typeof e}`);if(0===e.length)throw new Error('"points" must contain 1 point at least');e.forEach(e=>{if(!(e instanceof W))throw new TypeError(`"points" must be of type Point[]. Received type ${typeof e}[]`)}),this.points=e}parse(e){return{[e]:{type:"MultiPoint",coordinates:this.points.map(e=>e.toJSON().coordinates)}}}toJSON(){return{type:"MultiPoint",coordinates:this.points.map(e=>e.toJSON().coordinates)}}static validate(e){if("MultiPoint"!==e.type||!D(e.coordinates))return!1;for(let t of e.coordinates)if(!R(t[0])||!R(t[1]))return!1;return!0}get _internalType(){return E}}class j{constructor(e){if(!D(e))throw new TypeError(`"lines" must be of type LineString[]. Received type ${typeof e}`);if(0===e.length)throw new Error("Polygon must contain 1 linestring at least");e.forEach(e=>{if(!(e instanceof L))throw new TypeError(`"lines" must be of type LineString[]. Received type ${typeof e}[]`)}),this.lines=e}parse(e){return{[e]:{type:"MultiLineString",coordinates:this.lines.map(e=>e.points.map(e=>[e.longitude,e.latitude]))}}}toJSON(){return{type:"MultiLineString",coordinates:this.lines.map(e=>e.points.map(e=>[e.longitude,e.latitude]))}}static validate(e){if("MultiLineString"!==e.type||!D(e.coordinates))return!1;for(let t of e.coordinates)for(let e of t)if(!R(e[0])||!R(e[1]))return!1;return!0}get _internalType(){return S}}class ${constructor(e){if(!D(e))throw new TypeError(`"polygons" must be of type Polygon[]. Received type ${typeof e}`);if(0===e.length)throw new Error("MultiPolygon must contain 1 polygon at least");for(let t of e)if(!(t instanceof M))throw new TypeError(`"polygon" must be of type Polygon[]. Received type ${typeof t}[]`);this.polygons=e}parse(e){return{[e]:{type:"MultiPolygon",coordinates:this.polygons.map(e=>e.lines.map(e=>e.points.map(e=>[e.longitude,e.latitude])))}}}toJSON(){return{type:"MultiPolygon",coordinates:this.polygons.map(e=>e.lines.map(e=>e.points.map(e=>[e.longitude,e.latitude])))}}static validate(e){if("MultiPolygon"!==e.type||!D(e.coordinates))return!1;for(let t of e.coordinates)for(let e of t)for(let t of e)if(!R(t[0])||!R(t[1]))return!1;return!0}get _internalType(){return w}}class U{constructor({offset:e=0}={}){this.offset=e}get _internalType(){return T}parse(){return{$date:{offset:this.offset}}}}function q(e){return new U(e)}class F{}F.formatResDocumentData=e=>e.map(e=>F.formatField(e)),F.formatField=e=>{const t=Object.keys(e);let n={};return Array.isArray(e)&&(n=[]),t.forEach(t=>{const r=e[t];let i;switch(F.whichType(r)){case o.GeoPoint:i=new W(r.coordinates[0],r.coordinates[1]);break;case o.GeoLineString:i=new L(r.coordinates.map(e=>new W(e[0],e[1])));break;case o.GeoPolygon:i=new M(r.coordinates.map(e=>new L(e.map(([e,t])=>new W(e,t)))));break;case o.GeoMultiPoint:i=new k(r.coordinates.map(e=>new W(e[0],e[1])));break;case o.GeoMultiLineString:i=new j(r.coordinates.map(e=>new L(e.map(([e,t])=>new W(e,t)))));break;case o.GeoMultiPolygon:i=new $(r.coordinates.map(e=>new M(e.map(e=>new L(e.map(([e,t])=>new W(e,t)))))));break;case o.Timestamp:i=new Date(1e3*r.$timestamp);break;case o.Object:case o.Array:i=F.formatField(r);break;case o.ServerDate:i=new Date(r.$date);break;default:i=r}Array.isArray(n)?n.push(i):n[t]=i}),n},F.whichType=e=>{let t=Object.prototype.toString.call(e).slice(8,-1);if(t===o.Timestamp)return o.BsonDate;if(t===o.Object){if(e instanceof W)return o.GeoPoint;if(e instanceof Date)return o.Timestamp;if(e instanceof U)return o.ServerDate;e.$timestamp?t=o.Timestamp:e.$date?t=o.ServerDate:W.validate(e)?t=o.GeoPoint:L.validate(e)?t=o.GeoLineString:M.validate(e)?t=o.GeoPolygon:k.validate(e)?t=o.GeoMultiPoint:j.validate(e)?t=o.GeoMultiLineString:$.validate(e)&&(t=o.GeoMultiPolygon)}return t},F.generateDocId=()=>{let e="ABCDEFabcdef0123456789",t="";for(let n=0;n<24;n++)t+=e.charAt(Math.floor(Math.random()*e.length));return t};class z{static isGeopoint(e,t){if(F.whichType(t)!==o.Number)throw new Error("Geo Point must be number type");const n=Math.abs(t);if("latitude"===e&&n>90)throw new Error("latitude should be a number ranges from -90 to 90");if("longitude"===e&&n>180)throw new Error("longitude should be a number ranges from -180 to 180");return!0}static isInteger(e,t){if(!Number.isInteger(t))throw new Error(e+r.IntergerError);return!0}static isFieldOrder(e){if(-1===s.indexOf(e))throw new Error(r.DirectionError);return!0}static isFieldPath(e){if(!/^[a-zA-Z0-9-_\.]/.test(e))throw new Error;return!0}static isOperator(e){if(-1===a.indexOf(e))throw new Error(r.OpStrError);return!0}static isCollName(e){if(!/^[a-zA-Z0-9]([a-zA-Z0-9-_]){1,32}$/.test(e))throw new Error(r.CollNameError);return!0}static isDocID(e){if(!/^([a-fA-F0-9]){24}$/.test(e))throw new Error(r.DocIDError);return!0}}class W{constructor(e,t){z.isGeopoint("longitude",e),z.isGeopoint("latitude",t),this.longitude=e,this.latitude=t}parse(e){return{[e]:{type:"Point",coordinates:[this.longitude,this.latitude]}}}toJSON(){return{type:"Point",coordinates:[this.longitude,this.latitude]}}toReadableString(){return`[${this.longitude},${this.latitude}]`}static validate(e){return"Point"===e.type&&D(e.coordinates)&&z.isGeopoint("longitude",e.coordinates[0])&&z.isGeopoint("latitude",e.coordinates[1])}get _internalType(){return b}}const G=()=>{let e;if(!Promise){e=()=>{},e.promise={};const t=()=>{throw new Error('Your Node runtime does support ES6 Promises. Set "global.Promise" to your preferred implementation of promises.')};return Object.defineProperty(e.promise,"then",{get:t}),Object.defineProperty(e.promise,"catch",{get:t}),e}const t=new Promise((t,n)=>{e=(e,r)=>e?n(e):t(r)});return e.promise=t,e};var Y;!function(e){e.SET="set",e.REMOVE="remove",e.INC="inc",e.MUL="mul",e.PUSH="push",e.PULL="pull",e.PULL_ALL="pullAll",e.POP="pop",e.SHIFT="shift",e.UNSHIFT="unshift",e.ADD_TO_SET="addToSet",e.BIT="bit",e.RENAME="rename",e.MAX="max",e.MIN="min"}(Y||(Y={}));class K{constructor(e,t,n){this._internalType=y,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}}),this.operator=e,this.operands=t,this.fieldName=n||_}_setFieldName(e){return new K(this.operator,this.operands,e)}}function H(e){return e&&e instanceof K&&e._internalType===y}var J;!function(e){e.AND="and",e.OR="or",e.NOT="not",e.NOR="nor"}(J||(J={}));class V{constructor(e,t,n){if(this._internalType=m,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}}),this.operator=e,this.operands=t,this.fieldName=n||_,this.fieldName!==_)if(Array.isArray(t)){t=t.slice(),this.operands=t;for(let e=0,n=t.length;e<n;e++){const n=t[e];(X(n)||ee(n))&&(t[e]=n._setFieldName(this.fieldName))}}else{const e=t;(X(e)||ee(e))&&(t=e._setFieldName(this.fieldName))}}_setFieldName(e){const t=this.operands.map(t=>t instanceof V?t._setFieldName(e):t);return new V(this.operator,t,e)}and(...e){const t=Array.isArray(arguments[0])?arguments[0]:Array.from(arguments);return t.unshift(this),new V(J.AND,t,this.fieldName)}or(...e){const t=Array.isArray(arguments[0])?arguments[0]:Array.from(arguments);return t.unshift(this),new V(J.OR,t,this.fieldName)}}function X(e){return e&&e instanceof V&&e._internalType===m}var Q;!function(e){e.EQ="eq",e.NEQ="neq",e.GT="gt",e.GTE="gte",e.LT="lt",e.LTE="lte",e.IN="in",e.NIN="nin",e.ALL="all",e.ELEM_MATCH="elemMatch",e.EXISTS="exists",e.SIZE="size",e.MOD="mod",e.GEO_NEAR="geoNear",e.GEO_WITHIN="geoWithin",e.GEO_INTERSECTS="geoIntersects"}(Q||(Q={}));class Z extends V{constructor(e,t,n){super(e,t,n),this.operator=e,this._internalType=g}toJSON(){switch(this.operator){case Q.IN:case Q.NIN:return{["$"+this.operator]:this.operands};default:return{["$"+this.operator]:this.operands[0]}}}_setFieldName(e){return new Z(this.operator,this.operands,e)}eq(e){const t=new Z(Q.EQ,[e],this.fieldName);return this.and(t)}neq(e){const t=new Z(Q.NEQ,[e],this.fieldName);return this.and(t)}gt(e){const t=new Z(Q.GT,[e],this.fieldName);return this.and(t)}gte(e){const t=new Z(Q.GTE,[e],this.fieldName);return this.and(t)}lt(e){const t=new Z(Q.LT,[e],this.fieldName);return this.and(t)}lte(e){const t=new Z(Q.LTE,[e],this.fieldName);return this.and(t)}in(e){const t=new Z(Q.IN,e,this.fieldName);return this.and(t)}nin(e){const t=new Z(Q.NIN,e,this.fieldName);return this.and(t)}geoNear(e){if(!(e.geometry instanceof W))throw new TypeError(`"geometry" must be of type Point. Received type ${typeof e.geometry}`);if(void 0!==e.maxDistance&&!R(e.maxDistance))throw new TypeError(`"maxDistance" must be of type Number. Received type ${typeof e.maxDistance}`);if(void 0!==e.minDistance&&!R(e.minDistance))throw new TypeError(`"minDistance" must be of type Number. Received type ${typeof e.minDistance}`);const t=new Z(Q.GEO_NEAR,[e],this.fieldName);return this.and(t)}geoWithin(e){if(!(e.geometry instanceof $||e.geometry instanceof M))throw new TypeError(`"geometry" must be of type Polygon or MultiPolygon. Received type ${typeof e.geometry}`);const t=new Z(Q.GEO_WITHIN,[e],this.fieldName);return this.and(t)}geoIntersects(e){if(!(e.geometry instanceof W||e.geometry instanceof L||e.geometry instanceof M||e.geometry instanceof k||e.geometry instanceof j||e.geometry instanceof $))throw new TypeError(`"geometry" must be of type Point, LineString, Polygon, MultiPoint, MultiLineString or MultiPolygon. Received type ${typeof e.geometry}`);const t=new Z(Q.GEO_INTERSECTS,[e],this.fieldName);return this.and(t)}}function ee(e){return e&&e instanceof Z&&e._internalType===g}function te(e){return ee(e)}const ne={};for(const e in Q)ne[e]="$"+e;for(const e in J)ne[e]="$"+e;for(const e in Y)ne[e]="$"+e;function re(e){return ne[e]||"$"+e}function ie(e){return function e(t,n){if(!x(t)){if(C(t))return{$date:+t};if(P(t))return{$regex:t.source,$options:t.flags};if(D(t))return t.map(t=>{if(n.indexOf(t)>-1)throw new Error("Cannot convert circular structure to JSON");return e(t,[...n,t])});if(I(t)){const r=Object.assign({},t);for(const t in r){if(n.indexOf(r[t])>-1)throw new Error("Cannot convert circular structure to JSON");r[t]=e(r[t],[...n,r[t]])}return r}return t}switch(t._internalType){case b:return t.toJSON();case T:case O:return t.parse();default:return t.toJSON?t.toJSON():t}}(e,[e])}function oe(e,t,n,r){const i=Object.assign({},e);for(const o in e){if(/^\$/.test(o))continue;const s=e[o];if(s&&(I(s)&&!t(s))){if(r.indexOf(s)>-1)throw new Error("Cannot convert circular structure to JSON");const e=oe(s,t,[...n,o],[...r,s]);i[o]=e;let a=!1;for(const t in e)/^\$/.test(t)?a=!0:(i[`${o}.${t}`]=e[t],delete i[o][t]);a||delete i[o]}}return i}function se(e){return oe(e,ce,[],[e])}function ae(e,t,n){t[n]||delete e[n];for(const r in t)e[r]?D(e[r])?e[r].push(t[r]):I(e[r])?I(t[r])?Object.assign(e[r],t[r]):(console.warn(`unmergable condition, query is object but condition is ${N(t)}, can only overwrite`,t,n),e[r]=t[r]):(console.warn(`to-merge query is of type ${N(e)}, can only overwrite`,e,t,n),e[r]=t[r]):e[r]=t[r]}function ce(e){return x(e)||C(e)||P(e)}function ue(e){return ie(e)}ne[Q.NEQ]="$ne",ne[Y.REMOVE]="$unset",ne[Y.SHIFT]="$pop",ne[Y.UNSHIFT]="$push";class le{constructor(){}static encode(e){return(new le).encodeUpdate(e)}encodeUpdate(e){return H(e)?this.encodeUpdateCommand(e):"object"===N(e)?this.encodeUpdateObject(e):e}encodeUpdateCommand(e){if(e.fieldName===_)throw new Error("Cannot encode a comparison command with unset field name");switch(e.operator){case Y.PUSH:case Y.PULL:case Y.PULL_ALL:case Y.POP:case Y.SHIFT:case Y.UNSHIFT:case Y.ADD_TO_SET:return this.encodeArrayUpdateCommand(e);default:return this.encodeFieldUpdateCommand(e)}}encodeFieldUpdateCommand(e){const t=re(e.operator);switch(e.operator){case Y.REMOVE:return{[t]:{[e.fieldName]:""}};default:return{[t]:{[e.fieldName]:e.operands[0]}}}}encodeArrayUpdateCommand(e){const t=re(e.operator);switch(e.operator){case Y.PUSH:{let n;return n=D(e.operands)?{$each:e.operands.map(ue)}:e.operands,{[t]:{[e.fieldName]:n}}}case Y.UNSHIFT:{const n={$each:e.operands.map(ue),$position:0};return{[t]:{[e.fieldName]:n}}}case Y.POP:return{[t]:{[e.fieldName]:1}};case Y.SHIFT:return{[t]:{[e.fieldName]:-1}};default:return{[t]:{[e.fieldName]:ue(e.operands)}}}}encodeUpdateObject(e){const t=se(e);for(const e in t){if(/^\$/.test(e))continue;let n=t[e];if(H(n)){t[e]=n._setFieldName(e),ae(t,this.encodeUpdateCommand(t[e]),e)}else{t[e]=n=ue(n);const r=new K(Y.SET,[n],e);ae(t,this.encodeUpdateCommand(r),e)}}return t}}var fe=n(14),he=n.n(fe),pe=n(15),de=n.n(pe),_e=n(16),ye=n.n(_e);function ge(e=""){return`${e?`${e}_`:""}${+new Date}_${Math.random()}`}const me={UNKNOWN_ERROR:"UNKNOWN_ERROR",SDK_DATABASE_REALTIME_LISTENER_INIT_WATCH_FAIL:"SDK_DATABASE_REALTIME_LISTENER_INIT_WATCH_FAIL",SDK_DATABASE_REALTIME_LISTENER_RECONNECT_WATCH_FAIL:"SDK_DATABASE_REALTIME_LISTENER_RECONNECT_WATCH_FAIL",SDK_DATABASE_REALTIME_LISTENER_REBUILD_WATCH_FAIL:"SDK_DATABASE_REALTIME_LISTENER_REBUILD_WATCH_FAIL",SDK_DATABASE_REALTIME_LISTENER_CLOSE_WATCH_FAIL:"SDK_DATABASE_REALTIME_LISTENER_CLOSE_WATCH_FAIL",SDK_DATABASE_REALTIME_LISTENER_SERVER_ERROR_MSG:"SDK_DATABASE_REALTIME_LISTENER_SERVER_ERROR_MSG",SDK_DATABASE_REALTIME_LISTENER_RECEIVE_INVALID_SERVER_DATA:"SDK_DATABASE_REALTIME_LISTENER_RECEIVE_INVALID_SERVER_DATA",SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_ERROR:"SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_ERROR",SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_CLOSED:"SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_CLOSED",SDK_DATABASE_REALTIME_LISTENER_CHECK_LAST_FAIL:"SDK_DATABASE_REALTIME_LISTENER_CHECK_LAST_FAIL",SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR:"SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR"};class be extends Error{constructor(e){super(e.errMsg),this.errCode="UNKNOWN_ERROR",Object.defineProperties(this,{message:{get(){return`errCode: ${this.errCode} ${me[this.errCode]||""} | errMsg: `+this.errMsg},set(e){this.errMsg=e}}}),this.errCode=e.errCode||"UNKNOWN_ERROR",this.errMsg=e.errMsg}get message(){return`errCode: ${this.errCode} | errMsg: `+this.errMsg}set message(e){this.errMsg=e}}class ve extends Error{constructor(e){super(e),this.type="timeout",this.payload=null,this.generic=!0}}const we=e=>"timeout"===e.type;class Ee extends Error{constructor(e){super(e),this.type="cancelled",this.payload=null,this.generic=!0}}const Se=e=>"cancelled"===e.type,Ae=(e=0)=>new Promise(t=>setTimeout(t,e));class Te{constructor(e){this.close=e.close,this.onChange=e.onChange,this.onError=e.onError,e.debug&&Object.defineProperty(this,"virtualClient",{get:()=>e.virtualClient})}}class Oe{constructor(e){const{id:t,docChanges:n,docs:r,msgType:i,type:o}=e;let s,a;Object.defineProperties(this,{id:{get:()=>t,enumerable:!0},docChanges:{get:()=>(s||(s=JSON.parse(JSON.stringify(n))),s),enumerable:!0},docs:{get:()=>(a||(a=JSON.parse(JSON.stringify(r))),a),enumerable:!0},msgType:{get:()=>i,enumerable:!0},type:{get:()=>o,enumerable:!0}})}}class Ne extends Error{constructor(e){super(`Watch Error ${JSON.stringify(e.msgData)} (requestid: ${e.requestId})`),this.isRealtimeErrorMessageError=!0,this.payload=e}}const Ie=e=>e&&e.isRealtimeErrorMessageError;var Be;!function(e){e.LOGGINGIN="LOGGINGIN",e.INITING="INITING",e.REBUILDING="REBUILDING",e.ACTIVE="ACTIVE",e.ERRORED="ERRORED",e.CLOSING="CLOSING",e.CLOSED="CLOSED",e.PAUSED="PAUSED",e.RESUMING="RESUMING"}(Be||(Be={}));const Re=100,De=2,Ce=2,Pe=1e4,xe=1e4,Le=1e4;class Me{constructor(e){this.watchStatus=Be.INITING,this._login=async(e,t)=>{this.watchStatus=Be.LOGGINGIN;const n=await this.login(e,t);return this.envId||(this.envId=n.envId),n},this.initWatch=async e=>{if(this._initWatchPromise)return this._initWatchPromise;this._initWatchPromise=new Promise(async(t,n)=>{try{if(this.watchStatus===Be.PAUSED)return console.log("[realtime] initWatch cancelled on pause"),t();const{envId:n}=await this._login(this.envId,e);if(this.watchStatus===Be.PAUSED)return console.log("[realtime] initWatch cancelled on pause"),t();this.watchStatus=Be.INITING;const r={watchId:this.watchId,requestId:ge(),msgType:"INIT_WATCH",msgData:{envId:n,collName:this.collectionName,query:this.query}},i=await this.send({msg:r,waitResponse:!0,skipOnMessage:!0,timeout:xe}),{events:o,currEvent:s}=i.msgData;if(this.sessionInfo={queryID:i.msgData.queryID,currentEventId:s-1,currentDocs:[]},o.length>0){for(const e of o)e.ID=s;this.handleServerEvents(i)}else{this.sessionInfo.currentEventId=s;const e=new Oe({id:s,docChanges:[],docs:[],type:"init"});this.listener.onChange(e),this.scheduleSendACK()}this.onWatchStart(this,this.sessionInfo.queryID),this.watchStatus=Be.ACTIVE,this._availableRetries.INIT_WATCH=De,t()}catch(e){this.handleWatchEstablishmentError(e,{operationName:"INIT_WATCH",resolve:t,reject:n})}});let t=!1;try{await this._initWatchPromise,t=!0}finally{this._initWatchPromise=void 0}console.log(`[realtime] initWatch ${t?"success":"fail"}`)},this.rebuildWatch=async e=>{if(this._rebuildWatchPromise)return this._rebuildWatchPromise;this._rebuildWatchPromise=new Promise(async(t,n)=>{try{if(this.watchStatus===Be.PAUSED)return console.log("[realtime] rebuildWatch cancelled on pause"),t();const{envId:n}=await this._login(this.envId,e);if(!this.sessionInfo)throw new Error("can not rebuildWatch without a successful initWatch (lack of sessionInfo)");if(this.watchStatus===Be.PAUSED)return console.log("[realtime] rebuildWatch cancelled on pause"),t();this.watchStatus=Be.REBUILDING;const r={watchId:this.watchId,requestId:ge(),msgType:"REBUILD_WATCH",msgData:{envId:n,collName:this.collectionName,queryID:this.sessionInfo.queryID,eventID:this.sessionInfo.currentEventId}},i=await this.send({msg:r,waitResponse:!0,skipOnMessage:!1,timeout:Le});this.handleServerEvents(i),this.watchStatus=Be.ACTIVE,this._availableRetries.REBUILD_WATCH=De,t()}catch(e){this.handleWatchEstablishmentError(e,{operationName:"REBUILD_WATCH",resolve:t,reject:n})}});let t=!1;try{await this._rebuildWatchPromise,t=!0}finally{this._rebuildWatchPromise=void 0}console.log(`[realtime] rebuildWatch ${t?"success":"fail"}`)},this.handleWatchEstablishmentError=async(e,t)=>{const n="INIT_WATCH"===t.operationName,r=()=>{this.closeWithError(new be({errCode:n?me.SDK_DATABASE_REALTIME_LISTENER_INIT_WATCH_FAIL:me.SDK_DATABASE_REALTIME_LISTENER_REBUILD_WATCH_FAIL,errMsg:e})),t.reject(e)},i=e=>{this.useRetryTicket(t.operationName)?n?(this._initWatchPromise=void 0,t.resolve(this.initWatch(e))):(this._rebuildWatchPromise=void 0,t.resolve(this.rebuildWatch(e))):r()};this.handleCommonError(e,{onSignError:()=>i(!0),onTimeoutError:()=>i(!1),onNotRetryableError:r,onCancelledError:t.reject,onUnknownError:async()=>{try{const e=async()=>{this.pause(),await this.onceWSConnected(),i(!0)};this.isWSConnected()?(await Ae(Re),this.watchStatus===Be.PAUSED?t.reject(new Ee(`${t.operationName} cancelled due to pause after unknownError`)):this.isWSConnected()?i(!1):await e()):await e()}catch(e){i(!0)}}})},this.closeWatch=async()=>{const e=this.sessionInfo?this.sessionInfo.queryID:"";if(this.watchStatus!==Be.ACTIVE)return this.watchStatus=Be.CLOSED,void this.onWatchClose(this,e);try{this.watchStatus=Be.CLOSING;const t={watchId:this.watchId,requestId:ge(),msgType:"CLOSE_WATCH",msgData:null};await this.send({msg:t}),this.sessionInfo=void 0,this.watchStatus=Be.CLOSED}catch(e){this.closeWithError(new be({errCode:me.SDK_DATABASE_REALTIME_LISTENER_CLOSE_WATCH_FAIL,errMsg:e}))}finally{this.onWatchClose(this,e)}},this.scheduleSendACK=()=>{this.clearACKSchedule(),this._ackTimeoutId=setTimeout(()=>{this._waitExpectedTimeoutId?this.scheduleSendACK():this.sendACK()},Pe)},this.clearACKSchedule=()=>{this._ackTimeoutId&&clearTimeout(this._ackTimeoutId)},this.sendACK=async()=>{try{if(this.watchStatus!==Be.ACTIVE)return void this.scheduleSendACK();if(!this.sessionInfo)return void console.warn("[realtime listener] can not send ack without a successful initWatch (lack of sessionInfo)");const e={watchId:this.watchId,requestId:ge(),msgType:"CHECK_LAST",msgData:{queryID:this.sessionInfo.queryID,eventID:this.sessionInfo.currentEventId}};await this.send({msg:e}),this.scheduleSendACK()}catch(e){if(Ie(e)){const t=e.payload;switch(t.msgData.code){case"CHECK_LOGIN_FAILED":case"SIGN_EXPIRED_ERROR":case"SIGN_INVALID_ERROR":case"SIGN_PARAM_INVALID":return void this.rebuildWatch();case"QUERYID_INVALID_ERROR":case"SYS_ERR":case"INVALIID_ENV":case"COLLECTION_PERMISSION_DENIED":return void this.closeWithError(new be({errCode:me.SDK_DATABASE_REALTIME_LISTENER_CHECK_LAST_FAIL,errMsg:t.msgData.code}))}}this._availableRetries.CHECK_LAST&&this._availableRetries.CHECK_LAST>0?(this._availableRetries.CHECK_LAST--,this.scheduleSendACK()):this.closeWithError(new be({errCode:me.SDK_DATABASE_REALTIME_LISTENER_CHECK_LAST_FAIL,errMsg:e}))}},this.handleCommonError=(e,t)=>{if(Ie(e)){switch(e.payload.msgData.code){case"CHECK_LOGIN_FAILED":case"SIGN_EXPIRED_ERROR":case"SIGN_INVALID_ERROR":case"SIGN_PARAM_INVALID":return void t.onSignError(e);case"QUERYID_INVALID_ERROR":case"SYS_ERR":case"INVALIID_ENV":case"COLLECTION_PERMISSION_DENIED":default:return void t.onNotRetryableError(e)}}else{if(we(e))return void t.onTimeoutError(e);if(Se(e))return void t.onCancelledError(e)}t.onUnknownError(e)},this.watchId=`watchid_${+new Date}_${Math.random()}`,this.envId=e.envId,this.collectionName=e.collectionName,this.query=e.query,this.send=e.send,this.login=e.login,this.isWSConnected=e.isWSConnected,this.onceWSConnected=e.onceWSConnected,this.getWaitExpectedTimeoutLength=e.getWaitExpectedTimeoutLength,this.onWatchStart=e.onWatchStart,this.onWatchClose=e.onWatchClose,this.debug=e.debug,this._availableRetries={INIT_WATCH:De,REBUILD_WATCH:De,CHECK_LAST:Ce},this.listener=new Te({close:this.closeWatch,onChange:e.onChange,onError:e.onError,debug:this.debug,virtualClient:this}),this.initWatch()}useRetryTicket(e){return!!(this._availableRetries[e]&&this._availableRetries[e]>0)&&(this._availableRetries[e]--,console.log(`[realtime] ${e} use a retry ticket, now only ${this._availableRetries[e]} retry left`),!0)}async handleServerEvents(e){try{this.scheduleSendACK(),await this._handleServerEvents(e),this._postHandleServerEventsValidityCheck(e)}catch(e){throw console.error("[realtime listener] internal non-fatal error: handle server events failed with error: ",e),e}}async _handleServerEvents(e){const{requestId:t}=e,{events:n}=e.msgData,{msgType:r}=e;if(!n.length||!this.sessionInfo)return;const i=this.sessionInfo;let o;try{o=n.map(ke)}catch(e){return void this.closeWithError(new be({errCode:me.SDK_DATABASE_REALTIME_LISTENER_RECEIVE_INVALID_SERVER_DATA,errMsg:e}))}let s=[...i.currentDocs],a=!1;for(let n=0,c=o.length;n<c;n++){const u=o[n];if(i.currentEventId>=u.id)!o[n-1]||u.id>o[n-1].id?console.warn(`[realtime] duplicate event received, cur ${i.currentEventId} but got ${u.id}`):console.error(`[realtime listener] server non-fatal error: events out of order (the latter event's id is smaller than that of the former) (requestId ${t})`);else{if(i.currentEventId!==u.id-1)return console.warn(`[realtime listener] event received is out of order, cur ${this.sessionInfo.currentEventId} but got ${u.id}`),void await this.rebuildWatch();switch(u.dataType){case"update":if(!u.doc)switch(u.queueType){case"update":case"dequeue":{const e=s.find(e=>e._id===u.docId);if(e){const t=ye()(e);if(u.updatedFields)for(const e in u.updatedFields)he()(t,e,u.updatedFields[e]);if(u.removedFields)for(const e of u.removedFields)de()(t,e);u.doc=t}else console.error("[realtime listener] internal non-fatal server error: unexpected update dataType event where no doc is associated.");break}case"enqueue":{const t=new be({errCode:me.SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR,errMsg:`HandleServerEvents: full doc is not provided with dataType="update" and queueType="enqueue" (requestId ${e.requestId})`});throw this.closeWithError(t),t}}break;case"replace":if(!u.doc){const t=new be({errCode:me.SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR,errMsg:`HandleServerEvents: full doc is not provided with dataType="replace" (requestId ${e.requestId})`});throw this.closeWithError(t),t}break;case"remove":{const e=s.find(e=>e._id===u.docId);e?u.doc=e:console.error("[realtime listener] internal non-fatal server error: unexpected remove event where no doc is associated.");break}}switch(u.queueType){case"init":a?s.push(u.doc):(a=!0,s=[u.doc]);break;case"enqueue":s.push(u.doc);break;case"dequeue":{const e=s.findIndex(e=>e._id===u.docId);e>-1?s.splice(e,1):console.error("[realtime listener] internal non-fatal server error: unexpected dequeue event where no doc is associated.");break}case"update":{const e=s.findIndex(e=>e._id===u.docId);e>-1?s[e]=u.doc:console.error("[realtime listener] internal non-fatal server error: unexpected queueType update event where no doc is associated.");break}}if(n===c-1||o[n+1]&&o[n+1].id!==u.id){const e=[...s],t=o.slice(0,n+1).filter(e=>e.id===u.id);this.sessionInfo.currentEventId=u.id,this.sessionInfo.currentDocs=s;const i=new Oe({id:u.id,docChanges:t,docs:e,msgType:r});this.listener.onChange(i)}}}}_postHandleServerEventsValidityCheck(e){this.sessionInfo?(this.sessionInfo.expectEventId&&this.sessionInfo.currentEventId>=this.sessionInfo.expectEventId&&this.clearWaitExpectedEvent(),this.sessionInfo.currentEventId<e.msgData.currEvent&&console.warn("[realtime listener] internal non-fatal error: client eventId does not match with server event id after server event handling")):console.error("[realtime listener] internal non-fatal error: sessionInfo lost after server event handling, this should never occur")}clearWaitExpectedEvent(){this._waitExpectedTimeoutId&&(clearTimeout(this._waitExpectedTimeoutId),this._waitExpectedTimeoutId=void 0)}onMessage(e){switch(this.watchStatus){case Be.PAUSED:if("ERROR"!==e.msgType)return;break;case Be.LOGGINGIN:case Be.INITING:case Be.REBUILDING:return void console.warn(`[realtime listener] internal non-fatal error: unexpected message received while ${this.watchStatus}`);case Be.CLOSED:return void console.warn("[realtime listener] internal non-fatal error: unexpected message received when the watch has closed");case Be.ERRORED:return void console.warn("[realtime listener] internal non-fatal error: unexpected message received when the watch has ended with error")}if(this.sessionInfo)switch(this.scheduleSendACK(),e.msgType){case"NEXT_EVENT":console.warn(`nextevent ${e.msgData.currEvent} ignored`,e),this.handleServerEvents(e);break;case"CHECK_EVENT":this.sessionInfo.currentEventId<e.msgData.currEvent&&(this.sessionInfo.expectEventId=e.msgData.currEvent,this.clearWaitExpectedEvent(),this._waitExpectedTimeoutId=setTimeout(()=>{this.rebuildWatch()},this.getWaitExpectedTimeoutLength()),console.log(`[realtime] waitExpectedTimeoutLength ${this.getWaitExpectedTimeoutLength()}`));break;case"ERROR":this.closeWithError(new be({errCode:me.SDK_DATABASE_REALTIME_LISTENER_SERVER_ERROR_MSG,errMsg:`${e.msgData.code} - ${e.msgData.message}`}));break;default:console.warn(`[realtime listener] virtual client receive unexpected msg ${e.msgType}: `,e)}else console.warn("[realtime listener] internal non-fatal error: sessionInfo not found while message is received.")}closeWithError(e){this.watchStatus=Be.ERRORED,this.clearACKSchedule(),this.listener.onError(e),this.onWatchClose(this,this.sessionInfo&&this.sessionInfo.queryID||""),console.log(`[realtime] client closed (${this.collectionName} ${this.query}) (watchId ${this.watchId})`)}pause(){this.watchStatus=Be.PAUSED,console.log(`[realtime] client paused (${this.collectionName} ${this.query}) (watchId ${this.watchId})`)}async resume(){this.watchStatus=Be.RESUMING,console.log(`[realtime] client resuming with ${this.sessionInfo?"REBUILD_WATCH":"INIT_WATCH"} (${this.collectionName} ${this.query}) (${this.watchId})`);try{await(this.sessionInfo?this.rebuildWatch():this.initWatch()),console.log(`[realtime] client successfully resumed (${this.collectionName} ${this.query}) (${this.watchId})`)}catch(e){console.error(`[realtime] client resume failed (${this.collectionName} ${this.query}) (${this.watchId})`,e)}}}function ke(e){const t={id:e.ID,dataType:e.DataType,queueType:e.QueueType,docId:e.DocID,doc:e.Doc&&"{}"!==e.Doc?JSON.parse(e.Doc):void 0};return"update"===e.DataType&&(e.UpdatedFields&&(t.updatedFields=JSON.parse(e.UpdatedFields)),(e.removedFields||e.RemovedFields)&&(t.removedFields=JSON.parse(e.removedFields))),t}const je={1e3:{code:1e3,name:"Normal Closure",description:"Normal closure; the connection successfully completed whatever purpose for which it was created."},1001:{code:1001,name:"Going Away",description:"The endpoint is going away, either because of a server failure or because the browser is navigating away from the page that opened the connection."},1002:{code:1002,name:"Protocol Error",description:"The endpoint is terminating the connection due to a protocol error."},1003:{code:1003,name:"Unsupported Data",description:"The connection is being terminated because the endpoint received data of a type it cannot accept (for example, a text-only endpoint received binary data)."},1005:{code:1005,name:"No Status Received",description:"Indicates that no status code was provided even though one was expected."},1006:{code:1006,name:"Abnormal Closure",description:"Used to indicate that a connection was closed abnormally (that is, with no close frame being sent) when a status code is expected."},1007:{code:1007,name:"Invalid frame payload data",description:"The endpoint is terminating the connection because a message was received that contained inconsistent data (e.g., non-UTF-8 data within a text message)."},1008:{code:1008,name:"Policy Violation",description:"The endpoint is terminating the connection because it received a message that violates its policy. This is a generic status code, used when codes 1003 and 1009 are not suitable."},1009:{code:1009,name:"Message too big",description:"The endpoint is terminating the connection because a data frame was received that is too large."},1010:{code:1010,name:"Missing Extension",description:"The client is terminating the connection because it expected the server to negotiate one or more extension, but the server didn't."},1011:{code:1011,name:"Internal Error",description:"The server is terminating the connection because it encountered an unexpected condition that prevented it from fulfilling the request."},1012:{code:1012,name:"Service Restart",description:"The server is terminating the connection because it is restarting."},1013:{code:1013,name:"Try Again Later",description:"The server is terminating the connection due to a temporary condition, e.g. it is overloaded and is casting off some of its clients."},1014:{code:1014,name:"Bad Gateway",description:"The server was acting as a gateway or proxy and received an invalid response from the upstream server. This is similar to 502 HTTP Status Code."},1015:{code:1015,name:"TLS Handshake",description:"Indicates that the connection was closed due to a failure to perform a TLS handshake (e.g., the server certificate can't be verified)."},3e3:{code:3e3,name:"Reconnect WebSocket",description:"The client is terminating the connection because it wants to reconnect"},3001:{code:3001,name:"No Realtime Listeners",description:"The client is terminating the connection because no more realtime listeners exist"},3002:{code:3002,name:"Heartbeat Ping Error",description:"The client is terminating the connection due to its failure in sending heartbeat messages"},3003:{code:3003,name:"Heartbeat Pong Timeout Error",description:"The client is terminating the connection because no heartbeat response is received from the server"},3050:{code:3050,name:"Server Close",description:"The client is terminating the connection because no heartbeat response is received from the server"}};var $e;!function(e){e[e.NormalClosure=1e3]="NormalClosure",e[e.GoingAway=1001]="GoingAway",e[e.ProtocolError=1002]="ProtocolError",e[e.UnsupportedData=1003]="UnsupportedData",e[e.NoStatusReceived=1005]="NoStatusReceived",e[e.AbnormalClosure=1006]="AbnormalClosure",e[e.InvalidFramePayloadData=1007]="InvalidFramePayloadData",e[e.PolicyViolation=1008]="PolicyViolation",e[e.MessageTooBig=1009]="MessageTooBig",e[e.MissingExtension=1010]="MissingExtension",e[e.InternalError=1011]="InternalError",e[e.ServiceRestart=1012]="ServiceRestart",e[e.TryAgainLater=1013]="TryAgainLater",e[e.BadGateway=1014]="BadGateway",e[e.TLSHandshake=1015]="TLSHandshake",e[e.ReconnectWebSocket=3e3]="ReconnectWebSocket",e[e.NoRealtimeListeners=3001]="NoRealtimeListeners",e[e.HeartbeatPingError=3002]="HeartbeatPingError",e[e.HeartbeatPongTimeoutError=3003]="HeartbeatPongTimeoutError",e[e.NoAuthentication=3050]="NoAuthentication"}($e||($e={}));const Ue=(e,t)=>{const n=je[e],r=n?`${n.name}, code ${e}, reason ${t||n.description}`:`code ${e}`;return new be({errCode:me.SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_CLOSED,errMsg:r})},qe={CONNECTING:0,OPEN:1,CLOSING:2,CLOSED:3},Fe=3,ze=5e3,We=1e4,Ge=5,Ye=1e4,Ke=2,He=2,Je=5e3;class Ve{constructor(e){this._virtualWSClient=new Set,this._queryIdClientMap=new Map,this._watchIdClientMap=new Map,this._pingFailed=0,this._pongMissed=0,this._logins=new Map,this._wsReadySubsribers=[],this._wsResponseWait=new Map,this._rttObserved=[],this.initWebSocketConnection=async(e,t=this._maxReconnect)=>{if(!e||!this._reconnectState){if(e&&(this._reconnectState=!0),this._wsInitPromise)return this._wsInitPromise;e&&this.pauseClients(),this.close($e.ReconnectWebSocket),this._wsInitPromise=new Promise(async(n,r)=>{try{await this.getAccessToken(),await new Promise(e=>{const t="wss://tcb-ws.tencentcloudapi.com";this._ws=St.wsClass?new St.wsClass(t):new WebSocket(t),e()}),await this.initWebSocketEvent(),n(),e&&(this.resumeClients(),this._reconnectState=!1)}catch(i){if(console.error("[realtime] initWebSocketConnection connect fail",i),t>0){const r=!0;this._wsInitPromise=void 0,r&&(await Ae(this._reconnectInterval),e&&(this._reconnectState=!1)),n(this.initWebSocketConnection(e,t-1))}else r(i),e&&this.closeAllClients(new be({errCode:me.SDK_DATABASE_REALTIME_LISTENER_RECONNECT_WATCH_FAIL,errMsg:i}))}});try{await this._wsInitPromise,this._wsReadySubsribers.forEach(({resolve:e})=>e())}catch(e){this._wsReadySubsribers.forEach(({reject:e})=>e())}finally{this._wsInitPromise=void 0,this._wsReadySubsribers=[]}}},this.initWebSocketEvent=()=>new Promise((e,t)=>{if(!this._ws)throw new Error("can not initWebSocketEvent, ws not exists");let n=!1;this._ws.onopen=t=>{console.warn("[realtime] ws event: open",t),n=!0,e()},this._ws.onerror=e=>{this._logins=new Map,n?(console.error("[realtime] ws event: error",e),this.clearHeartbeat(),this._virtualWSClient.forEach(t=>t.closeWithError(new be({errCode:me.SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_ERROR,errMsg:e})))):(console.error("[realtime] ws open failed with ws event: error",e),t(e))},this._ws.onclose=e=>{switch(console.warn("[realtime] ws event: close",e),this._logins=new Map,this.clearHeartbeat(),e.code){case $e.ReconnectWebSocket:case $e.NoRealtimeListeners:break;case $e.HeartbeatPingError:case $e.HeartbeatPongTimeoutError:case $e.NormalClosure:case $e.AbnormalClosure:this._maxReconnect>0?this.initWebSocketConnection(!0,this._maxReconnect):this.closeAllClients(Ue(e.code));break;case $e.NoAuthentication:this.closeAllClients(Ue(e.code,e.reason));break;default:this._maxReconnect>0?this.initWebSocketConnection(!0,this._maxReconnect):this.closeAllClients(Ue(e.code))}},this._ws.onmessage=e=>{const t=e.data;let n;this.heartbeat();try{n=JSON.parse(t)}catch(e){throw new Error(`[realtime] onMessage parse res.data error: ${e}`)}if("ERROR"===n.msgType){let e=null;this._virtualWSClient.forEach(t=>{t.watchId===n.watchId&&(e=t)}),e&&e.listener.onError(n)}const r=this._wsResponseWait.get(n.requestId);if(r){try{"ERROR"===n.msgType?r.reject(new Ne(n)):r.resolve(n)}catch(e){console.error("ws onMessage responseWaitSpec.resolve(msg) errored:",e)}finally{this._wsResponseWait.delete(n.requestId)}if(r.skipOnMessage)return}if("PONG"===n.msgType){if(this._lastPingSendTS){const e=Date.now()-this._lastPingSendTS;if(e>We)return void console.warn(`[realtime] untrusted rtt observed: ${e}`);this._rttObserved.length>=Fe&&this._rttObserved.splice(0,this._rttObserved.length-Fe+1),this._rttObserved.push(e)}return}let i=n.watchId&&this._watchIdClientMap.get(n.watchId);if(i)i.onMessage(n);else switch(console.error(`[realtime] no realtime listener found responsible for watchId ${n.watchId}: `,n),n.msgType){case"INIT_EVENT":case"NEXT_EVENT":case"CHECK_EVENT":i=this._queryIdClientMap.get(n.msgData.queryID),i&&i.onMessage(n);break;default:for(const[,e]of this._watchIdClientMap){e.onMessage(n);break}}},this.heartbeat()}),this.isWSConnected=()=>Boolean(this._ws&&this._ws.readyState===qe.OPEN),this.onceWSConnected=async()=>{if(!this.isWSConnected())return this._wsInitPromise?this._wsInitPromise:new Promise((e,t)=>{this._wsReadySubsribers.push({resolve:e,reject:t})})},this.webLogin=async(e,t)=>{if(!t)if(e){const t=this._logins.get(e);if(t){if(t.loggedIn&&t.loginResult)return t.loginResult;if(t.loggingInPromise)return t.loggingInPromise}}else{const e=this._logins.get("");if(e&&e.loggingInPromise)return e.loggingInPromise}const n=new Promise(async(e,t)=>{try{const n=await this.getAccessToken(),r={envId:n.env||"",accessToken:n.accessToken,referrer:"web",sdkVersion:"",dataVersion:St.dataVersion||""},i={watchId:void 0,requestId:ge(),msgType:"LOGIN",msgData:r};if("web"!==St.runtime){const e=Date.now(),{appAccessKey:t,appAccessKeyId:n,appSign:o}=St.appSecretInfo,s={data:r,timestamp:e,appAccessKeyId:n,appSign:o},a=St.createSign(s,t);i.exMsgData={timestamp:e,appAccessKey:t,appSign:o,sign:a}}const o=await this.send({msg:i,waitResponse:!0,skipOnMessage:!0,timeout:Je});o.msgData.code?t(new Error(`${o.msgData.code} ${o.msgData.message}`)):e({envId:n.env})}catch(e){t(e)}});let r=e&&this._logins.get(e);const i=Date.now();r?(r.loggedIn=!1,r.loggingInPromise=n,r.loginStartTS=i):(r={loggedIn:!1,loggingInPromise:n,loginStartTS:i},this._logins.set(e||"",r));try{const t=await n,o=e&&this._logins.get(e);if(o&&o===r&&o.loginStartTS===i)return r.loggedIn=!0,r.loggingInPromise=void 0,r.loginStartTS=void 0,r.loginResult=t,t;if(o){if(o.loggedIn&&o.loginResult)return o.loginResult;if(o.loggingInPromise)return o.loggingInPromise;throw new Error("ws unexpected login info")}throw new Error("ws login info reset")}catch(e){throw r.loggedIn=!1,r.loggingInPromise=void 0,r.loginStartTS=void 0,r.loginResult=void 0,e}},this.getAccessToken=async()=>this._context.appConfig.getAccessToken(),this.getWaitExpectedTimeoutLength=()=>this._rttObserved.length?this._rttObserved.reduce((e,t)=>e+t)/this._rttObserved.length*1.5:ze,this.ping=async()=>{const e={watchId:void 0,requestId:ge(),msgType:"PING",msgData:null};await this.send({msg:e})},this.send=e=>new Promise(async(t,n)=>{let r,i=!1,o=!1;const s=e=>{i=!0,r&&clearTimeout(r),t(e)},a=e=>{o=!0,r&&clearTimeout(r),n(e)};e.timeout&&(r=setTimeout(async()=>{i&&o||(await Ae(0),i&&o||a(new ve("wsclient.send timedout")))},e.timeout));try{if(this._wsInitPromise&&await this._wsInitPromise,!this._ws)return void a(new Error("invalid state: ws connection not exists, can not send message"));if(this._ws.readyState!==qe.OPEN)return void a(new Error(`ws readyState invalid: ${this._ws.readyState}, can not send message`));e.waitResponse&&this._wsResponseWait.set(e.msg.requestId,{resolve:s,reject:a,skipOnMessage:e.skipOnMessage});try{this._ws.send(JSON.stringify(e.msg)),e.waitResponse||s()}catch(t){t&&(a(t),e.waitResponse&&this._wsResponseWait.delete(e.msg.requestId))}}catch(e){a(e)}}),this.closeAllClients=e=>{this._virtualWSClient.forEach(t=>{t.closeWithError(e)})},this.pauseClients=e=>{(e||this._virtualWSClient).forEach(e=>{e.pause()})},this.resumeClients=e=>{(e||this._virtualWSClient).forEach(e=>{e.resume()})},this.onWatchStart=(e,t)=>{this._queryIdClientMap.set(t,e)},this.onWatchClose=(e,t)=>{t&&this._queryIdClientMap.delete(t),this._watchIdClientMap.delete(e.watchId),this._virtualWSClient.delete(e),this._virtualWSClient.size||this.close($e.NoRealtimeListeners)},this._maxReconnect=e.maxReconnect||Ge,this._reconnectInterval=e.reconnectInterval||Ye,this._context=e.context}heartbeat(e){this.clearHeartbeat(),this._pingTimeoutId=setTimeout(async()=>{try{if(!this._ws||this._ws.readyState!==qe.OPEN)return;this._lastPingSendTS=Date.now(),await this.ping(),this._pingFailed=0,this._pongTimeoutId=setTimeout(()=>{console.error("pong timed out"),this._pongMissed<He?(this._pongMissed++,this.heartbeat(!0)):this.initWebSocketConnection(!0)},this._context.appConfig.realtimePongWaitTimeout)}catch(e){this._pingFailed<Ke?(this._pingFailed++,this.heartbeat()):this.close($e.HeartbeatPingError)}},e?0:this._context.appConfig.realtimePingInterval)}clearHeartbeat(){this._pingTimeoutId&&clearTimeout(this._pingTimeoutId),this._pongTimeoutId&&clearTimeout(this._pongTimeoutId)}close(e){this.clearHeartbeat(),this._ws&&(this._ws.close(e,je[e].name),this._ws=void 0)}watch(e){this._ws||this._wsInitPromise||this.initWebSocketConnection(!1);const t=new Me(Object.assign(Object.assign({},e),{send:this.send,login:this.webLogin,isWSConnected:this.isWSConnected,onceWSConnected:this.onceWSConnected,getWaitExpectedTimeoutLength:this.getWaitExpectedTimeoutLength,onWatchStart:this.onWatchStart,onWatchClose:this.onWatchClose,debug:!0}));return this._virtualWSClient.add(t),this._watchIdClientMap.set(t.watchId,t),t.listener}}class Xe{constructor(e,t,n,r={}){this.watch=e=>(St.ws||(St.ws=new Ve({context:{appConfig:{docSizeLimit:1e3,realtimePingInterval:1e4,realtimePongWaitTimeout:5e3,getAccessToken:this._getAccessToken}}})),St.ws.watch(Object.assign(Object.assign({},e),{envId:this._db.config.env,collectionName:this._coll,query:JSON.stringify({_id:this.id})}))),this._db=e,this._coll=t,this.id=n,this.request=new St.reqClass(this._db.config),this.projection=r,this._getAccessToken=St.getAccessToken}create(e,t){t=t||G();let n={collectionName:this._coll,data:ie(e)};return this.id&&(n._id=this.id),this.request.send("database.addDocument",n).then(e=>{e.code?t(0,e):t(0,{id:e.data._id,requestId:e.requestId})}).catch(e=>{t(e)}),t.promise}set(e,t){if(t=t||G(),!this.id)return Promise.resolve({code:"INVALID_PARAM",message:"docId不能为空"});if(!e||"object"!=typeof e)return Promise.resolve({code:"INVALID_PARAM",message:"参数必需是非空对象"});if(e.hasOwnProperty("_id"))return Promise.resolve({code:"INVALID_PARAM",message:"不能更新_id的值"});let n=!1;const r=e=>{if("object"==typeof e)for(let t in e)e[t]instanceof K?n=!0:"object"==typeof e[t]&&r(e[t])};if(r(e),n)return Promise.resolve({code:"DATABASE_REQUEST_FAILED",message:"update operator complicit"});let i={collectionName:this._coll,queryType:u.DOC,data:ie(e),multi:!1,merge:!1,upsert:!0};return this.id&&(i.query={_id:this.id}),this.request.send("database.updateDocument",i).then(e=>{e.code?t(0,e):t(0,{updated:e.data.updated,upsertedId:e.data.upserted_id,requestId:e.requestId})}).catch(e=>{t(e)}),t.promise}update(e,t){if(t=t||G(),!e||"object"!=typeof e)return Promise.resolve({code:"INVALID_PARAM",message:"参数必需是非空对象"});if(e.hasOwnProperty("_id"))return Promise.resolve({code:"INVALID_PARAM",message:"不能更新_id的值"});const n={_id:this.id},r={collectionName:this._coll,data:le.encode(e),query:n,queryType:u.DOC,multi:!1,merge:!0,upsert:!1};return this.request.send("database.updateDocument",r).then(e=>{e.code?t(0,e):t(0,{updated:e.data.updated,upsertedId:e.data.upserted_id,requestId:e.requestId})}).catch(e=>{t(e)}),t.promise}remove(e){e=e||G();const t={_id:this.id},n={collectionName:this._coll,query:t,queryType:u.DOC,multi:!1};return this.request.send("database.deleteDocument",n).then(t=>{t.code?e(0,t):e(0,{deleted:t.data.deleted,requestId:t.requestId})}).catch(t=>{e(t)}),e.promise}get(e){e=e||G();const t={_id:this.id},n={collectionName:this._coll,query:t,queryType:u.DOC,multi:!1,projection:this.projection};return this.request.send("database.queryDocument",n).then(t=>{if(t.code)e(0,t);else{const n=F.formatResDocumentData(t.data.list);e(0,{data:n,requestId:t.requestId,total:t.TotalCount,limit:t.Limit,offset:t.Offset})}}).catch(t=>{e(t)}),e.promise}field(e){for(let t in e)e[t]?e[t]=1:e[t]=0;return new Xe(this._db,this._coll,this.id,e)}}class Qe{constructor(){}static encode(e){return(new Ze).encodeQuery(e)}}class Ze{encodeQuery(e,t){return ce(e)?X(e)?this.encodeLogicCommand(e):ee(e)?this.encodeQueryCommand(e):{[t]:this.encodeQueryObject(e)}:I(e)?this.encodeQueryObject(e):e}encodeRegExp(e){return{$regex:e.source,$options:e.flags}}encodeLogicCommand(e){switch(e.operator){case J.NOR:case J.AND:case J.OR:return{[re(e.operator)]:e.operands.map(t=>this.encodeQuery(t,e.fieldName))};case J.NOT:{const t=re(e.operator),n=e.operands[0];if(P(n))return{[e.fieldName]:{[t]:this.encodeRegExp(n)}};{const r=this.encodeQuery(n)[e.fieldName];return{[e.fieldName]:{[t]:r}}}}default:{const t=re(e.operator);if(1===e.operands.length){return{[t]:this.encodeQuery(e.operands[0])}}return{[t]:e.operands.map(this.encodeQuery.bind(this))}}}}encodeQueryCommand(e){return te(e),this.encodeComparisonCommand(e)}encodeComparisonCommand(e){if(e.fieldName===_)throw new Error("Cannot encode a comparison command with unset field name");const t=re(e.operator);switch(e.operator){case Q.EQ:case Q.NEQ:case Q.LT:case Q.LTE:case Q.GT:case Q.GTE:case Q.ELEM_MATCH:case Q.EXISTS:case Q.SIZE:case Q.MOD:return{[e.fieldName]:{[t]:ue(e.operands[0])}};case Q.IN:case Q.NIN:case Q.ALL:return{[e.fieldName]:{[t]:ue(e.operands)}};case Q.GEO_NEAR:{const t=e.operands[0];return{[e.fieldName]:{$nearSphere:{$geometry:t.geometry.toJSON(),$maxDistance:t.maxDistance,$minDistance:t.minDistance}}}}case Q.GEO_WITHIN:{const t=e.operands[0];return{[e.fieldName]:{$geoWithin:{$geometry:t.geometry.toJSON()}}}}case Q.GEO_INTERSECTS:{const t=e.operands[0];return{[e.fieldName]:{$geoIntersects:{$geometry:t.geometry.toJSON()}}}}default:return{[e.fieldName]:{[t]:ue(e.operands[0])}}}}encodeQueryObject(e){const t=se(e);for(const e in t){const n=t[e];if(X(n)){t[e]=n._setFieldName(e);const r=this.encodeLogicCommand(t[e]);this.mergeConditionAfterEncode(t,r,e)}else if(te(n)){t[e]=n._setFieldName(e);const r=this.encodeComparisonCommand(t[e]);this.mergeConditionAfterEncode(t,r,e)}else ce(n)&&(t[e]=ue(n))}return t}mergeConditionAfterEncode(e,t,n){t[n]||delete e[n];for(const r in t)e[r]?D(e[r])?e[r]=e[r].concat(t[r]):I(e[r])?I(t[r])?Object.assign(e,t):(console.warn(`unmergable condition, query is object but condition is ${N(t)}, can only overwrite`,t,n),e[r]=t[r]):(console.warn(`to-merge query is of type ${N(e)}, can only overwrite`,e,t,n),e[r]=t[r]):e[r]=t[r]}}class et{constructor(e,t,n,r,i){this.watch=e=>(St.ws||(St.ws=new Ve({context:{appConfig:{docSizeLimit:1e3,realtimePingInterval:1e4,realtimePongWaitTimeout:5e3,getAccessToken:this._getAccessToken}}})),St.ws.watch(Object.assign(Object.assign({},e),{envId:this._db.config.env,collectionName:this._coll,query:JSON.stringify(this._fieldFilters)}))),this._db=e,this._coll=t,this._fieldFilters=n,this._fieldOrders=r||[],this._queryOptions=i||{},this._request=new St.reqClass(this._db.config),this._getAccessToken=St.getAccessToken}get(e){e=e||G();let t=[];this._fieldOrders&&this._fieldOrders.forEach(e=>{t.push(e)});let n={collectionName:this._coll,queryType:u.WHERE};return this._fieldFilters&&(n.query=this._fieldFilters),t.length>0&&(n.order=t),this._queryOptions.offset&&(n.offset=this._queryOptions.offset),this._queryOptions.limit?n.limit=this._queryOptions.limit<1e3?this._queryOptions.limit:1e3:n.limit=100,this._queryOptions.projection&&(n.projection=this._queryOptions.projection),this._request.send("database.queryDocument",n).then(t=>{if(t.code)e(0,t);else{const n={data:F.formatResDocumentData(t.data.list),requestId:t.requestId};t.TotalCount&&(n.total=t.TotalCount),t.Limit&&(n.limit=t.Limit),t.Offset&&(n.offset=t.Offset),e(0,n)}}).catch(t=>{e(t)}),e.promise}count(e){e=e||G();let t={collectionName:this._coll,queryType:u.WHERE};return this._fieldFilters&&(t.query=this._fieldFilters),this._request.send("database.countDocument",t).then(t=>{t.code?e(0,t):e(0,{requestId:t.requestId,total:t.data.total})}),e.promise}where(e){if("Object"!==Object.prototype.toString.call(e).slice(8,-1))throw Error(r.QueryParamTypeError);const t=Object.keys(e),n=t.some(t=>void 0!==e[t]);if(t.length&&!n)throw Error(r.QueryParamValueError);return new et(this._db,this._coll,Qe.encode(e),this._fieldOrders,this._queryOptions)}orderBy(e,t){z.isFieldPath(e),z.isFieldOrder(t);const n={field:e,direction:t},r=this._fieldOrders.concat(n);return new et(this._db,this._coll,this._fieldFilters,r,this._queryOptions)}limit(e){z.isInteger("limit",e);let t=Object.assign({},this._queryOptions);return t.limit=e,new et(this._db,this._coll,this._fieldFilters,this._fieldOrders,t)}skip(e){z.isInteger("offset",e);let t=Object.assign({},this._queryOptions);return t.offset=e,new et(this._db,this._coll,this._fieldFilters,this._fieldOrders,t)}update(e,t){if(t=t||G(),!e||"object"!=typeof e)return Promise.resolve({code:"INVALID_PARAM",message:"参数必需是非空对象"});if(e.hasOwnProperty("_id"))return Promise.resolve({code:"INVALID_PARAM",message:"不能更新_id的值"});let n={collectionName:this._coll,query:this._fieldFilters,queryType:u.WHERE,multi:!0,merge:!0,upsert:!1,data:le.encode(e)};return this._request.send("database.updateDocument",n).then(e=>{e.code?t(0,e):t(0,{requestId:e.requestId,updated:e.data.updated,upsertId:e.data.upsert_id})}),t.promise}field(e){for(let t in e)e[t]?"object"!=typeof e[t]&&(e[t]=1):e[t]=0;let t=Object.assign({},this._queryOptions);return t.projection=e,new et(this._db,this._coll,this._fieldFilters,this._fieldOrders,t)}remove(e){e=e||G(),Object.keys(this._queryOptions).length>0&&console.warn("`offset`, `limit` and `projection` are not supported in remove() operation"),this._fieldOrders.length>0&&console.warn("`orderBy` is not supported in remove() operation");const t={collectionName:this._coll,query:Qe.encode(this._fieldFilters),queryType:u.WHERE,multi:!0};return this._request.send("database.deleteDocument",t).then(t=>{t.code?e(0,t):e(0,{requestId:t.requestId,deleted:t.data.deleted})}),e.promise}}var tt=n(0);class nt{constructor(e,t){this._stages=[],e&&t&&(this._db=e,this._request=new St.reqClass(this._db.config),this._collectionName=t)}async end(){if(!this._collectionName||!this._db)throw new Error("Aggregation pipeline cannot send request");const e=await this._request.send("database.aggregate",{collectionName:this._collectionName,stages:this._stages});return e&&e.data&&e.data.list?{requestId:e.requestId,data:JSON.parse(e.data.list).map(tt.a.parse)}:e}unwrap(){return this._stages}done(){return this._stages.map(({stageKey:e,stageValue:t})=>({[e]:JSON.parse(t)}))}_pipe(e,t){return this._stages.push({stageKey:`$${e}`,stageValue:JSON.stringify(t)}),this}addFields(e){return this._pipe("addFields",e)}bucket(e){return this._pipe("bucket",e)}bucketAuto(e){return this._pipe("bucketAuto",e)}count(e){return this._pipe("count",e)}geoNear(e){return this._pipe("geoNear",e)}group(e){return this._pipe("group",e)}limit(e){return this._pipe("limit",e)}match(e){return this._pipe("match",Qe.encode(e))}project(e){return this._pipe("project",e)}lookup(e){return this._pipe("lookup",e)}replaceRoot(e){return this._pipe("replaceRoot",e)}sample(e){return this._pipe("sample",e)}skip(e){return this._pipe("skip",e)}sort(e){return this._pipe("sort",e)}sortByCount(e){return this._pipe("sortByCount",e)}unwind(e){return this._pipe("unwind",e)}}class rt extends et{constructor(e,t){super(e,t)}get name(){return this._coll}doc(e){if("string"!=typeof e&&"number"!=typeof e)throw new Error("docId必须为字符串或数字");return new Xe(this._db,this._coll,e)}add(e,t){return new Xe(this._db,this._coll,void 0).create(e,t)}aggregate(){return new nt(this._db,this._coll)}}const it={eq:e=>new Z(Q.EQ,[e]),neq:e=>new Z(Q.NEQ,[e]),lt:e=>new Z(Q.LT,[e]),lte:e=>new Z(Q.LTE,[e]),gt:e=>new Z(Q.GT,[e]),gte:e=>new Z(Q.GTE,[e]),in:e=>new Z(Q.IN,e),nin:e=>new Z(Q.NIN,e),all:e=>new Z(Q.ALL,e),elemMatch:e=>new Z(Q.ELEM_MATCH,[e]),exists:e=>new Z(Q.EXISTS,[e]),size:e=>new Z(Q.SIZE,[e]),mod:e=>new Z(Q.MOD,[e]),geoNear:e=>new Z(Q.GEO_NEAR,[e]),geoWithin:e=>new Z(Q.GEO_WITHIN,[e]),geoIntersects:e=>new Z(Q.GEO_INTERSECTS,[e]),and(...e){const t=D(arguments[0])?arguments[0]:Array.from(arguments);return new V(J.AND,t)},nor(...e){const t=D(arguments[0])?arguments[0]:Array.from(arguments);return new V(J.NOR,t)},or(...e){const t=D(arguments[0])?arguments[0]:Array.from(arguments);return new V(J.OR,t)},not(...e){const t=D(arguments[0])?arguments[0]:Array.from(arguments);return new V(J.NOT,t)},set:e=>new K(Y.SET,[e]),remove:()=>new K(Y.REMOVE,[]),inc:e=>new K(Y.INC,[e]),mul:e=>new K(Y.MUL,[e]),push(...e){let t;if(I(e[0])&&e[0].hasOwnProperty("each")){const n=e[0];t={$each:n.each,$position:n.position,$sort:n.sort,$slice:n.slice}}else t=D(e[0])?e[0]:Array.from(e);return new K(Y.PUSH,t)},pull:e=>new K(Y.PULL,e),pullAll:e=>new K(Y.PULL_ALL,e),pop:()=>new K(Y.POP,[]),shift:()=>new K(Y.SHIFT,[]),unshift(...e){const t=D(arguments[0])?arguments[0]:Array.from(arguments);return new K(Y.UNSHIFT,t)},addToSet:e=>new K(Y.ADD_TO_SET,e),rename:e=>new K(Y.RENAME,[e]),bit:e=>new K(Y.BIT,[e]),max:e=>new K(Y.MAX,[e]),min:e=>new K(Y.MIN,[e]),expr:e=>({$expr:e}),jsonSchema:e=>({$jsonSchema:e}),text:e=>B(e)?{$search:e.search}:{$search:e.search,$language:e.language,$caseSensitive:e.caseSensitive,$diacriticSensitive:e.diacriticSensitive},aggregate:{pipeline:()=>new nt,abs:e=>new ot("abs",e),add:e=>new ot("add",e),ceil:e=>new ot("ceil",e),divide:e=>new ot("divide",e),exp:e=>new ot("exp",e),floor:e=>new ot("floor",e),ln:e=>new ot("ln",e),log:e=>new ot("log",e),log10:e=>new ot("log10",e),mod:e=>new ot("mod",e),multiply:e=>new ot("multiply",e),pow:e=>new ot("pow",e),sqrt:e=>new ot("sqrt",e),subtract:e=>new ot("subtract",e),trunc:e=>new ot("trunc",e),arrayElemAt:e=>new ot("arrayElemAt",e),arrayToObject:e=>new ot("arrayToObject",e),concatArrays:e=>new ot("concatArrays",e),filter:e=>new ot("filter",e),in:e=>new ot("in",e),indexOfArray:e=>new ot("indexOfArray",e),isArray:e=>new ot("isArray",e),map:e=>new ot("map",e),range:e=>new ot("range",e),reduce:e=>new ot("reduce",e),reverseArray:e=>new ot("reverseArray",e),size:e=>new ot("size",e),slice:e=>new ot("slice",e),zip:e=>new ot("zip",e),and:e=>new ot("and",e),not:e=>new ot("not",e),or:e=>new ot("or",e),cmp:e=>new ot("cmp",e),eq:e=>new ot("eq",e),gt:e=>new ot("gt",e),gte:e=>new ot("gte",e),lt:e=>new ot("lt",e),lte:e=>new ot("lte",e),neq:e=>new ot("ne",e),cond:e=>new ot("cond",e),ifNull:e=>new ot("ifNull",e),switch:e=>new ot("switch",e),dateFromParts:e=>new ot("dateFromParts",e),dateFromString:e=>new ot("dateFromString",e),dayOfMonth:e=>new ot("dayOfMonth",e),dayOfWeek:e=>new ot("dayOfWeek",e),dayOfYear:e=>new ot("dayOfYear",e),isoDayOfWeek:e=>new ot("isoDayOfWeek",e),isoWeek:e=>new ot("isoWeek",e),isoWeekYear:e=>new ot("isoWeekYear",e),millisecond:e=>new ot("millisecond",e),minute:e=>new ot("minute",e),month:e=>new ot("month",e),second:e=>new ot("second",e),hour:e=>new ot("hour",e),week:e=>new ot("week",e),year:e=>new ot("year",e),literal:e=>new ot("literal",e),mergeObjects:e=>new ot("mergeObjects",e),objectToArray:e=>new ot("objectToArray",e),allElementsTrue:e=>new ot("allElementsTrue",e),anyElementTrue:e=>new ot("anyElementTrue",e),setDifference:e=>new ot("setDifference",e),setEquals:e=>new ot("setEquals",e),setIntersection:e=>new ot("setIntersection",e),setIsSubset:e=>new ot("setIsSubset",e),setUnion:e=>new ot("setUnion",e),concat:e=>new ot("concat",e),dateToString:e=>new ot("dateToString",e),indexOfBytes:e=>new ot("indexOfBytes",e),indexOfCP:e=>new ot("indexOfCP",e),split:e=>new ot("split",e),strLenBytes:e=>new ot("strLenBytes",e),strLenCP:e=>new ot("strLenCP",e),strcasecmp:e=>new ot("strcasecmp",e),substr:e=>new ot("substr",e),substrBytes:e=>new ot("substrBytes",e),substrCP:e=>new ot("substrCP",e),toLower:e=>new ot("toLower",e),toUpper:e=>new ot("toUpper",e),meta:e=>new ot("meta",e),addToSet:e=>new ot("addToSet",e),avg:e=>new ot("avg",e),first:e=>new ot("first",e),last:e=>new ot("last",e),max:e=>new ot("max",e),min:e=>new ot("min",e),push:e=>new ot("push",e),stdDevPop:e=>new ot("stdDevPop",e),stdDevSamp:e=>new ot("stdDevSamp",e),sum:e=>new ot("sum",e),let:e=>new ot("let",e)},project:{slice:e=>new st("slice",e),elemMatch:e=>new st("elemMatch",e)}};class ot{constructor(e,t){this["$"+e]=t}}class st{constructor(e,t){this["$"+e]=t}}class at{constructor({regexp:e,options:t}){if(!e)throw new TypeError("regexp must be a string");this.$regex=e,this.$options=t}parse(){return{$regex:this.$regex,$options:this.$options}}get _internalType(){return O}}function ct(e){return new at(e)}const ut={CREATE_WATCH_NET_ERROR:{code:"CREATE_WATCH_NET_ERROR",message:"create watch network error"},CREATE_WACTH_EXCEED_ERROR:{code:"CREATE_WACTH_EXCEED_ERROR",message:"maximum connections exceed"},CREATE_WATCH_SERVER_ERROR:{code:"CREATE_WATCH_SERVER_ERROR",message:"create watch server error"},CONN_ERROR:{code:"CONN_ERROR",message:"connection error"},INVALID_PARAM:{code:"INVALID_PARAM",message:"Invalid request param"},INSERT_DOC_FAIL:{code:"INSERT_DOC_FAIL",message:"insert document failed"},DATABASE_TRANSACTION_CONFLICT:{code:"DATABASE_TRANSACTION_CONFLICT",message:"database transaction conflict"}},lt="database.getInTransaction",ft="database.updateDocInTransaction",ht="database.deleteDocInTransaction",pt="database.insertDocInTransaction";class dt{constructor(e,t,n){this._coll=t,this.id=n,this._transaction=e,this._request=this._transaction.getRequestMethod(),this._transactionId=this._transaction.getTransactionId()}async create(e){let t={collectionName:this._coll,transactionId:this._transactionId,data:tt.a.stringify(ie(e),{relaxed:!1})};this.id&&(t._id=this.id);const n=await this._request.send(pt,t);if(n.code)throw n;const r=tt.a.parse(n.inserted),i=tt.a.parse(n.ok);if(1==i&&1==r)return Object.assign(Object.assign({},n),{ok:i,inserted:r});throw new Error(ut.INSERT_DOC_FAIL.message)}async get(){const e={collectionName:this._coll,transactionId:this._transactionId,query:{_id:{$eq:this.id}}},t=await this._request.send(lt,e);if(t.code)throw t;return{data:"null"!==t.data?F.formatField(tt.a.parse(t.data)):tt.a.parse(t.data),requestId:t.requestId}}async set(e){const t={collectionName:this._coll,transactionId:this._transactionId,query:{_id:{$eq:this.id}},data:tt.a.stringify(ie(e),{relaxed:!1}),upsert:!0},n=await this._request.send(ft,t);if(n.code)throw n;return Object.assign(Object.assign({},n),{updated:tt.a.parse(n.updated),upserted:n.upserted?JSON.parse(n.upserted):null})}async update(e){const t={collectionName:this._coll,transactionId:this._transactionId,query:{_id:{$eq:this.id}},data:tt.a.stringify(le.encode(e),{relaxed:!1})},n=await this._request.send(ft,t);if(n.code)throw n;return Object.assign(Object.assign({},n),{updated:tt.a.parse(n.updated)})}async delete(){const e={collectionName:this._coll,transactionId:this._transactionId,query:{_id:{$eq:this.id}}},t=await this._request.send(ht,e);if(t.code)throw t;return Object.assign(Object.assign({},t),{deleted:tt.a.parse(t.deleted)})}}class _t{constructor(e,t){this._coll=t,this._transaction=e}}class yt extends _t{constructor(e,t){super(e,t)}get name(){return this._coll}doc(e){if("string"!=typeof e&&"number"!=typeof e)throw new Error("docId必须为字符串或数字");return new dt(this._transaction,this._coll,e)}add(e){let t;return void 0!==e._id&&(t=e._id),new dt(this._transaction,this._coll,t).create(e)}}const gt="database.startTransaction",mt="database.commitTransaction",bt="database.abortTransaction";class vt{constructor(e){this._db=e,this._request=new St.reqClass(this._db.config),this.aborted=!1,this.commited=!1,this.inited=!1}async init(){const e=await this._request.send(gt);if(e.code)throw e;this.inited=!0,this._id=e.transactionId}collection(e){if(!e)throw new Error("Collection name is required");return new yt(this,e)}getTransactionId(){return this._id}getRequestMethod(){return this._request}async commit(){const e={transactionId:this._id},t=await this._request.send(mt,e);if(t.code)throw t;return this.commited=!0,t}async rollback(e){const t={transactionId:this._id},n=await this._request.send(bt,t);if(n.code)throw n;return this.aborted=!0,this.abortReason=e,n}}async function wt(){const e=new vt(this);return await e.init(),e}async function Et(e,t=3){let n;try{n=new vt(this),await n.init();const t=await e(n);if(!0===n.aborted)throw n.abortReason;return await n.commit(),t}catch(r){if(!1===n.inited)throw r;const i=async e=>{if(!n.aborted&&!n.commited){try{await n.rollback()}catch(e){}throw e}if(!0===n.aborted)throw n.abortReason;throw e};if(t<=0&&await i(r),r&&r.code===ut.DATABASE_TRANSACTION_CONFLICT.code)return await Et.bind(this)(e,--t);await i(r)}}n.d(t,"Db",(function(){return St})),n.d(t,"Query",(function(){return et})),n.d(t,"CollectionReference",(function(){return rt})),n.d(t,"DocumentReference",(function(){return Xe}));class St{constructor(e){this.config=e,this.Geo=i,this.serverDate=q,this.command=it,this.RegExp=ct,this.startTransaction=wt,this.runTransaction=Et}collection(e){if(!e)throw new Error("Collection name is required");return new rt(this,e)}createCollection(e){const t={collectionName:e};return new St.reqClass(this.config).send("database.addCollection",t)}}},function(e,t,n){"use strict";var r;n.r(t),function(e){e.local="local",e.none="none",e.session="session"}(r||(r={}));var i=function(){};function o(e,t,n){void 0===n&&(n={});var r=/\?/.test(t),i="";for(var o in n)""===i?!r&&(t+="?"):i+="&",i+=o+"="+encodeURIComponent(n[o]);return/^http(s)?\:\/\//.test(t+=i)?t:""+e+t}n.d(t,"WxRequest",(function(){return f})),n.d(t,"wxMpStorage",(function(){return h})),n.d(t,"WxMpWebSocket",(function(){return p}));var s,a=(s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),c=function(){return(c=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},u=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},l=function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};var f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.post=function(e){var t=e.url,n=e.data,r=e.headers;return new Promise((function(e,i){wx.request({url:o("https:",t),data:n,method:"POST",header:r,success:function(t){e(t)},fail:function(e){i(e)}})}))},t.prototype.upload=function(e){var t=this;return new Promise((function(n){return u(t,void 0,void 0,(function(){var t,r,i,s;return l(this,(function(a){return t=e.url,r=e.file,i=e.data,s=e.headers,wx.uploadFile({url:o("https:",t),filePath:r,name:"file",formData:c(c({},i),{file:r}),header:s,success:function(e){var t={statusCode:e.statusCode,data:e.data||{}};200===e.statusCode&&i.success_action_status&&(t.statusCode=parseInt(i.success_action_status,10)),n(t)},fail:function(e){n(e)}}),[2]}))}))}))},t.prototype.download=function(e){var t=e.url,n=e.headers;return new Promise((function(e,r){wx.downloadFile({url:o("https:",t),header:n,success:function(t){200===t.statusCode&&t.tempFilePath?e({statusCode:200,tempFilePath:t.tempFilePath}):e(t)},fail:function(e){r(e)}})}))},t}(i),h={setItem:function(e,t){wx.setStorageSync(e,t)},getItem:function(e){return wx.getStorageSync(e)},removeItem:function(e){wx.removeStorageSync(e)},clear:function(){wx.clearStorageSync()}},p=function(e,t){void 0===t&&(t={});var n=wx.connectSocket(c({url:e},t));return{set onopen(e){n.onOpen(e)},set onmessage(e){n.onMessage(e)},set onclose(e){n.onClose(e)},set onerror(e){n.onError(e)},send:function(e){return n.send({data:e})},close:function(e,t){return n.close({code:e,reason:t})},get readyState(){return n.readyState},CONNECTING:0,OPEN:1,CLOSING:2,CLOSED:3}};var d={genAdapter:function(){return{root:{},reqClass:f,wsClass:p,localStorage:h,primaryStorage:r.local,getAppSign:function(){var e=wx.getAccountInfoSync();return e&&e.miniProgram?e.miniProgram.appId:""}}},isMatch:function(){if("undefined"==typeof wx)return!1;if("undefined"==typeof App)return!1;if("undefined"==typeof Page)return!1;if("function"!=typeof getApp)return!1;if(!wx.onAppHide)return!1;if(!wx.offAppHide)return!1;if(!wx.onAppShow)return!1;if(!wx.offAppShow)return!1;if(!wx.getSystemInfoSync)return!1;if(!wx.getStorageSync)return!1;if(!wx.setStorageSync)return!1;if(!wx.connectSocket)return!1;if(!wx.request)return!1;try{if(!wx.getSystemInfoSync())return!1;if("qq"===wx.getSystemInfoSync().AppPlatform)return!1}catch(e){return!1}return!0},runtime:"wx_mp"};t.default=d}])}));