(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-91954c66"],{"1af6":function(t,e,r){var n=r("63b6");n(n.S,"Array",{isArray:r("9003")})},"469f":function(t,e,r){r("6c1c"),r("1654"),t.exports=r("7d7b")},"52f7":function(t,e,r){},"54a1":function(t,e,r){r("6c1c"),r("1654"),t.exports=r("95d5")},"5d73":function(t,e,r){t.exports=r("469f")},"7d7b":function(t,e,r){var n=r("e4ae"),a=r("7cd6");t.exports=r("584a").getIterator=function(t){var e=a(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return n(e.call(t))}},"89d4":function(t,e,r){"use strict";var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"myList"},[r("div",{staticClass:"topBar"},[r("span",{staticClass:"backbtn iconfont icon-left",on:{click:t.GoBack}}),r("p",{staticClass:"title"},[t._v(t._s(t.Title))])]),r("scroll",{staticClass:"scroll-wrap",class:{"scroll-wrap-bottom":t.needBottomMargin},attrs:{pullup:!0},on:{scrollToEnd:t.scrollToEnd}},[r("ul",[t._t("default")],2)])],1)},a=[],i=r("e9fc"),o={props:{Title:{type:String,default:""},needBottomMargin:{type:Boolean,default:!1}},methods:{GoBack:function(){this.$router.back()},scrollToEnd:function(){this.$emit("scrollToEnd")}},components:{Scroll:i["a"]}},s=o,c=(r("cfc8"),r("2877")),u=Object(c["a"])(s,n,a,!1,null,"1aedd296",null);e["a"]=u.exports},9003:function(t,e,r){var n=r("6b4c");t.exports=Array.isArray||function(t){return"Array"==n(t)}},"95d5":function(t,e,r){var n=r("40c3"),a=r("5168")("iterator"),i=r("481b");t.exports=r("584a").isIterable=function(t){var e=Object(t);return void 0!==e[a]||"@@iterator"in e||i.hasOwnProperty(n(e))}},a4cf:function(t,e,r){"use strict";r.r(e);var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("my-list",{ref:"scroll",attrs:{Title:t.$route.query.userNickname,needBottomMargin:!0}},t._l(t.chatList,(function(e){return r("div",{key:e.id,staticClass:"chat-item"},["time"!==e.type&&e.content.isMe?r("div",{staticClass:"right"},[r("div",{staticClass:"content"},[t._v("\n            "+t._s(e.content.content)+"\n          ")]),r("img",{staticClass:"avatar",attrs:{src:""+t.baseURL+t.loginInfo.userAvatar,alt:"",width:"40",height:"40"}})]):"time"===e.type||e.isMe?r("span",{staticClass:"time"},[t._v(t._s(e.content))]):r("div",{staticClass:"left"},[r("img",{staticClass:"avatar",attrs:{src:""+t.baseURL+t.$route.query.userAvatar,alt:"",width:"40",height:"40"}}),r("div",{staticClass:"content"},[t._v("\n            "+t._s(e.content.content)+"\n          ")])])])})),0),r("div",{staticClass:"input-bar"},[r("input",{directives:[{name:"model",rawName:"v-model",value:t.privateLetterContent,expression:"privateLetterContent"}],staticClass:"input",attrs:{placeholder:"  发送消息...",type:"text"},domProps:{value:t.privateLetterContent},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.sendPrivateLetter(e)},blur:t.inputBlur,input:function(e){e.target.composing||(t.privateLetterContent=e.target.value)}}}),r("span",{staticClass:"iconfont icon-at"}),r("span",{staticClass:"iconfont icon-check",on:{click:t.sendPrivateLetter}})])],1)},a=[],i=(r("8e6e"),r("456d"),r("a745")),o=r.n(i);function s(t){if(o()(t))return t}var c=r("5d73"),u=r.n(c),d=r("c8bb"),l=r.n(d);function f(t,e){if(l()(Object(t))||"[object Arguments]"===Object.prototype.toString.call(t)){var r=[],n=!0,a=!1,i=void 0;try{for(var o,s=u()(t);!(n=(o=s.next()).done);n=!0)if(r.push(o.value),e&&r.length===e)break}catch(c){a=!0,i=c}finally{try{n||null==s["return"]||s["return"]()}finally{if(a)throw i}}return r}}function p(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function v(t,e){return s(t)||f(t,e)||p()}r("ac4d"),r("8a81"),r("96cf");var h=r("3b8d"),m=(r("ac6a"),r("bd86")),b=r("89d4"),g=r("41ea"),y=r("8b55"),L=r("2f62");function I(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function A(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?I(Object(r),!0).forEach((function(e){Object(m["a"])(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):I(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var k={activated:function(){var t=this,e=this.loginInfo.userId,r=this.$route.params.id;this.resetAndGetUnread(r),this.getPrivateLetter(e,r),this.readPrivateLetter(e,r),this.sockets.subscribe("receivePrivateLetter",(function(e){e.fromId!==t.loginInfo.userId&&(t.addMessageLocal({type:"privateLetter",content:{id:e.fromId,isMe:e.fromId===t.loginInfo.userId,content:e.content,time:e.createdAt}}),t.$store.commit("UPDATE_PRIVATELETTER",{fromId:e.fromId,toId:e.toId,content:e.content,createdAt:e.createdAt,userAvatar:e.userAvatar,userNickname:e.userNickname,type:"privateLetter",isEnterChat:t.$route.params.id===e.fromId}),t.scrollToBottom())}))},updated:function(){this.scrollToBottom()},data:function(){return{unread:0,chatList:[],privateLetterContent:"",baseURL:g["a"]}},computed:A({},Object(L["c"])(["loginInfo","allPrivateLetter"])),watch:{allMessage:function(){this.getUnread()}},methods:{inputBlur:function(){window.scroll(0,0)},scrollToBottom:function(){var t=this;setTimeout((function(){var e=t.$refs.scroll.$children[0];e.scrollTo(0,e.scroll.maxScrollY)}),30)},resetAndGetUnread:function(t){this.chatList=[],this.$store.commit("UPDATE_UNREAD_PRIVATELETTER",{fromId:t}),this.getUnread()},getUnread:function(){var t=0;this.allPrivateLetter.forEach((function(e){t+=e.unread})),this.unread=t},getPrivateLetter:function(){var t=Object(h["a"])(regeneratorRuntime.mark((function t(e,r){var n,a,i,o,s,c,u,d,l,f,p;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$axios.get("/api/user/".concat(e,"/getPrivateLetter/").concat(r));case 2:if(n=t.sent,a=n.data.data,0!==a.length){t.next=6;break}return t.abrupt("return");case 6:for(this.isAddTimeMessage(0,a[0].createdAt),i=!0,o=!1,s=void 0,t.prev=10,c=a.entries()[Symbol.iterator]();!(i=(u=c.next()).done);i=!0)d=v(u.value,2),l=d[0],f=d[1],l>0&&this.isAddTimeMessage(1,f.createdAt,a[l-1].createdAt),p={type:"privateLetter",content:{id:f.fromId,isMe:f.fromId===this.loginInfo.userId,content:f.privateLetterContent,time:f.createdAt}},this.chatList.push(p);t.next=18;break;case 14:t.prev=14,t.t0=t["catch"](10),o=!0,s=t.t0;case 18:t.prev=18,t.prev=19,i||null==c.return||c.return();case 21:if(t.prev=21,!o){t.next=24;break}throw s;case 24:return t.finish(21);case 25:return t.finish(18);case 26:case"end":return t.stop()}}),t,this,[[10,14,18,26],[19,,21,25]])})));function e(e,r){return t.apply(this,arguments)}return e}(),readPrivateLetter:function(){var t=Object(h["a"])(regeneratorRuntime.mark((function t(e,r){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$axios.get("/api/user/".concat(e,"/readPrivateLetter/").concat(r));case 2:n=t.sent,n.data.code;case 4:case"end":return t.stop()}}),t,this)})));function e(e,r){return t.apply(this,arguments)}return e}(),addMessageLocal:function(t){var e=this.chatList;if(0===e.length)this.isAddTimeMessage(0,t.content.time);else{var r=e[e.length-1],n=r.content.time;this.isAddTimeMessage(1,t.content.time,n)}this.chatList.push(t)},isAddTimeMessage:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(t){var n=18e5;e-r>n&&this.chatList.push({type:"time",content:Object(y["e"])(e)})}else this.chatList.push({type:"time",content:Object(y["e"])(e)})},sendPrivateLetter:function(){var t=this,e=this.privateLetterContent.trim();if(e){var r={content:e,fromUserId:this.loginInfo.userId,toUserId:this.$route.params.id};this.$axios.post("/api/user/".concat(r.fromUserId,"/privateLetter/").concat(r.toUserId),r).then((function(e){var r=e.data.data;t.$socket.emit("sendPrivateLetter",{fromId:t.loginInfo.userId,toId:r.toId,content:r.privateLetterContent,createdAt:r.createdAt,userAvatar:t.loginInfo.userAvatar,userNickname:t.loginInfo.userNickname}),t.addMessageLocal({type:"privateLetter",content:{id:r.fromId,isMe:r.fromId===t.loginInfo.userId,content:r.privateLetterContent,time:r.createdAt}}),t.$store.commit("UPDATE_PRIVATELETTER",{fromId:r.toId,content:r.privateLetterContent,createdAt:r.createdAt,userAvatar:t.$route.query.userAvatar,userNickname:t.$route.query.userNickname,type:"privateLetter",isEnterChat:!0}),t.scrollToBottom()})),this.privateLetterContent=""}}},beforeRouteLeave:function(t,e,r){this.sockets.unsubscribe("receivePrivateLetter"),r()},components:{MyList:b["a"]}},w=k,T=(r("bd5a"),r("2877")),C=Object(T["a"])(w,n,a,!1,null,"6b7045a6",null);e["default"]=C.exports},a745:function(t,e,r){t.exports=r("f410")},bd5a:function(t,e,r){"use strict";var n=r("52f7"),a=r.n(n);a.a},c8bb:function(t,e,r){t.exports=r("54a1")},cfc8:function(t,e,r){"use strict";var n=r("df3c"),a=r.n(n);a.a},df3c:function(t,e,r){},f410:function(t,e,r){r("1af6"),t.exports=r("584a").Array.isArray}}]);